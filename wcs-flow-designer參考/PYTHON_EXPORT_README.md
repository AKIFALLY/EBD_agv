# Pythonå¯åŸ·è¡ŒJSONå°å‡ºåŠŸèƒ½

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

WCS Flow Designer ç¾å·²æ”¯æ´å°å‡ºPythonå¯ç›´æ¥åŸ·è¡Œçš„JSONå·¥ä½œæµæ ¼å¼ã€‚æ–°çš„å°å‡ºæ ¼å¼åŒ…å«å®Œæ•´çš„æµç¨‹æ§åˆ¶çµæ§‹ï¼Œæ”¯æ´æ¢ä»¶åˆ†æ”¯ã€é‚è¼¯é‹ç®—ã€æˆ¿é–“è¿´åœˆç­‰é«˜ç´šåŠŸèƒ½ã€‚

## ğŸ”§ æ–°å¢åŠŸèƒ½

### 1. çµæ§‹åŒ–å·¥ä½œæµ
- **å®Œæ•´æµç¨‹åˆ†æ**ï¼šè‡ªå‹•åˆ†æç¯€é»é–“çš„é€£æ¥é—œä¿‚å’ŒåŸ·è¡Œé †åº
- **æ­¥é©ŸåŒ–åŸ·è¡Œ**ï¼šå°‡è¦–è¦ºåŒ–æµç¨‹è½‰æ›ç‚ºçµæ§‹åŒ–çš„åŸ·è¡Œæ­¥é©Ÿ
- **æµç¨‹æ§åˆ¶**ï¼šæ”¯æ´æ¢ä»¶åˆ†æ”¯ã€é‚è¼¯é‹ç®—ã€è¿´åœˆçµæ§‹

### 2. è®Šæ•¸ç³»çµ±
- **å‹•æ…‹è®Šæ•¸**ï¼šæ”¯æ´ `${current_room}` ç­‰è®Šæ•¸æ›¿æ›
- **æˆ¿é–“é™£åˆ—**ï¼šè‡ªå‹•ç”Ÿæˆæˆ¿é–“ç·¨è™Ÿé™£åˆ— `["01", "02", "03", "04", "05"]`
- **å…¨åŸŸè®Šæ•¸**ï¼šå·¥ä½œæµç´šåˆ¥çš„è®Šæ•¸å®šç¾©å’Œç®¡ç†

### 3. æˆ¿é–“è¿´åœˆè™•ç†
- **è‡ªå‹•æª¢æ¸¬**ï¼šåµæ¸¬ç¯€é»ä¸­çš„ `FOR_LOOP` åƒæ•¸
- **foreachåŒ…è£**ï¼šè‡ªå‹•ç”Ÿæˆ `foreach` æ­¥é©ŸåŒ…è£ç›¸é—œé‚è¼¯
- **è®Šæ•¸ä½œç”¨åŸŸ**ï¼šæ­£ç¢ºè™•ç†æˆ¿é–“è®Šæ•¸çš„ä½œç”¨åŸŸ

### 4. ç¯€é»é¡å‹è½‰æ›

#### æ¢ä»¶ç¯€é» â†’ conditionæ­¥é©Ÿ
```json
{
  "type": "condition",
  "id": "room-has-carrier_1",
  "function": "room_has_carrier",
  "parameters": {
    "room_id": "${current_room}",
    "check_exists": true
  },
  "on_true": "next_step",
  "on_false": "end_step"
}
```

#### é‚è¼¯ç¯€é» â†’ logicæ­¥é©Ÿ
```json
{
  "type": "logic_and",
  "id": "and-gate_1",
  "conditions": ["condition_1", "condition_2"],
  "on_all_true": "action_step",
  "on_any_false": "end_step"
}
```

#### å‹•ä½œç¯€é» â†’ create_taskæ­¥é©Ÿ
```json
{
  "type": "create_task",
  "id": "create-task_1",
  "api": "submit_mission",
  "parameters": {
    "task_type": "RACK_MOVE",
    "model": "KUKA400i",
    "mission_type": "RACK_MOVE",
    "path": {
      "type": "transport",
      "source": "room_${current_room}_exit",
      "destination": "manual_collection_area"
    }
  }
}
```

## ğŸ“Š å®Œæ•´JSONæ ¼å¼ç¯„ä¾‹

```json
{
  "workflow": {
    "name": "WCS Flow Export",
    "description": "Generated executable workflow from WCS Flow Designer",
    "version": "1.0",
    "execution_mode": "foreach_room",
    "variables": {
      "rooms": ["01", "02", "03", "04", "05"],
      "current_room": null
    },
    "steps": [
      {
        "type": "foreach",
        "id": "room_iteration",
        "iterator": "rooms",
        "variable": "current_room",
        "steps": [
          {
            "type": "condition",
            "id": "check_carrier",
            "function": "room_has_carrier",
            "parameters": {
              "room_id": "${current_room}",
              "check_exists": true
            },
            "on_true": "create_transport_task",
            "on_false": "end_room_iteration"
          },
          {
            "type": "create_task",
            "id": "create_transport_task",
            "api": "submit_mission",
            "parameters": {
              "task_type": "RACK_MOVE",
              "model": "KUKA400i",
              "mission_type": "RACK_MOVE",
              "path": {
                "type": "transport", 
                "source": "room_${current_room}_exit",
                "destination": "manual_collection_area"
              }
            }
          }
        ]
      }
    ]
  }
}
```

## ğŸ§ª æ¸¬è©¦æ–¹æ³•

### 1. åŸºæœ¬æ¸¬è©¦
1. é–‹å•Ÿ `index.html`
2. å‰µå»ºç°¡å–®çš„æ¢ä»¶â†’å‹•ä½œæµç¨‹
3. é»æ“Šå·¥å…·æ¬„ "Export" æŒ‰éˆ•
4. æª¢æŸ¥å°å‡ºçš„JSONæ ¼å¼

### 2. æˆ¿é–“è¿´åœˆæ¸¬è©¦
1. å‰µå»ºæ¢ä»¶ç¯€é»ï¼Œè¨­å®šæˆ¿é–“ç·¨è™Ÿç‚º "å…¨éƒ¨æˆ¿é–“(1~5)"
2. é€£æ¥åˆ°å‹•ä½œç¯€é»
3. å°å‡ºä¸¦æª¢æŸ¥æ˜¯å¦ç”Ÿæˆ `foreach` çµæ§‹

### 3. é‚è¼¯ç¯€é»æ¸¬è©¦
1. å‰µå»ºå¤šå€‹æ¢ä»¶ç¯€é»
2. é€£æ¥åˆ° AND/OR é‚è¼¯ç¯€é»
3. é‚è¼¯ç¯€é»é€£æ¥åˆ°å‹•ä½œç¯€é»
4. æª¢æŸ¥ `logic_and`/`logic_or` æ­¥é©Ÿç”Ÿæˆ

### 4. ä½¿ç”¨æ¸¬è©¦é é¢
- **è©³ç´°æ¸¬è©¦**ï¼šé–‹å•Ÿ `test-python-export.html`
- **å¿«é€Ÿæ¸¬è©¦**ï¼šé–‹å•Ÿ `test-export-simple.html`

## ğŸ” é©—è­‰æ¸…å–®

- [ ] JSONæ ¼å¼æœ‰æ•ˆä¸”çµæ§‹å®Œæ•´
- [ ] workflowç‰©ä»¶åŒ…å«æ‰€æœ‰å¿…è¦æ¬„ä½
- [ ] variablesæ­£ç¢ºå®šç¾©æˆ¿é–“é™£åˆ—
- [ ] stepsé™£åˆ—åŒ…å«æ‰€æœ‰ç¯€é»è½‰æ›
- [ ] æ¢ä»¶ç¯€é»è½‰æ›ç‚ºconditionæ­¥é©Ÿ
- [ ] é‚è¼¯ç¯€é»è½‰æ›ç‚ºlogic_and/logic_oræ­¥é©Ÿ
- [ ] å‹•ä½œç¯€é»è½‰æ›ç‚ºcreate_taskæ­¥é©Ÿ
- [ ] æˆ¿é–“è¿´åœˆç”ŸæˆforeachåŒ…è£
- [ ] è®Šæ•¸æ›¿æ›æ­£ç¢º(${current_room})
- [ ] ç¯€é»é€£æ¥é—œä¿‚è½‰æ›ç‚ºæ­¥é©Ÿä¾è³´
- [ ] åŸ·è¡Œé †åºé‚è¼¯æ­£ç¢º
- [ ] æ‰€æœ‰åƒæ•¸æ­£ç¢ºæ˜ å°„

## ğŸš€ ä½¿ç”¨å»ºè­°

1. **è¨­è¨ˆéšæ®µ**ï¼šä½¿ç”¨è¦–è¦ºåŒ–ä»‹é¢è¨­è¨ˆWCSæµç¨‹
2. **å°å‡ºéšæ®µ**ï¼šé¸æ“‡é©ç•¶çš„åŸ·è¡Œæ¨¡å¼ï¼ˆå–®æ¬¡åŸ·è¡Œ vs æˆ¿é–“è¿´åœˆåŸ·è¡Œï¼‰
3. **é©—è­‰éšæ®µ**ï¼šæª¢æŸ¥å°å‡ºçš„JSONçµæ§‹æ˜¯å¦ç¬¦åˆé æœŸ
4. **åŸ·è¡Œéšæ®µ**ï¼šä½¿ç”¨PythonåŸ·è¡Œå¼•æ“è™•ç†JSONå·¥ä½œæµ

## âš ï¸ æ³¨æ„äº‹é …

1. **æˆ¿é–“è®Šæ•¸**ï¼šç¢ºä¿æˆ¿é–“ç›¸é—œçš„åƒæ•¸æ­£ç¢ºè¨­å®š
2. **é€£æ¥é—œä¿‚**ï¼šæª¢æŸ¥ç¯€é»é–“çš„é€£æ¥æ˜¯å¦æ­£ç¢ºå»ºç«‹
3. **åŸ·è¡Œé †åº**ï¼šè¤‡é›œæµç¨‹éœ€è¦ä»”ç´°æª¢æŸ¥åŸ·è¡Œé †åº
4. **è®Šæ•¸æ›¿æ›**ï¼šç¢ºèªè®Šæ•¸èªæ³•æ­£ç¢º `${variable_name}`

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### æ ¸å¿ƒæ–¹æ³•
- `analyzeWorkflow()` - åˆ†æå·¥ä½œæµçµæ§‹
- `generateWorkflowVariables()` - ç”Ÿæˆè®Šæ•¸å®šç¾©
- `generateWorkflowSteps()` - ç”ŸæˆåŸ·è¡Œæ­¥é©Ÿ
- `nodeToStep()` - ç¯€é»è½‰æ›ç‚ºæ­¥é©Ÿ

### æ”¯æ´çš„ç¯€é»é¡å‹
- **æ¢ä»¶ç¯€é»**ï¼š5ç¨®WCSæ¢ä»¶æª¢æŸ¥
- **é‚è¼¯ç¯€é»**ï¼šAND/ORé‚è¼¯é‹ç®—
- **å‹•ä½œç¯€é»**ï¼šä»»å‹™å‰µå»ºå’ŒåŸ·è¡Œ

é€™å€‹æ–°çš„å°å‡ºæ ¼å¼ç‚ºWCSç³»çµ±æä¾›äº†å¼·å¤§çš„å·¥ä½œæµåŸ·è¡Œèƒ½åŠ›ï¼Œæ”¯æ´è¤‡é›œçš„æ¢ä»¶åˆ¤æ–·å’Œè‡ªå‹•åŒ–ä»»å‹™ç”Ÿæˆã€‚