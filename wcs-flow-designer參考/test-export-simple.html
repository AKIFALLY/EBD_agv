<!DOCTYPE html>
<html>
<head>
    <title>ç°¡åŒ–å°å‡ºæ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .output { background: #2d2d2d; color: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ–°å°å‡ºåŠŸèƒ½å¿«é€Ÿæ¸¬è©¦</h1>
    
    <p>é€™å€‹é é¢ç”¨æ–¼å¿«é€Ÿæ¸¬è©¦æ–°çš„Pythonå¯åŸ·è¡ŒJSONå°å‡ºåŠŸèƒ½</p>
    
    <button onclick="testBasicExport()">æ¸¬è©¦åŸºæœ¬å°å‡º</button>
    <button onclick="testRoomLoop()">æ¸¬è©¦æˆ¿é–“è¿´åœˆ</button>
    <button onclick="clearOutput()">æ¸…é™¤è¼¸å‡º</button>
    
    <h2>æ¸¬è©¦çµæœï¼š</h2>
    <div id="output" class="output">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.innerHTML += message + '\n';
        }
        
        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }
        
        function testBasicExport() {
            clearOutput();
            log('=== æ¸¬è©¦åŸºæœ¬å°å‡ºåŠŸèƒ½ ===');
            
            try {
                // æ¨¡æ“¬ä¸€å€‹ç°¡å–®çš„ç¯€é»çµæ§‹
                const mockNodes = [
                    {
                        id: 'condition_1',
                        data: {
                            category: 'condition',
                            type: 'room-has-carrier',
                            name: 'æˆ¿é–“å…§æ˜¯å¦æœ‰Carrier',
                            roomNumber: '01',
                            checkValue: 'true'
                        }
                    },
                    {
                        id: 'action_1', 
                        data: {
                            category: 'action',
                            name: 'å‰µå»ºä»»å‹™',
                            taskType: 'rack_transport',
                            robotModel: 'KUKA400i',
                            source: 'transfer_exit',
                            destination: 'manual_collection_area'
                        }
                    }
                ];
                
                const mockConnections = [
                    {
                        id: 'conn_1',
                        source: 'condition_1',
                        target: 'action_1',
                        sourceOutput: 'result',
                        targetInput: 'trigger'
                    }
                ];
                
                log('âœ… æ¨¡æ“¬ç¯€é»å’Œé€£æ¥å‰µå»ºæˆåŠŸ');
                log('ç¯€é»æ•¸é‡: ' + mockNodes.length);
                log('é€£æ¥æ•¸é‡: ' + mockConnections.length);
                
                // æ¸¬è©¦åˆ†æåŠŸèƒ½ï¼ˆç°¡åŒ–ç‰ˆæœ¬ï¼‰
                log('\\n=== æ¸¬è©¦å·¥ä½œæµåˆ†æ ===');
                
                const analysis = {
                    nodes: mockNodes,
                    connections: mockConnections,
                    hasRoomIteration: false
                };
                
                log('âœ… å·¥ä½œæµåˆ†æå®Œæˆ');
                
                // æ¸¬è©¦è®Šé‡ç”Ÿæˆ
                const variables = {
                    rooms: ["01", "02", "03", "04", "05"]
                };
                
                log('âœ… è®Šé‡ç”Ÿæˆå®Œæˆ');
                log('è®Šé‡: ' + JSON.stringify(variables, null, 2));
                
                // ç”Ÿæˆæœ€çµ‚çµæ§‹
                const workflow = {
                    workflow: {
                        name: "æ¸¬è©¦å·¥ä½œæµ",
                        version: "1.0",
                        execution_mode: "single",
                        variables: variables,
                        steps: [
                            {
                                type: "condition",
                                id: "condition_1",
                                function: "room_has_carrier",
                                parameters: {
                                    room_id: "01",
                                    check_exists: true
                                },
                                on_true: "action_1",
                                on_false: "end_step"
                            },
                            {
                                type: "create_task",
                                id: "action_1",
                                api: "submit_mission",
                                parameters: {
                                    task_type: "rack_transport",
                                    model: "KUKA400i",
                                    mission_type: "RACK_MOVE",
                                    path: {
                                        type: "transport",
                                        source: "transfer_exit",
                                        destination: "manual_collection_area"
                                    }
                                }
                            }
                        ]
                    }
                };
                
                log('\\n=== æœ€çµ‚JSONçµæ§‹ ===');
                log(JSON.stringify(workflow, null, 2));
                log('\\nâœ… åŸºæœ¬å°å‡ºæ¸¬è©¦æˆåŠŸï¼');
                
            } catch (error) {
                log('âŒ æ¸¬è©¦å¤±æ•—: ' + error.message);
                log('éŒ¯èª¤è©³æƒ…: ' + error.stack);
            }
        }
        
        function testRoomLoop() {
            clearOutput();
            log('=== æ¸¬è©¦æˆ¿é–“è¿´åœˆåŠŸèƒ½ ===');
            
            try {
                const workflowWithLoop = {
                    workflow: {
                        name: "æˆ¿é–“è¿´åœˆæ¸¬è©¦",
                        version: "1.0", 
                        execution_mode: "foreach_room",
                        variables: {
                            rooms: ["01", "02", "03", "04", "05"],
                            current_room: null
                        },
                        steps: [
                            {
                                type: "foreach",
                                id: "room_iteration",
                                iterator: "rooms",
                                variable: "current_room",
                                steps: [
                                    {
                                        type: "condition",
                                        id: "check_room_carrier",
                                        function: "room_has_carrier",
                                        parameters: {
                                            room_id: "${current_room}",
                                            check_exists: true
                                        },
                                        on_true: "create_transport_task",
                                        on_false: "end_room_iteration"
                                    },
                                    {
                                        type: "create_task",
                                        id: "create_transport_task",
                                        api: "submit_mission",
                                        parameters: {
                                            task_type: "RACK_MOVE",
                                            model: "KUKA400i",
                                            path: {
                                                type: "transport",
                                                source: "room_${current_room}_exit",
                                                destination: "collection_area"
                                            }
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                };
                
                log('âœ… æˆ¿é–“è¿´åœˆçµæ§‹ç”ŸæˆæˆåŠŸ');
                log('\\n=== æˆ¿é–“è¿´åœˆJSONçµæ§‹ ===');
                log(JSON.stringify(workflowWithLoop, null, 2));
                
                log('\\n=== é©—è­‰é‡é» ===');
                log('âœ… åŒ…å« foreach æ­¥é©Ÿ');
                log('âœ… è®Šé‡æ›¿æ› ${current_room}');
                log('âœ… è¿´åœˆè®Šé‡å®šç¾©æ­£ç¢º');
                log('âœ… åµŒå¥—æ­¥é©Ÿçµæ§‹æ­£ç¢º');
                
                log('\\nâœ… æˆ¿é–“è¿´åœˆæ¸¬è©¦æˆåŠŸï¼');
                
            } catch (error) {
                log('âŒ æˆ¿é–“è¿´åœˆæ¸¬è©¦å¤±æ•—: ' + error.message);
            }
        }
    </script>
</body>
</html>