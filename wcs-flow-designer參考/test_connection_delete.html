<!DOCTYPE html>
<html>
<head>
    <title>連線刪除功能測試</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-info { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .test-steps { background: #e7f3ff; padding: 15px; border-left: 4px solid #007bff; }
        .code { background: #f8f9fa; padding: 2px 4px; border: 1px solid #e9ecef; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>WCS Flow Designer - 連線刪除功能測試</h1>
    
    <div class="test-info error">
        <h3>🐛 原始問題：</h3>
        <p><strong>錯誤訊息：</strong></p>
        <p class="code">TypeError: Cannot read properties of undefined (reading 'id')<br>
        at WcsFlowDesigner.handleConnectionRemoved (index.html:1397:92)</p>
        <p><strong>問題描述：</strong> 右鍵點擊連線刪除時出現錯誤</p>
    </div>
    
    <div class="test-info success">
        <h3>✅ 新的刪除方式：</h3>
        <ul>
            <li><strong>點擊選擇</strong> - 點擊連線進行選擇 (變藍色)</li>
            <li><strong>刪除按鈕</strong> - 選擇後會在連線中間顯示紅色 ✕ 按鈕</li>
            <li><strong>鍵盤刪除</strong> - 選擇連線後按 Delete 或 Backspace 鍵刪除</li>
            <li><strong>自動取消選擇</strong> - 點擊空白處或選擇節點時自動取消連線選擇</li>
        </ul>
    </div>
    
    <div class="test-steps">
        <h3>🧪 測試步驟：</h3>
        <ol>
            <li><strong>開啟應用程式</strong>
                <br>點擊下方按鈕開啟 WCS Flow Designer
            </li>
            <li><strong>建立連線</strong>
                <br>• 從左側拖拽至少兩個節點到畫布
                <br>• 從輸出 socket (紅色圓點) 拖拽到輸入 socket (綠色圓點)
                <br>• 確認連線已建立 (灰色線條)
            </li>
            <li><strong>測試連線選擇</strong>
                <br>• 點擊連線
                <br>• 確認連線變成藍色並加粗 (選中狀態)
                <br>• 確認連線中間出現紅色 ✕ 刪除按鈕
            </li>
            <li><strong>測試刪除按鈕</strong>
                <br>• 點擊紅色 ✕ 按鈕
                <br>• 確認連線被成功刪除
                <br>• 檢查 F12 控制台無錯誤訊息
            </li>
            <li><strong>測試鍵盤刪除</strong>
                <br>• 點擊選擇一條連線
                <br>• 按 Delete 或 Backspace 鍵
                <br>• 確認連線被刪除
            </li>
            <li><strong>測試取消選擇</strong>
                <br>• 選擇一條連線
                <br>• 點擊空白處或節點
                <br>• 確認連線選擇被取消 (恢復灰色)
            </li>
            <li><strong>測試載入範例</strong>
                <br>• 載入 flow-examples 中的任一 JSON 檔案
                <br>• 對載入的連線執行選擇和刪除測試
            </li>
        </ol>
    </div>
    
    <div class="test-info warning">
        <h3>⚠️ 注意事項：</h3>
        <ul>
            <li><strong>連線顏色說明</strong>：
                <ul>
                    <li>灰色 (#666) = 正常狀態</li>
                    <li>紅色 (#ff4444) = 滑鼠懸停狀態</li>
                    <li>藍色 (#2196F3) = 選中狀態</li>
                </ul>
            </li>
            <li><strong>操作方式</strong>：點擊連線選擇 → 點擊 ✕ 按鈕或按 Delete 鍵刪除</li>
            <li><strong>取消選擇</strong>：點擊空白處、節點或其他連線</li>
        </ul>
    </div>
    
    <div class="test-info">
        <h3>🔧 技術修復詳情：</h3>
        <ul>
            <li><code>selectConnection()</code> - 新的連線選擇系統，支援視覺回饋</li>
            <li><code>showConnectionDeleteButton()</code> - 動態顯示刪除按鈕在連線中間</li>
            <li><code>deselectAllConnections()</code> - 統一的取消選擇管理</li>
            <li><strong>鍵盤支援</strong> - Delete/Backspace 鍵刪除選中的連線</li>
            <li><strong>事件整合</strong> - 點擊空白處或節點自動取消連線選擇</li>
        </ul>
    </div>
    
    <button onclick="window.open('index.html', '_blank')">🚀 開啟 WCS Flow Designer</button>
    <button onclick="window.open('test_canvas_interactions.html', '_blank')">🎨 Canvas 交互測試</button>
    
    <div class="test-info">
        <h3>📝 預期結果：</h3>
        <ul>
            <li>✅ 點擊連線變藍色 (選中狀態)</li>
            <li>✅ 選中後顯示紅色 ✕ 刪除按鈕</li>
            <li>✅ 點擊 ✕ 按鈕成功刪除連線</li>
            <li>✅ Delete/Backspace 鍵刪除功能正常</li>
            <li>✅ 點擊空白處取消選擇</li>
            <li>✅ 無 JavaScript 錯誤</li>
            <li>✅ 動態連接埠正確更新 (針對 AND 閘)</li>
        </ul>
    </div>
    
    <div class="test-info">
        <h3>🐛 如果仍有問題：</h3>
        <p>請檢查 F12 開發者工具的 Console 面板，記錄任何錯誤訊息。修復程式包含了額外的調試輸出來幫助診斷問題。</p>
    </div>
</body>
</html>