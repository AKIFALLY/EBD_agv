<!DOCTYPE html>
<html>
<head>
    <title>å‹•æ…‹å‡½æ•¸é…ç½®æ¼”ç¤º</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .demo-section { 
            display: flex; 
            gap: 20px; 
            margin: 20px 0;
            min-height: 500px;
        }
        
        .functions-panel {
            width: 300px;
            background: #2d2d2d;
            color: white;
            padding: 20px;
            border-radius: 8px;
            overflow-y: auto;
        }
        
        .config-panel {
            flex: 1;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #007bff;
        }
        
        .function-item {
            background: #3a3a3a;
            margin: 10px 0;
            padding: 15px;
            border-radius: 6px;
            cursor: pointer;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
        }
        
        .function-item:hover {
            background: #4a4a4a;
            border-left-color: #2980b9;
        }
        
        .function-item.selected {
            background: #2980b9;
            border-left-color: #f39c12;
        }
        
        .function-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .function-desc {
            font-size: 12px;
            color: #bdc3c7;
        }
        
        .param-config {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .param-label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .param-input, .param-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .param-type {
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            margin-left: 10px;
        }
        
        .required-mark {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .generated-code {
            background: #2d2d2d;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin-top: 20px;
        }
        
        .section-title {
            background: #34495e;
            color: white;
            padding: 10px 15px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
        }
        
        button {
            background: #3498db;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .test-btn {
            background: #27ae60;
        }
        
        .test-btn:hover {
            background: #229954;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å‹•æ…‹å‡½æ•¸é…ç½®æ¼”ç¤º</h1>
        <p>å±•ç¤ºå¦‚ä½•å¾Pythonå‡½æ•¸è‡ªå‹•ç”Ÿæˆåƒæ•¸é…ç½®ç•Œé¢</p>
        
        <div class="demo-section">
            <!-- å‡½æ•¸åˆ—è¡¨é¢æ¿ -->
            <div class="functions-panel">
                <div class="section-title">ğŸ“š å¯ç”¨å‡½æ•¸</div>
                
                <h3 style="color: #3498db; margin: 20px 0 10px 0;">æ¢ä»¶å‡½æ•¸</h3>
                <div class="function-item" onclick="selectFunction('condition', 0)">
                    <div class="function-name">check_room_carrier</div>
                    <div class="function-desc">æª¢æŸ¥æˆ¿é–“å…§æ˜¯å¦æœ‰è¼‰é«”</div>
                </div>
                
                <div class="function-item" onclick="selectFunction('condition', 1)">
                    <div class="function-name">check_rack_position</div>
                    <div class="function-desc">æª¢æŸ¥è²¨æ¶ä½ç½®ç‹€æ…‹</div>
                </div>
                
                <h3 style="color: #e74c3c; margin: 20px 0 10px 0;">å‹•ä½œå‡½æ•¸</h3>
                <div class="function-item" onclick="selectFunction('action', 0)">
                    <div class="function-name">create_transport_task</div>
                    <div class="function-desc">å‰µå»ºé‹è¼¸ä»»å‹™</div>
                </div>
                
                <div class="function-item" onclick="selectFunction('action', 1)">
                    <div class="function-name">submit_mission</div>
                    <div class="function-desc">æäº¤ä»»å‹™åˆ°WCSç³»çµ±</div>
                </div>
            </div>
            
            <!-- åƒæ•¸é…ç½®é¢æ¿ -->
            <div class="config-panel">
                <div class="section-title">âš™ï¸ å‡½æ•¸åƒæ•¸é…ç½®</div>
                
                <div id="functionConfig">
                    <p style="color: #7f8c8d; text-align: center; margin-top: 50px;">
                        ğŸ‘ˆ è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹å‡½æ•¸ä¾†é…ç½®åƒæ•¸
                    </p>
                </div>
                
                <div id="generatedCode" class="generated-code" style="display: none;">
                    <!-- ç”Ÿæˆçš„Pythonä»£ç¢¼å°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="loadFromFile()">ğŸ“ å¾æª”æ¡ˆè¼‰å…¥å‡½æ•¸</button>
            <button onclick="exportConfig()">ğŸ’¾ å°å‡ºé…ç½®</button>
            <button class="test-btn" onclick="testFunction()">ğŸ§ª æ¸¬è©¦å‡½æ•¸èª¿ç”¨</button>
        </div>
    </div>

    <script>
        // æ¨¡æ“¬å‡½æ•¸é…ç½®æ•¸æ“š
        const functionsConfig = {
            condition_functions: [
                {
                    value: "check_room_carrier",
                    label: "Check Room Carrier",
                    description: "æª¢æŸ¥æˆ¿é–“å…§æ˜¯å¦æœ‰è¼‰é«”",
                    module: "wcs.conditions",
                    parameters: [
                        {
                            name: "room_id",
                            type: "str",
                            required: true,
                            label: "æˆ¿é–“ç·¨è™Ÿ",
                            options: ["01", "02", "03", "04", "05", "FOR_LOOP"]
                        },
                        {
                            name: "check_exists",
                            type: "bool",
                            required: false,
                            label: "æª¢æŸ¥å­˜åœ¨",
                            default: true,
                            options: [true, false]
                        }
                    ]
                },
                {
                    value: "check_rack_position",
                    label: "Check Rack Position",
                    description: "æª¢æŸ¥è²¨æ¶ä½ç½®ç‹€æ…‹",
                    module: "wcs.conditions",
                    parameters: [
                        {
                            name: "room_id",
                            type: "str",
                            required: true,
                            label: "æˆ¿é–“ç·¨è™Ÿ",
                            options: ["01", "02", "03", "04", "05", "FOR_LOOP"]
                        },
                        {
                            name: "position",
                            type: "str",
                            required: true,
                            label: "ä½ç½®é¡å‹",
                            options: ["inlet", "outlet"]
                        },
                        {
                            name: "rack_side",
                            type: "str",
                            required: false,
                            label: "è²¨æ¶é¢",
                            default: "A",
                            options: ["A", "B"]
                        }
                    ]
                }
            ],
            action_functions: [
                {
                    value: "create_transport_task",
                    label: "Create Transport Task",
                    description: "å‰µå»ºé‹è¼¸ä»»å‹™",
                    module: "wcs.tasks",
                    parameters: [
                        {
                            name: "robot_model",
                            type: "str",
                            required: true,
                            label: "æ©Ÿå™¨äººå‹è™Ÿ",
                            options: ["KUKA400i", "cargo", "loader", "unloader"]
                        },
                        {
                            name: "source",
                            type: "str",
                            required: true,
                            label: "ä¾†æºä½ç½®",
                            placeholder: "ä¾‹å¦‚: room_01_exit"
                        },
                        {
                            name: "destination",
                            type: "str",
                            required: true,
                            label: "ç›®æ¨™ä½ç½®",
                            placeholder: "ä¾‹å¦‚: collection_area"
                        },
                        {
                            name: "task_type",
                            type: "str",
                            required: false,
                            label: "ä»»å‹™é¡å‹",
                            default: "RACK_MOVE",
                            options: ["RACK_MOVE", "RACK_ROTATION", "CARRIER_TRANSPORT"]
                        }
                    ]
                },
                {
                    value: "submit_mission",
                    label: "Submit Mission",
                    description: "æäº¤ä»»å‹™åˆ°WCSç³»çµ±",
                    module: "wcs.api",
                    parameters: [
                        {
                            name: "mission_data",
                            type: "dict",
                            required: true,
                            label: "ä»»å‹™æ•¸æ“š",
                            description: "å¾ä¸Šæ¸¸ç¯€é»ç²å–"
                        },
                        {
                            name: "priority",
                            type: "int",
                            required: false,
                            label: "å„ªå…ˆç´š",
                            default: 1,
                            options: [1, 2, 3, 4, 5]
                        }
                    ]
                }
            ]
        };

        let currentFunction = null;
        let currentParams = {};

        function selectFunction(category, index) {
            // ç§»é™¤æ‰€æœ‰é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.function-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // æ·»åŠ é¸ä¸­ç‹€æ…‹
            event.target.closest('.function-item').classList.add('selected');
            
            // ç²å–å‡½æ•¸é…ç½®
            const functions = category === 'condition' ? 
                functionsConfig.condition_functions : 
                functionsConfig.action_functions;
            
            currentFunction = functions[index];
            currentParams = {};
            
            // ç”Ÿæˆåƒæ•¸é…ç½®ç•Œé¢
            generateParameterConfig();
        }

        function generateParameterConfig() {
            const container = document.getElementById('functionConfig');
            
            let html = `
                <h3>${currentFunction.label}</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">${currentFunction.description}</p>
                <div style="background: #e8f4fd; padding: 10px; border-radius: 4px; margin-bottom: 20px;">
                    <strong>æ¨¡çµ„:</strong> ${currentFunction.module || 'wcs.functions'}
                </div>
            `;

            currentFunction.parameters.forEach((param, index) => {
                html += generateParameterInput(param, index);
            });

            html += `
                <div style="margin-top: 20px;">
                    <button onclick="generatePythonCode()">ğŸ ç”ŸæˆPythonä»£ç¢¼</button>
                    <button onclick="validateParameters()">âœ… é©—è­‰åƒæ•¸</button>
                </div>
            `;

            container.innerHTML = html;
        }

        function generateParameterInput(param, index) {
            const isRequired = param.required ? '<span class="required-mark">*</span>' : '';
            const typeTag = `<span class="param-type">${param.type}</span>`;
            
            let inputHtml = '';
            
            if (param.options && param.options.length > 0) {
                // ä¸‹æ‹‰é¸å–®
                const options = param.options.map(opt => 
                    `<option value="${opt}" ${param.default === opt ? 'selected' : ''}>${opt}</option>`
                ).join('');
                
                inputHtml = `
                    <select class="param-select" onchange="updateParameter('${param.name}', this.value)" id="param_${index}">
                        <option value="">è«‹é¸æ“‡...</option>
                        ${options}
                    </select>
                `;
            } else if (param.type === 'bool') {
                // å¸ƒæ—é¸æ“‡
                inputHtml = `
                    <select class="param-select" onchange="updateParameter('${param.name}', this.value)" id="param_${index}">
                        <option value="">è«‹é¸æ“‡...</option>
                        <option value="true" ${param.default === true ? 'selected' : ''}>True</option>
                        <option value="false" ${param.default === false ? 'selected' : ''}>False</option>
                    </select>
                `;
            } else {
                // æ–‡å­—è¼¸å…¥
                const placeholder = param.placeholder || `è¼¸å…¥${param.label}`;
                const defaultValue = param.default || '';
                
                inputHtml = `
                    <input type="text" class="param-input" 
                           placeholder="${placeholder}" 
                           value="${defaultValue}"
                           onchange="updateParameter('${param.name}', this.value)" 
                           id="param_${index}">
                `;
            }

            return `
                <div class="param-config">
                    <div class="param-label">
                        ${param.label} ${typeTag} ${isRequired}
                    </div>
                    ${inputHtml}
                    ${param.description ? `<div style="font-size: 11px; color: #7f8c8d; margin-top: 5px;">${param.description}</div>` : ''}
                </div>
            `;
        }

        function updateParameter(paramName, value) {
            currentParams[paramName] = value;
            console.log('Updated parameter:', paramName, '=', value);
        }

        function generatePythonCode() {
            if (!currentFunction) {
                alert('è«‹å…ˆé¸æ“‡ä¸€å€‹å‡½æ•¸');
                return;
            }

            // ç”Ÿæˆå‡½æ•¸èª¿ç”¨ä»£ç¢¼
            const modulePath = currentFunction.module || 'wcs.functions';
            const functionName = currentFunction.value;
            
            let paramsList = [];
            currentFunction.parameters.forEach(param => {
                const value = currentParams[param.name] || param.default;
                if (value !== undefined && value !== '') {
                    if (param.type === 'str') {
                        paramsList.push(`${param.name}="${value}"`);
                    } else if (param.type === 'bool') {
                        paramsList.push(`${param.name}=${value === 'true' ? 'True' : 'False'}`);
                    } else {
                        paramsList.push(`${param.name}=${value}`);
                    }
                }
            });

            const pythonCode = `# å°å…¥æ¨¡çµ„
from ${modulePath} import ${functionName}

# å‡½æ•¸èª¿ç”¨
result = ${functionName}(
    ${paramsList.join(',\n    ')}
)

# è™•ç†çµæœ
if result:
    print(f"å‡½æ•¸åŸ·è¡ŒæˆåŠŸ: {result}")
    # åœ¨é€™è£¡æ·»åŠ å¾ŒçºŒé‚è¼¯
else:
    print("å‡½æ•¸åŸ·è¡Œå¤±è´¥")
    # åœ¨é€™è£¡æ·»åŠ éŒ¯èª¤è™•ç†é‚è¼¯`;

            const codeContainer = document.getElementById('generatedCode');
            codeContainer.textContent = pythonCode;
            codeContainer.style.display = 'block';
        }

        function validateParameters() {
            if (!currentFunction) {
                alert('è«‹å…ˆé¸æ“‡ä¸€å€‹å‡½æ•¸');
                return;
            }

            const missingRequired = [];
            currentFunction.parameters.forEach(param => {
                if (param.required && (!currentParams[param.name] || currentParams[param.name] === '')) {
                    missingRequired.push(param.label);
                }
            });

            if (missingRequired.length > 0) {
                alert('ç¼ºå°‘å¿…è¦åƒæ•¸: ' + missingRequired.join(', '));
                return;
            }

            alert('âœ… åƒæ•¸é©—è­‰é€šéï¼');
        }

        function loadFromFile() {
            alert('åŠŸèƒ½æ¼”ç¤ºï¼šé€™è£¡å¯ä»¥è¼‰å…¥Pythonæª”æ¡ˆä¸¦è‡ªå‹•è§£æå‡½æ•¸');
        }

        function exportConfig() {
            const config = {
                function: currentFunction,
                parameters: currentParams
            };
            
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'function-config.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function testFunction() {
            if (!currentFunction) {
                alert('è«‹å…ˆé¸æ“‡ä¸€å€‹å‡½æ•¸');
                return;
            }
            
            alert('ğŸ§ª æ¸¬è©¦åŠŸèƒ½æ¼”ç¤º\n\né€™è£¡å¯ä»¥:\n1. æ¨¡æ“¬å‡½æ•¸èª¿ç”¨\n2. æª¢æŸ¥åƒæ•¸æœ‰æ•ˆæ€§\n3. è¿”å›æ¸¬è©¦çµæœ\n4. é¡¯ç¤ºåŸ·è¡Œæ—¥èªŒ');
        }

        // åˆå§‹åŒ–ï¼šé¸æ“‡ç¬¬ä¸€å€‹å‡½æ•¸
        window.onload = function() {
            setTimeout(() => {
                selectFunction('condition', 0);
            }, 500);
        };
    </script>
</body>
</html>