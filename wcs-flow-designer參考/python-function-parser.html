<!DOCTYPE html>
<html>
<head>
    <title>Pythonå‡½æ•¸è‡ªå‹•è§£æå™¨</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .section { background: #f8f9fa; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #007bff; }
        .upload-area {
            border: 2px dashed #007bff;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            background: #e9ecef;
            border-color: #0056b3;
        }
        .function-list {
            background: #2d2d2d;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .function-item {
            background: #3a3a3a;
            margin: 8px 0;
            padding: 12px;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }
        .function-name {
            color: #e74c3c;
            font-weight: bold;
            font-size: 14px;
        }
        .function-params {
            color: #f39c12;
            margin: 5px 0;
        }
        .function-docstring {
            color: #95a5a6;
            font-style: italic;
            margin: 5px 0;
            font-size: 11px;
        }
        .param-item {
            background: #4a4a4a;
            display: inline-block;
            padding: 3px 8px;
            margin: 2px;
            border-radius: 3px;
            font-size: 10px;
        }
        .param-type {
            color: #27ae60;
        }
        .param-default {
            color: #f39c12;
        }
        button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        .demo-python {
            background: #2d2d2d;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .config-output {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ Pythonå‡½æ•¸è‡ªå‹•è§£æå™¨</h1>
        
        <div class="section">
            <h2>ğŸ“ å‡½æ•¸æª”æ¡ˆä¸Šå‚³</h2>
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <h3>ğŸ“¤ é»æ“Šä¸Šå‚³Pythonæª”æ¡ˆ</h3>
                <p>æ”¯æ´ .py æª”æ¡ˆï¼Œå°‡è‡ªå‹•è§£ææ‰€æœ‰å‡½æ•¸å’Œåƒæ•¸</p>
                <input type="file" id="fileInput" accept=".py" style="display: none;" onchange="parseUploadedFile(event)">
            </div>
            
            <button onclick="loadDemoFunctions()">ğŸ“‹ è¼‰å…¥ç¤ºç¯„å‡½æ•¸</button>
            <button onclick="parsePythonCode()">ğŸ” è§£æPythonä»£ç¢¼</button>
        </div>
        
        <div class="section">
            <h2>ğŸ“ ç¤ºç¯„Pythonä»£ç¢¼</h2>
            <div class="demo-python" id="demoPython">
# WCSæ¢ä»¶æª¢æŸ¥å‡½æ•¸
def check_room_carrier(room_id: str, check_exists: bool = True) -> bool:
    """æª¢æŸ¥æˆ¿é–“å…§æ˜¯å¦æœ‰è¼‰é«”
    
    Args:
        room_id: æˆ¿é–“ç·¨è™Ÿ (01-05)
        check_exists: æª¢æŸ¥æ˜¯å¦å­˜åœ¨ï¼ŒFalseç‚ºæª¢æŸ¥ä¸å­˜åœ¨
    
    Returns:
        bool: è¼‰é«”å­˜åœ¨ç‹€æ…‹
    """
    # å¯¦éš›å¯¦ç¾é‚è¼¯
    return True

def check_rack_position(room_id: str, position: str, rack_side: str = "A") -> dict:
    """æª¢æŸ¥è²¨æ¶ä½ç½®ç‹€æ…‹
    
    Args:
        room_id: æˆ¿é–“ç·¨è™Ÿ
        position: ä½ç½®é¡å‹ (inlet/outlet)  
        rack_side: è²¨æ¶é¢ (A/B)
    
    Returns:
        dict: è²¨æ¶ç‹€æ…‹ä¿¡æ¯
    """
    return {"status": "occupied", "rack_id": "R001"}

# WCSä»»å‹™å‰µå»ºå‡½æ•¸
def create_transport_task(robot_model: str, source: str, destination: str, 
                         task_type: str = "RACK_MOVE", timeout: int = 30) -> str:
    """å‰µå»ºé‹è¼¸ä»»å‹™
    
    Args:
        robot_model: æ©Ÿå™¨äººå‹è™Ÿ (KUKA400i/cargo/loader/unloader)
        source: ä¾†æºä½ç½®
        destination: ç›®æ¨™ä½ç½®
        task_type: ä»»å‹™é¡å‹
        timeout: è¶…æ™‚æ™‚é–“(ç§’)
    
    Returns:
        str: ä»»å‹™ID
    """
    return "TASK_001"

def submit_mission(mission_data: dict, priority: int = 1) -> bool:
    """æäº¤ä»»å‹™åˆ°WCSç³»çµ±
    
    Args:
        mission_data: ä»»å‹™æ•¸æ“š
        priority: å„ªå…ˆç´š (1-10)
    
    Returns:
        bool: æäº¤æˆåŠŸç‹€æ…‹
    """
    return True
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ” è§£æçµæœ</h2>
            <div class="function-list" id="functionList">
                é»æ“Š "è§£æPythonä»£ç¢¼" æŸ¥çœ‹å‡½æ•¸åˆ—è¡¨...
            </div>
        </div>
        
        <div class="section">
            <h2>âš™ï¸ ç”Ÿæˆçš„WCSé…ç½®</h2>
            <div class="config-output" id="configOutput">
                è§£æå®Œæˆå¾Œå°‡é¡¯ç¤ºå¯ç”¨æ–¼WCS Flow Designerçš„é…ç½®...
            </div>
        </div>
        
        <button onclick="exportToWCSConfig()">ğŸ“¤ å°å‡ºWCSé…ç½®æª”</button>
        <button onclick="generateDropdownOptions()">ğŸ“‹ ç”Ÿæˆä¸‹æ‹‰é¸å–®é¸é …</button>
    </div>

    <script>
        let parsedFunctions = [];

        function parseUploadedFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById('demoPython').textContent = content;
                parsePythonCode();
            };
            reader.readAsText(file);
        }

        function loadDemoFunctions() {
            // ç¤ºç¯„å‡½æ•¸å·²ç¶“åœ¨HTMLä¸­ï¼Œç›´æ¥è§£æ
            parsePythonCode();
        }

        function parsePythonCode() {
            const pythonCode = document.getElementById('demoPython').textContent;
            parsedFunctions = parsePythonFromText(pythonCode);
            displayParsedFunctions();
        }

        function parsePythonFromText(code) {
            const functions = [];
            const lines = code.split('\n');
            
            let currentFunction = null;
            let inDocstring = false;
            let docstringContent = '';
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // æª¢æ¸¬å‡½æ•¸å®šç¾©
                const funcMatch = line.match(/^def\s+(\w+)\s*\((.*?)\)\s*(?:->\s*(.+?))?\s*:/);
                if (funcMatch) {
                    if (currentFunction) {
                        functions.push(currentFunction);
                    }
                    
                    currentFunction = {
                        name: funcMatch[1],
                        params: parseParameters(funcMatch[2]),
                        returnType: funcMatch[3] ? funcMatch[3].trim() : 'Any',
                        docstring: '',
                        category: 'custom'
                    };
                    continue;
                }
                
                // æª¢æ¸¬docstring
                if (currentFunction && line.startsWith('"""')) {
                    if (inDocstring) {
                        currentFunction.docstring = docstringContent.trim();
                        inDocstring = false;
                        docstringContent = '';
                    } else {
                        inDocstring = true;
                        docstringContent = line.replace(/"""/g, '');
                    }
                    continue;
                }
                
                if (inDocstring) {
                    docstringContent += ' ' + line;
                }
                
                // å¦‚æœé‡åˆ°æ–°çš„å‡½æ•¸æˆ–éç¸®æ’è¡Œï¼ŒçµæŸç•¶å‰å‡½æ•¸
                if (currentFunction && line && !line.startsWith(' ') && !line.startsWith('\t') && !line.startsWith('#')) {
                    if (!line.startsWith('def ')) {
                        functions.push(currentFunction);
                        currentFunction = null;
                    }
                }
            }
            
            // æ·»åŠ æœ€å¾Œä¸€å€‹å‡½æ•¸
            if (currentFunction) {
                functions.push(currentFunction);
            }
            
            return functions;
        }

        function parseParameters(paramString) {
            if (!paramString.trim()) return [];
            
            const params = [];
            const paramParts = paramString.split(',');
            
            paramParts.forEach(part => {
                part = part.trim();
                if (!part) return;
                
                const param = {
                    name: '',
                    type: 'Any',
                    default: null,
                    required: true
                };
                
                // è™•ç†é»˜èªå€¼
                let [nameType, defaultValue] = part.split('=').map(s => s.trim());
                if (defaultValue !== undefined) {
                    param.default = defaultValue;
                    param.required = false;
                }
                
                // è™•ç†é¡å‹è¨»è§£
                if (nameType.includes(':')) {
                    const [name, type] = nameType.split(':').map(s => s.trim());
                    param.name = name;
                    param.type = type;
                } else {
                    param.name = nameType;
                }
                
                params.push(param);
            });
            
            return params;
        }

        function displayParsedFunctions() {
            const container = document.getElementById('functionList');
            
            if (parsedFunctions.length === 0) {
                container.innerHTML = '<div style="color: #e74c3c;">æœªæ‰¾åˆ°å‡½æ•¸å®šç¾©</div>';
                return;
            }
            
            let html = `<div style="color: #3498db; font-weight: bold; margin-bottom: 15px;">
                        æ‰¾åˆ° ${parsedFunctions.length} å€‹å‡½æ•¸ï¼š
                       </div>`;
            
            parsedFunctions.forEach(func => {
                html += `
                    <div class="function-item">
                        <div class="function-name">${func.name}()</div>
                        <div class="function-docstring">${func.docstring || 'ç„¡æè¿°'}</div>
                        <div class="function-params">
                            <strong>åƒæ•¸:</strong>
                            ${func.params.map(p => 
                                `<span class="param-item">
                                    ${p.name}: <span class="param-type">${p.type}</span>
                                    ${p.default !== null ? ` = <span class="param-default">${p.default}</span>` : ''}
                                    ${p.required ? ' <strong>*</strong>' : ''}
                                </span>`
                            ).join('')}
                        </div>
                        <div style="color: #27ae60; margin-top: 5px;">
                            <strong>è¿”å›:</strong> ${func.returnType}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function generateDropdownOptions() {
            const conditionFunctions = parsedFunctions.filter(f => 
                f.name.includes('check') || f.name.includes('verify') || f.returnType === 'bool'
            );
            
            const actionFunctions = parsedFunctions.filter(f => 
                f.name.includes('create') || f.name.includes('submit') || f.name.includes('execute')
            );
            
            const config = {
                condition_functions: conditionFunctions.map(f => ({
                    value: f.name,
                    label: f.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                    description: f.docstring.split('.')[0] || f.name,
                    parameters: f.params.map(p => ({
                        name: p.name,
                        type: p.type,
                        required: p.required,
                        default: p.default,
                        options: generateParameterOptions(p)
                    }))
                })),
                action_functions: actionFunctions.map(f => ({
                    value: f.name,
                    label: f.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                    description: f.docstring.split('.')[0] || f.name,
                    parameters: f.params.map(p => ({
                        name: p.name,
                        type: p.type,
                        required: p.required,
                        default: p.default,
                        options: generateParameterOptions(p)
                    }))
                }))
            };
            
            document.getElementById('configOutput').innerHTML = 
                '<pre>' + JSON.stringify(config, null, 2) + '</pre>';
        }

        function generateParameterOptions(param) {
            // æ ¹æ“šåƒæ•¸åç¨±å’Œé¡å‹ç”Ÿæˆé¸é …
            const options = [];
            
            if (param.name.includes('room') && param.name.includes('id')) {
                return ['01', '02', '03', '04', '05', 'FOR_LOOP'];
            }
            
            if (param.name.includes('robot') && param.name.includes('model')) {
                return ['KUKA400i', 'cargo', 'loader', 'unloader'];
            }
            
            if (param.name === 'position') {
                return ['inlet', 'outlet'];
            }
            
            if (param.name.includes('rack') && param.name.includes('side')) {
                return ['A', 'B'];
            }
            
            if (param.name.includes('task') && param.name.includes('type')) {
                return ['RACK_MOVE', 'RACK_ROTATION', 'CARRIER_TRANSPORT'];
            }
            
            if (param.type === 'bool') {
                return [true, false];
            }
            
            return null; // ç„¡é å®šé¸é …ï¼Œä½¿ç”¨æ–‡å­—è¼¸å…¥
        }

        function exportToWCSConfig() {
            generateDropdownOptions();
            
            const config = JSON.parse(document.getElementById('configOutput').textContent);
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wcs-functions-config.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('WCSå‡½æ•¸é…ç½®æª”å·²å°å‡ºï¼');
        }

        // åˆå§‹åŒ–è¼‰å…¥ç¤ºç¯„å‡½æ•¸
        window.onload = function() {
            loadDemoFunctions();
        };
    </script>
</body>
</html>