# Rack 管理操作手冊

## 📋 文件資訊
- **版本**: 1.1
- **更新日期**: 2025-09-23
- **適用對象**: 現場操作人員、生產管理人員
- **系統版本**: RosAGV 2.0 (手動 Rack 管理模式)
- **系統狀態**: ⚠️ 部分功能待開發（詳見系統限制章節）

## 🎯 使用場景
本手冊提供現場人員操作 OPUI 和 OPUI-HMI 系統管理 Rack 的詳細步驟，包括：
- 射出機區域的空 Rack 加入操作
- 人工收料區的 Rack 移出操作
- 異常情況處理流程
- 日常維護和監控

## ⚠️ 前提條件 - 設備授權

### 設備授權要求
使用 OPUI 或 OPUI-HMI 系統前，您的設備必須具有有效的授權：

**操作員工作站 (OPUI)**：
- 設備類型：`op_station`
- 需要授權的 device_id（16位字元）
- 權限包含：呼叫 AGV、查看任務、建立任務

**HMI 終端 (OPUI-HMI)**：
- 設備類型：`hmi_terminal`
- 需要授權的 device_id（16位字元）
- 權限包含：管理指定位置的 Rack、執行移出操作

### 授權狀態檢查
如果您的設備未獲授權，系統將顯示：
- 「設備未授權」錯誤訊息
- 無法進入操作介面
- 請聯繫系統管理員申請授權

### 取得設備授權
1. 記錄您的設備 ID（通常顯示在平板背面標籤）
2. 聯繫系統管理員提供設備 ID
3. 等待管理員在系統中建立授權記錄
4. 授權生效後即可正常使用系統

## 📱 OPUI 操作指南

### 1. 射出機區域 - 加入空 Rack

#### 準備工作
1. **確認空 Rack 可用性**
   - 檢查倉儲區是否有可用的空 Rack
   - 確認 Rack 編號標籤清晰可讀
   - 檢查 Rack 結構完整無損壾

2. **搬運空 Rack**
   - 作業員使用手推車或人工搬運空 Rack
   - ⚠️ **系統限制**：目前系統只支援停車格，尚未實作工作區功能
   - **當前作法**：直接將 Rack 放置到停車格位置
   - **未來規劃**：支援工作區 A 和 B 的管理
   - 確保 Rack 擺放平穩、方向正確

#### 操作步驟

##### Step 1: 開啟 OPUI 平板
```
位置：射出機操作台旁（兩位作業員共用一個平板）
登入：使用操作員工號和密碼
介面：平板畫面分為左右兩區，分別對應兩位作業員
```

##### Step 2: 使用首頁「加入料架」功能
```
OPUI 首頁會顯示左右兩側的「加入料架」按鈕
平板分為左右兩個操作區域，對應兩位作業員共用
```

📌 **系統現況**（實際介面）:
- 左半邊（作業員 1）：
  - [🏭 加入料架] - 目前直接加入到停車格 1
- 右半邊（作業員 2）：
  - [🏭 加入料架] - 目前直接加入到停車格 2

⚠️ **系統限制**:
- 目前每側只有一個「加入料架」按鈕（不是 A 和 B 兩個）
- 系統會直接將 Rack 分配到對應的停車格
- 工作區 A/B 自動偵測功能尚未實作

##### Step 3: 選擇對應的按鈕
```
📌 當前操作方式：
作業員 1（使用平板左半邊）：
- 點擊左半邊的「加入料架」按鈕
- 系統自動將 Rack 加入到停車格 1

作業員 2（使用平板右半邊）：
- 點擊右半邊的「加入料架」按鈕
- 系統自動將 Rack 加入到停車格 2

⚠️ 重要：兩位作業員共用一個平板，各使用自己負責的半邊
```

##### Step 4: 選擇 Rack 編號
```
1. 彈出選擇視窗
2. 從下拉選單選擇 Rack 編號：
   範例：101, 102, 103...
   (系統只會顯示 location=null 的 Rack)

3. 確認資訊：
   檢查選擇的編號是否正確
```

##### Step 5: 提交並確認
```
點選【確認加入】按鈕
等待系統回應（約 2-3 秒）
```

##### Step 6: 檢查結果
✅ **成功訊息**：
```
「Rack 101 已成功加入系統」
當前顯示：「已分配至停車格 1」 或 「已分配至停車格 2」
（未來將支援：「已分配至工作區 A」 或 「已分配至工作區 B」）
```

❌ **失敗訊息及處理**：
| 錯誤訊息 | 可能原因 | 處理方法 |
|---------|---------|---------|
| Rack 已存在於系統 | 該 Rack 已有 location | 該 Rack 不在可選清單中 |
| 沒有可用 Rack | 所有 Rack 都在系統內 | 等待其他 Rack 移出 |
| 網路連線失敗 | 平板與系統斷線 | 檢查 WiFi 連線 |

### 2. 故障排除 - 加入 Rack

#### 常見問題 Q&A

**Q1: 掃描 Rack 編號時無法識別？**
```
A: 解決步驟
1. 清潔條碼標籤
2. 調整掃描角度和距離
3. 手動輸入編號
4. 若持續失敗，聯繫維護人員
```

**Q2: 下拉選單中沒有可選的 Rack？**
```
A: 解決步驟
1. 確認倉儲區是否有 location=null 的 Rack
2. 檢查 AGVCUI 是否已建立該 Rack 資料
3. 等待其他 Rack 從系統移出
4. 聯繫系統管理員建立新 Rack
```

**Q3: 加入後如何派送到房間？**
```
A: 操作步驟（當前流程）
1. 確認 Rack 已成功加入停車格
2. 在 Rack 上放置產品
3. 使用 OPUI 「派滿車」功能（如果有）
4. KUKA AGV 從停車格取貨
5. 由 Cargo AGV 送入房間處理

注意：目前系統直接使用停車格，未來將支援工作區流程
```

## 🖥️ OPUI-HMI 操作指南

### 1. 人工收料區 - 移出 Rack

#### 準備工作
1. **完成收料作業**
   - 確認所有 carrier 已取出
   - 檢查 Rack 內無遺留物品
   - 記錄收料數量和狀態

2. **準備搬運**
   - 確認倉儲區存放位置
   - 準備搬運工具（如需要）

#### 操作步驟

##### Step 1: 開啟 OPUI-HMI 介面
```
位置：人工收料區工作站
登入：使用收料員工號和密碼
```

##### Step 2: 進入人工收料區管理
```
主介面 → 點選【人工收料區管理】
```
功能選項：
- 📥 收料登記
- 📤 **Rack 管理** ← 選擇此項
- 📊 收料統計

##### Step 3: 選擇要移出的 Rack
```
1. 查看當前收料區 Rack 列表
2. 找到已完成收料的 Rack
3. 點選該 Rack 的選擇框
```

Rack 列表顯示資訊：
| Rack ID | 位置 | 狀態 | Carrier 數 | 操作 |
|---------|------|------|-----------|------|
| 101 | M-51 | 已收料 | 0 | [移出] |
| 102 | M-52 | 收料中 | 3 | [--] |
| 103 | M-53 | 已收料 | 0 | [移出] |

##### Step 4: 執行移出操作
```
點選【移出系統】按鈕
```

##### Step 5: 確認移出
```
系統提示：
「確定要將 Rack 101 移出系統嗎？」
「移出後 location 將設為 null」

點選【確定】繼續
點選【取消】放棄操作
```

##### Step 6: 檢查結果
✅ **成功訊息**：
```
「Rack 101 已成功移出系統」
「請將 Rack 搬運至倉儲區」
```

##### Step 7: 實體搬運
1. 將空 Rack 從收料區搬出
2. 運送至指定倉儲區域
3. 按照倉儲規則擺放整齊
4. 更新倉儲區 Rack 數量記錄

### 2. 故障排除 - 移出 Rack

#### 常見問題 Q&A

**Q1: 顯示「Rack 仍有 Carrier」無法移出？**
```
A: 解決步驟
1. 重新檢查 Rack 內部
2. 在系統中查詢 Carrier 狀態
3. 手動清除系統中的 Carrier 記錄
4. 聯繫系統管理員處理資料異常
```

**Q2: 移出後發現還需要使用該 Rack？**
```
A: 恢復步驟
1. 立即停止實體搬運
2. 重新執行「加入 Rack」流程
3. 等待系統重新分配 location_id
4. 繼續原定作業
```

**Q3: 網路斷線導致操作中斷？**
```
A: 處理方法
1. 等待網路恢復
2. 重新登入 OPUI-HMI
3. 檢查 Rack 當前狀態
4. 若狀態不明，查詢資料庫確認
```

## 🚨 OCR NG 即時處理流程

### OCR NG 檢測後的即時處理

#### 當 Cargo AGV 在房間入口偵測到 OCR NG 時

##### Step 1: 接收 PLC Alarm 通知
```
通知來源：
- PLC 發出 Alarm 到 HMI 顯示
- 系統警報聲音
- 現場警示燈（如有配置）
```

##### Step 2: 前往房間入口現場
```
1. 查看 HMI 顯示的 Alarm 資訊
2. 記下房間編號和 Cargo AGV 位置
3. 攜帶必要工具：
   - 手套
   - 記錄表
4. 快速前往房間入口 Cargo AGV 停止位置
```

##### Step 3: 判斷並處理問題
```
1. 檢查 OCR NG 原因：
   ├── OCR 識別失敗（無法讀取）
   │   └── 檢查產品標籤是否模糊或損壞
   └── 產品不符合製程（錯誤產品）
       └── 確認產品是否適合當前房間製程

2. 處理方式：
   【OCR 識別失敗】
   - 清理或修復產品標籤
   - 確認標籤可讀性
   - 準備 Alarm Reset 重試

   【錯誤產品（製程不符）】
   - 移除錯誤的 Carrier
   - 前往 AGVCUI 清除該筆資料
   - 確認資料已清除
   - 準備 Alarm Reset
```

##### Step 4: 系統恢復
```
處理完成後：
1. 在 HMI 或控制面板上按下 Alarm Reset
2. Cargo AGV 自動重試或繼續執行
3. 確認系統恢復正常運作
4. 記錄處理過程和結果
```

##### 重要說明
```
⚠️ 所有 OCR NG 都必須當下立即處理
- 不會有 NG Rack 被送到其他區域
- 不存在事後集中處理的 NG 區
- 確保製程品質的即時管控
```

## 📊 日常監控和維護

### 1. 每日檢查項目

#### 早班開始（08:00）
- [ ] 檢查倉儲區空 Rack 數量
- [ ] 確認 OPUI 平板充電狀態
- [ ] 測試網路連線穩定性
- [ ] 查看前一天 NG 處理記錄

#### 班中檢查（每 2 小時）
- [ ] 監控系統中 Rack 分布
- [ ] 檢查 location=null 的 Rack 數量
- [ ] 確認無異常停滯的 Rack

#### 交班前（16:00/00:00）
- [ ] 統計當班 Rack 加入/移出數量
- [ ] 記錄異常事件和處理結果
- [ ] 清點倉儲區 Rack 實際數量
- [ ] 填寫交班記錄

### 2. 週期性維護

#### 每週維護
```
週一：
- 清潔所有 OPUI 平板螢幕
- 檢查 Rack 編號標籤完整性
- 測試所有功能按鈕

週三：
- 校驗系統 Rack 數量與實際數量
- 清理異常資料記錄

週五：
- 備份操作記錄
- 生成週報表
```

#### 每月維護
```
月初第一個工作日：
- 全面盤點 Rack 資產
- 檢查損壞 Rack 並標記維修
- 更新 Rack 編號對照表
- 優化倉儲區擺放佈局
```

## 📈 效能指標監控

### 關鍵指標
| 指標 | 目標值 | 監控頻率 | 負責人 |
|------|--------|----------|--------|
| Rack 加入響應時間 | < 5 秒 | 即時 | 操作員 |
| 每日 Rack 週轉率 | > 85% | 每日 | 班長 |
| location=null 比例 | < 20% | 每 4 小時 | 調度員 |
| NG 處理平均時間 | < 10 分鐘 | 每班 | 品管員 |

### 異常告警閾值
- **緊急**：location=null > 30%（系統外 Rack 過多）
- **警告**：Rack 加入失敗率 > 5%
- **注意**：單一停車格占用超過 2 小時

## 🔧 進階操作

### 批量操作（管理員權限）

#### 批量加入 Rack
```
適用場景：班次開始時需要加入多個 Rack

操作步驟：
1. OPUI → Rack 管理 → 批量操作
2. 選擇 Excel 檔案（格式：Rack_ID, Location）
3. 系統自動處理並顯示結果
4. 檢查失敗項目並手動處理
```

#### 批量移出 Rack
```
適用場景：班次結束清空收料區

操作步驟：
1. OPUI-HMI → 批量移出
2. 勾選所有已完成收料的 Rack
3. 確認批量移出
4. 系統自動更新 location=null
```

### 資料查詢和報表

#### 查詢 Rack 歷史
```
OPUI → 報表查詢 → Rack 軌跡

可查詢內容：
- Rack 移動路徑
- 狀態變更記錄
- 加入/移出時間
- 處理人員記錄
```

#### 生成統計報表
```
OPUI → 報表查詢 → 統計分析

報表類型：
- 日報：當日 Rack 使用統計
- 週報：週轉率趨勢分析
- 月報：Rack 資產盤點報告
```

## 📞 緊急聯絡

### 技術支援
- **系統故障**：IT 部門 分機 2345
- **網路問題**：網管中心 分機 2346
- **資料異常**：DBA 小組 分機 2347

### 現場支援
- **AGV 故障**：維護部門 分機 3456
- **Rack 損壞**：設備組 分機 3457
- **流程問題**：生產調度 分機 3458

### 緊急處理流程
```
發現問題 → 立即通報班長
         ↓
    嘗試標準處理流程
         ↓
    問題未解決？
         ↓
    聯繫技術支援
         ↓
    記錄問題和解決方案
```

## 📚 附錄

### A. 術語解釋
- **Rack**：料架，用於承載 Carrier 的框架
- **Carrier**：載具，裝載眼鏡產品的容器
- **location_id**：Rack 在系統中的位置識別碼
- **location=null**：Rack 不在系統管理中（在倉儲區）
- **工作區 A/B**：人工放置空 Rack 的區域
- **停車格 1/2**：KUKA AGV 停靠滿 Rack 的位置
- **OCR**：光學字符識別，用於檢測產品標識
- **NG**：Not Good，不良品

### B. 系統狀態代碼
| 代碼 | 含義 | 說明 |
|------|------|------|
| 200 | 成功 | 操作正常完成 |
| 400 | 參數錯誤 | 輸入資料有誤 |
| 404 | 找不到 | Rack 或位置不存在 |
| 409 | 衝突 | 資源已被占用 |
| 500 | 系統錯誤 | 內部錯誤，需技術支援 |

### C. 快速檢查清單

#### Rack 加入前檢查
- [ ] Rack 編號清晰可讀
- [ ] 結構完整無損壾
- [ ] 工作區 A 或 B 有空位
- [ ] Rack 在系統中是 location=null
- [ ] OPUI 網路正常
- [ ] 系統狀態正常

#### Rack 移出前檢查
- [ ] 所有 Carrier 已取出
- [ ] 收料記錄已完成
- [ ] 倉儲區有存放空間
- [ ] OPUI-HMI 登入正常
- [ ] 確認無後續使用需求

### D. 更新記錄
| 版本 | 日期 | 更新內容 | 更新人 |
|------|------|----------|--------|
| 1.0 | 2025-09-01 | 初版發布，手動 Rack 管理模式 | System |
| 1.1 | 2025-09-23 | 更正系統現況，標註待開發功能 | System |

### E. 系統限制和待開發功能

#### 當前系統限制
1. **工作區管理**：系統尚未實作工作區 A/B 的管理功能
2. **位置自動偵測**：無法自動偵測空的工作區
3. **資料庫欄位**：Machine 模型只有 parking_space_1 和 parking_space_2
4. **介面按鈕**：每側只有一個「加入料架」按鈕，非 A/B 分開

#### 待開發功能清單
- [ ] 資料庫新增 workspace_a_1, workspace_b_1, workspace_a_2, workspace_b_2 欄位
- [ ] 實作工作區空位偵測邏輯
- [ ] 支援 Rack 從工作區到停車格的流轉
- [ ] 完整的 6 個 location 管理（每台射出機）
- [ ] 更新 OPUI 介面支援工作區選擇

## 🔗 相關文檔
- 技術文檔：docs-ai/knowledge/system/manual-rack-management.md
- 業務流程：docs-ai/knowledge/business/eyewear-production-process.md
- WCS 設計：docs-ai/knowledge/agv-domain/wcs-system-design.md
- TAFL 規格：docs-ai/knowledge/system/tafl/tafl-language-specification.md