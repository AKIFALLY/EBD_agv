# è¨­å‚™æˆæ¬Šæ“ä½œæŒ‡å—

## ğŸ“‹ æ–‡ä»¶è³‡è¨Š
- **ç‰ˆæœ¬**: 1.0
- **å»ºç«‹æ—¥æœŸ**: 2025-09-19
- **é©ç”¨å°è±¡**: ç³»çµ±ç®¡ç†å“¡ã€IT äººå“¡ã€ç¾å ´ä¸»ç®¡
- **ç³»çµ±ç‰ˆæœ¬**: RosAGV 2.0

## ğŸ¯ é©ç”¨å ´æ™¯
æœ¬æŒ‡å—èªªæ˜ RosAGV ç³»çµ±çš„è¨­å‚™æˆæ¬Šæ©Ÿåˆ¶ï¼ŒåŒ…æ‹¬ï¼š
- è¨­å‚™æˆæ¬Šçš„æ¦‚å¿µå’Œé‡è¦æ€§
- å¦‚ä½•ç®¡ç†è¨­å‚™æˆæ¬Š
- æ¬Šé™é…ç½®èªªæ˜
- æ•…éšœæ’é™¤å’Œå¸¸è¦‹å•é¡Œ

## ğŸ“– è¨­å‚™æˆæ¬Šæ¦‚è¿°

### ä»€éº¼æ˜¯è¨­å‚™æˆæ¬Šï¼Ÿ
è¨­å‚™æˆæ¬Šæ˜¯ RosAGV ç³»çµ±çš„å®‰å…¨æ©Ÿåˆ¶ï¼Œç¢ºä¿åªæœ‰ç¶“éèªè­‰çš„è¨­å‚™æ‰èƒ½å­˜å–ç³»çµ±åŠŸèƒ½ã€‚æ¯å€‹è¨­å‚™éƒ½éœ€è¦ä¸€å€‹å”¯ä¸€çš„ device_id å’Œå°æ‡‰çš„æˆæ¬Šè¨˜éŒ„ã€‚

### ç‚ºä»€éº¼éœ€è¦è¨­å‚™æˆæ¬Šï¼Ÿ
1. **å®‰å…¨æ€§æ§åˆ¶**ï¼šé˜²æ­¢æœªæˆæ¬Šè¨­å‚™å­˜å–ç³»çµ±
2. **æ¬Šé™ç®¡ç†**ï¼šä¸åŒè¨­å‚™æœ‰ä¸åŒçš„æ“ä½œæ¬Šé™
3. **è¿½è¹¤ç¨½æ ¸**ï¼šè¨˜éŒ„å“ªå€‹è¨­å‚™åŸ·è¡Œäº†å“ªäº›æ“ä½œ
4. **ä½ç½®é™åˆ¶**ï¼šHMI çµ‚ç«¯åªèƒ½ç®¡ç†æŒ‡å®šå€åŸŸ

## ğŸ” è¨­å‚™é¡å‹èªªæ˜

### 1. æ“ä½œå“¡å·¥ä½œç«™ (op_station)
**ç”¨é€”**ï¼šä¾›æ“ä½œå“¡é€²è¡Œæ—¥å¸¸ä½œæ¥­çš„ä¸»è¦å·¥ä½œç«™

**å…¸å‹è¨­å‚™**ï¼š
- è¾¦å…¬å®¤é›»è…¦
- æ§åˆ¶å®¤å·¥ä½œç«™
- æ“ä½œå“¡å¹³æ¿

**æ¬Šé™ç¯„åœ**ï¼š
- `can_call_agv`: å‘¼å« AGV åŸ·è¡Œä»»å‹™
- `can_view_tasks`: æŸ¥çœ‹ä»»å‹™ç‹€æ…‹å’Œæ­·å²
- `can_create_tasks`: å»ºç«‹æ–°ä»»å‹™

**ä»‹é¢å°å‘**ï¼šè‡ªå‹•å°å‘ `/home` (æ¨™æº– OPUI ä»‹é¢)

### 2. HMI çµ‚ç«¯ (hmi_terminal)
**ç”¨é€”**ï¼šç¾å ´çš„äººæ©Ÿä»‹é¢çµ‚ç«¯ï¼Œç”¨æ–¼ç‰¹å®šå€åŸŸçš„ Rack ç®¡ç†

**å…¸å‹è¨­å‚™**ï¼š
- äººå·¥æ”¶æ–™å€è§¸æ§è¢å¹•
- å°„å‡ºæ©Ÿæ—å¹³æ¿
- NG å€åŸŸæ“ä½œçµ‚ç«¯

**æ¬Šé™ç¯„åœ**ï¼š
- `locations`: å¯ç®¡ç†çš„ä½ç½®åˆ—è¡¨
- `layout`: æŒ‰éˆ•æ’ç‰ˆæ–¹å¼ï¼ˆå¦‚ 2x2ã€1x3ï¼‰
- `can_remove_rack`: æ˜¯å¦å¯ç§»å‡º Rack

**ä»‹é¢å°å‘**ï¼šè‡ªå‹•å°å‘ `/hmi` (å¤§æŒ‰éˆ•è§¸æ§ä»‹é¢)

## ğŸ› ï¸ è¨­å‚™æˆæ¬Šç®¡ç†

### æŸ¥çœ‹ç¾æœ‰æˆæ¬Š
```sql
-- æŸ¥çœ‹æ‰€æœ‰æˆæ¬Šè¨˜éŒ„
SELECT
    id,
    device_id,
    active,
    device_type,
    description,
    permissions
FROM license
ORDER BY device_type, id;

-- æŸ¥çœ‹å•Ÿç”¨ä¸­çš„æˆæ¬Š
SELECT * FROM license WHERE active = 1;

-- æŸ¥çœ‹ç‰¹å®šè¨­å‚™
SELECT * FROM license WHERE device_id = 'YOUR_DEVICE_ID';
```

### æ–°å¢è¨­å‚™æˆæ¬Š

#### æ–°å¢æ“ä½œå“¡å·¥ä½œç«™
```sql
INSERT INTO license (device_id, active, device_type, description, permissions)
VALUES (
    'NEW_DEVICE_ID_16',  -- å¿…é ˆæ˜¯16ä½å­—å…ƒ
    1,                    -- 1=å•Ÿç”¨, 0=åœç”¨
    'op_station',
    'æ“ä½œå“¡å·¥ä½œç«™ #2',
    '{
        "can_call_agv": true,
        "can_view_tasks": true,
        "can_create_tasks": true
    }'::jsonb
);
```

#### æ–°å¢ HMI çµ‚ç«¯
```sql
INSERT INTO license (device_id, active, device_type, description, permissions)
VALUES (
    'HMI_DEVICE_ID_16',  -- å¿…é ˆæ˜¯16ä½å­—å…ƒ
    1,
    'hmi_terminal',
    'äººå·¥æ”¶æ–™å€ HMI #1',
    '{
        "locations": ["ManualReceiveArea01", "ManualReceiveArea02"],
        "layout": "1x2",
        "can_remove_rack": true
    }'::jsonb
);
```

### æ›´æ–°è¨­å‚™æˆæ¬Š

#### åœç”¨è¨­å‚™
```sql
-- æš«æ™‚åœç”¨è¨­å‚™
UPDATE license
SET active = 0
WHERE device_id = 'DEVICE_TO_DISABLE';
```

#### å•Ÿç”¨è¨­å‚™
```sql
-- é‡æ–°å•Ÿç”¨è¨­å‚™
UPDATE license
SET active = 1
WHERE device_id = 'DEVICE_TO_ENABLE';
```

#### æ›´æ–°æ¬Šé™
```sql
-- æ›´æ–° HMI çµ‚ç«¯çš„ç®¡ç†ä½ç½®
UPDATE license
SET permissions = '{
    "locations": ["LOC001", "LOC002", "LOC003"],
    "layout": "1x3",
    "can_remove_rack": true
}'::jsonb
WHERE device_id = 'HMI_DEVICE_ID_16';
```

### åˆªé™¤è¨­å‚™æˆæ¬Š
```sql
-- æ°¸ä¹…åˆªé™¤æˆæ¬Šè¨˜éŒ„ï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰
DELETE FROM license
WHERE device_id = 'DEVICE_TO_DELETE';
```

## ğŸ“± è¨­å‚™ ID ç®¡ç†

### Device ID è¦ç¯„
- **é•·åº¦**ï¼šå¿…é ˆç‚º 16 å€‹å­—å…ƒ
- **å­—å…ƒ**ï¼šåªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ï¼ˆå¤§å°å¯«ï¼‰å’Œæ•¸å­—
- **å”¯ä¸€æ€§**ï¼šæ¯å€‹ device_id åœ¨ç³»çµ±ä¸­å¿…é ˆå”¯ä¸€
- **æ ¼å¼ç¯„ä¾‹**ï¼š`ca08777c72096c51`ã€`HMI0000000000001`

### å¦‚ä½•å–å¾— Device ID

#### æ–¹æ³• 1ï¼šç¡¬é«” MAC åœ°å€ï¼ˆæ¨è–¦ï¼‰
```bash
# Linux/Mac
ifconfig | grep ether | head -1 | awk '{print $2}' | sed 's/://g'

# æˆ–ä½¿ç”¨
ip link show | grep ether | head -1 | awk '{print $2}' | sed 's/://g'
```

#### æ–¹æ³• 2ï¼šåºè™Ÿæ¨™ç±¤
- æª¢æŸ¥è¨­å‚™èƒŒé¢æˆ–åº•éƒ¨çš„åºè™Ÿæ¨™ç±¤
- ä½¿ç”¨è£½é€ å•†æä¾›çš„å”¯ä¸€åºè™Ÿ

#### æ–¹æ³• 3ï¼šæ‰‹å‹•ç”¢ç”Ÿ
```python
import uuid
import hashlib

# ç”¢ç”Ÿå”¯ä¸€ ID
unique_id = hashlib.md5(str(uuid.uuid4()).encode()).hexdigest()[:16]
print(f"Generated Device ID: {unique_id}")
```

## ğŸ”§ æ¬Šé™é…ç½®è©³è§£

### op_station æ¬Šé™
```json
{
    "can_call_agv": true,      // å¯ä»¥å‘¼å« AGV
    "can_view_tasks": true,     // å¯ä»¥æŸ¥çœ‹ä»»å‹™
    "can_create_tasks": true    // å¯ä»¥å»ºç«‹ä»»å‹™
}
```

### hmi_terminal æ¬Šé™
```json
{
    "locations": [              // ç®¡ç†çš„ä½ç½®åˆ—è¡¨
        "ManualReceiveArea01",
        "ManualReceiveArea02",
        "ManualReceiveArea03"
    ],
    "layout": "1x3",           // æŒ‰éˆ•æ’ç‰ˆï¼ˆ1åˆ—3æ¬„ï¼‰
    "can_remove_rack": true    // å¯ä»¥ç§»å‡º Rack
}
```

### æ”¯æ´çš„æ’ç‰ˆæ ¼å¼
- `"1x2"`: 1 åˆ— 2 æ¬„ï¼ˆé©åˆå°å€åŸŸï¼‰
- `"2x2"`: 2 åˆ— 2 æ¬„ï¼ˆæ¨™æº–é…ç½®ï¼‰
- `"1x3"`: 1 åˆ— 3 æ¬„ï¼ˆæ©«å‘æ’åˆ—ï¼‰
- `"2x3"`: 2 åˆ— 3 æ¬„ï¼ˆå¤§å€åŸŸï¼‰
- `"1x4"`: 1 åˆ— 4 æ¬„ï¼ˆè¶…å¯¬è¢å¹•ï¼‰

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

#### å•é¡Œ 1ï¼šè¨­å‚™é¡¯ç¤ºã€Œæœªæˆæ¬Šã€
**åŸå› **ï¼šè¨­å‚™ ID ä¸åœ¨æˆæ¬Šæ¸…å–®ä¸­
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç¢ºèªè¨­å‚™ ID æ˜¯å¦æ­£ç¢º
2. æª¢æŸ¥è³‡æ–™åº«æ˜¯å¦æœ‰å°æ‡‰è¨˜éŒ„
3. ç¢ºèª active æ¬„ä½ç‚º 1
4. æ–°å¢æˆæ¬Šè¨˜éŒ„ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰

#### å•é¡Œ 2ï¼šæ¬Šé™ä¸è¶³
**åŸå› **ï¼šè¨­å‚™é¡å‹æˆ–æ¬Šé™é…ç½®ä¸æ­£ç¢º
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æª¢æŸ¥ device_type æ˜¯å¦æ­£ç¢º
2. æª¢æŸ¥ permissions JSON é…ç½®
3. æ›´æ–°æ¬Šé™è¨­å®š

#### å•é¡Œ 3ï¼šHMI æŒ‰éˆ•æœªé¡¯ç¤º
**åŸå› **ï¼šlocations é…ç½®éŒ¯èª¤
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç¢ºèª locations é™£åˆ—ä¸­çš„ä½ç½®åç¨±å­˜åœ¨æ–¼ location è¡¨
2. æª¢æŸ¥ layout æ ¼å¼æ˜¯å¦æ”¯æ´
3. ç¢ºèª can_remove_rack è¨­ç‚º true

#### å•é¡Œ 4ï¼šæˆæ¬Šå¾Œä»ç„¡æ³•ä½¿ç”¨
**åŸå› **ï¼šå¿«å–æˆ–é€£ç·šå•é¡Œ
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æ¸…é™¤ç€è¦½å™¨å¿«å–
2. é‡æ–°æ•´ç†é é¢ï¼ˆF5ï¼‰
3. æª¢æŸ¥ç¶²è·¯é€£ç·š
4. é‡å•Ÿ OPUI æœå‹™

## ğŸ“Š ç®¡ç†æœ€ä½³å¯¦è¸

### 1. å®šæœŸå¯©æ ¸
- æ¯æœˆæª¢æŸ¥æˆæ¬Šæ¸…å–®
- ç§»é™¤ä¸å†ä½¿ç”¨çš„è¨­å‚™
- æ›´æ–°è¨­å‚™æè¿°è³‡è¨Š

### 2. æ¬Šé™æœ€å°åŒ–
- åªæˆäºˆå¿…è¦çš„æ¬Šé™
- HMI çµ‚ç«¯é™åˆ¶åœ¨ç‰¹å®šå€åŸŸ
- å®šæœŸæª¢è¦–æ¬Šé™è¨­å®š

### 3. æ–‡æª”è¨˜éŒ„
- è¨˜éŒ„æ¯å€‹è¨­å‚™çš„ç”¨é€”å’Œä½ç½®
- ç¶­è­·è¨­å‚™æ¸…å–®å’Œè² è²¬äººè³‡è¨Š
- è¨˜éŒ„æˆæ¬Šè®Šæ›´æ­·å²

### 4. å‚™ä»½ç­–ç•¥
```sql
-- å‚™ä»½æˆæ¬Šè³‡æ–™
COPY license TO '/backup/license_backup.csv' CSV HEADER;

-- é‚„åŸæˆæ¬Šè³‡æ–™
COPY license FROM '/backup/license_backup.csv' CSV HEADER;
```

## ğŸ” ç›£æ§å’Œç¨½æ ¸

### æŸ¥çœ‹è¨­å‚™ä½¿ç”¨ç‹€æ³
```sql
-- æŸ¥çœ‹æœ€è¿‘çš„è¨­å‚™æ´»å‹•ï¼ˆéœ€è¦æœ‰å°æ‡‰çš„æ—¥èªŒè¡¨ï¼‰
SELECT
    l.device_id,
    l.description,
    COUNT(log.id) as operation_count
FROM license l
LEFT JOIN operation_log log ON l.device_id = log.device_id
WHERE log.created_at > NOW() - INTERVAL '7 days'
GROUP BY l.device_id, l.description
ORDER BY operation_count DESC;
```

### ç•°å¸¸æª¢æ¸¬
```sql
-- æ‰¾å‡ºé•·æ™‚é–“æœªä½¿ç”¨çš„æˆæ¬Š
SELECT
    device_id,
    description,
    active
FROM license
WHERE device_id NOT IN (
    SELECT DISTINCT device_id
    FROM operation_log
    WHERE created_at > NOW() - INTERVAL '30 days'
)
AND active = 1;
```

## ğŸ“ æŠ€è¡“æ”¯æ´

### è¯çµ¡è³‡è¨Š
- **ç³»çµ±ç®¡ç†å“¡**ï¼šåˆ†æ©Ÿ 2345
- **IT æ”¯æ´**ï¼šåˆ†æ©Ÿ 2346
- **è³‡æ–™åº«ç®¡ç†**ï¼šåˆ†æ©Ÿ 2347

### ç·Šæ€¥è™•ç†æµç¨‹
1. è¨˜éŒ„å•é¡Œç¾è±¡å’Œè¨­å‚™ ID
2. æª¢æŸ¥æœ¬æŒ‡å—çš„æ•…éšœæ’é™¤ç« ç¯€
3. è¯ç¹«æŠ€è¡“æ”¯æ´åœ˜éšŠ
4. æä¾›éŒ¯èª¤è¨Šæ¯å’Œæ“ä½œæ­¥é©Ÿ

## ğŸ”— ç›¸é—œæ–‡æª”
- HMI ç³»çµ±è¨­è¨ˆï¼šdocs-ai/knowledge/system/hmi-system-design.md
- Rack ç®¡ç†æ“ä½œï¼šdocs-ai/operations/guides/rack-management-guide.md
- è³‡æ–™åº«è¨­è¨ˆï¼šdocs-ai/knowledge/agv-domain/license-table-design.md
- Web API æ–‡æª”ï¼šdocs-ai/operations/development/web/web-development.md

## ğŸ“ æ›´æ–°è¨˜éŒ„
| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å…§å®¹ | æ›´æ–°è€… |
|------|------|----------|--------|
| 1.0 | 2025-09-19 | åˆç‰ˆç™¼å¸ƒ | AI Agent |