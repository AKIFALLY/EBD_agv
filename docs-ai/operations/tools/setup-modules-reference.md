# Setup Modules åŠŸèƒ½åƒè€ƒæ–‡æª”

## ğŸ“‹ æ¦‚è¿°

Setup Modules æ˜¯ RosAGV å°ˆæ¡ˆçš„æ¨¡çµ„åŒ–ç’°å¢ƒè¨­å®šç³»çµ±ï¼Œä½æ–¼ `/app/setup_modules/` ç›®éŒ„ï¼Œç”±ä¸»è…³æœ¬ `/app/setup.bash` çµ±ä¸€è¼‰å…¥ã€‚æ¡ç”¨åˆ†å±¤è¨­è¨ˆï¼Œæ¯å€‹æ¨¡çµ„è² è²¬ç‰¹å®šåŠŸèƒ½é ˜åŸŸï¼Œæä¾›ä¸€è‡´çš„é–‹ç™¼å’Œé‹ç¶­é«”é©—ã€‚

### æ¶æ§‹ç‰¹é»
- **æ¨¡çµ„åŒ–è¨­è¨ˆ**: 7 å€‹ç¨ç«‹æ¨¡çµ„ï¼ŒæŒ‰ä¾è³´é †åºè¼‰å…¥
- **ç’°å¢ƒè‡ªé©æ‡‰**: è‡ªå‹•æª¢æ¸¬ AGV/AGVC ç’°å¢ƒï¼Œé¸æ“‡å°æ‡‰åŠŸèƒ½
- **çµ±ä¸€ä»‹é¢**: æä¾›ä¸€è‡´çš„å‘½ä»¤å’Œåˆ¥åé«”ç³»
- **å¯æ“´å±•æ€§**: æ˜“æ–¼æ–°å¢åŠŸèƒ½æ¨¡çµ„ï¼Œä¸å½±éŸ¿ç¾æœ‰ç³»çµ±

### æ¨¡çµ„è¼‰å…¥é †åº
```bash
1. common.bash                  # åŸºç¤å‡½æ•¸ï¼ˆæœ€å„ªå…ˆï¼‰
2. build-tools.bash            # å»ºç½®å·¥å…·
3. workspace-loader.bash       # å·¥ä½œç©ºé–“è¼‰å…¥
4. node-management.bash        # ç¯€é»ç®¡ç†
5. system-checks.bash          # ç³»çµ±æª¢æŸ¥
6. device-identity.bash        # è¨­å‚™è­˜åˆ¥
7. remote-agv-management.bash  # é ç¨‹ AGV ç®¡ç†
```

---

## ğŸ§© æ¨¡çµ„ 1: common.bash - åŸºç¤å·¥å…·æ¨¡çµ„

**è·¯å¾‘**: `/app/setup_modules/common.bash`

### åŠŸèƒ½æ¦‚è¿°
æä¾›é¡è‰²å®šç¾©ã€æ—¥èªŒç³»çµ±å’ŒåŸºç¤å·¥å…·å‡½æ•¸ï¼Œæ˜¯æ‰€æœ‰å…¶ä»–æ¨¡çµ„çš„åŸºç¤ä¾è³´ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1.1 æ—¥èªŒç³»çµ±
```bash
log_info "è³‡è¨Šè¨Šæ¯"       # è—è‰² [INFO]
log_success "æˆåŠŸè¨Šæ¯"    # ç¶ è‰² [SUCCESS]
log_warning "è­¦å‘Šè¨Šæ¯"    # é»ƒè‰² [WARNING]
log_error "éŒ¯èª¤è¨Šæ¯"      # ç´…è‰² [ERROR]
log_debug "é™¤éŒ¯è¨Šæ¯"      # ç´«è‰² [DEBUG] (éœ€è¨­å®š LOG_LEVEL=DEBUG)
log_header "æ¨™é¡Œ"         # å¸¶æ¡†æ¨™é¡Œ
```

**ä½¿ç”¨ç¯„ä¾‹**:
```bash
log_info "é–‹å§‹å»ºç½®å·¥ä½œç©ºé–“..."
if build_workspace; then
    log_success "å»ºç½®å®Œæˆ"
else
    log_error "å»ºç½®å¤±æ•—"
fi
```

#### 1.2 é¡è‰²å®šç¾©
```bash
$RED, $GREEN, $YELLOW, $BLUE, $PURPLE, $CYAN, $WHITE, $NC
```

#### 1.3 åŸºç¤å·¥å…·å‡½æ•¸

**ping_all** - æª¢æŸ¥é ç«¯ä¸»æ©Ÿé€£ç·š
```bash
ping_all
# æ¸¬è©¦é å®šç¾©çš„ hosts: 192.168.10.3, 192.168.11.152, agvc.ui, op.ui
```

**test_all** - æ¸¬è©¦æ‰€æœ‰å·¥ä½œç©ºé–“
```bash
test_all
# è‡ªå‹•æ¸¬è©¦æ‰€æœ‰å·²å»ºç½®çš„å·¥ä½œç©ºé–“ï¼Œçµ±è¨ˆæˆåŠŸ/å¤±æ•—æ•¸é‡
```

**test_ws / test_single** - æ¸¬è©¦å–®ä¸€å·¥ä½œç©ºé–“
```bash
test_ws agv_ws
test_single db_proxy_ws
```

#### 1.4 ç’°å¢ƒæª¢æ¸¬å‡½æ•¸

**is_agvc_environment** - æª¢æ¸¬ç•¶å‰æ˜¯å¦ç‚º AGVC ç’°å¢ƒ
```bash
if is_agvc_environment; then
    echo "AGVC ç®¡ç†ç’°å¢ƒ"
else
    echo "AGV è»Šè¼‰ç’°å¢ƒ"
fi
```

æª¢æ¸¬æ–¹æ³•ï¼š
- ä¸»è¦æª¢æ¸¬ `$CONTAINER_TYPE` ç’°å¢ƒè®Šæ•¸
- ç•¶ `$CONTAINER_TYPE = "agvc"` æ™‚è¿”å› true (0)
- AGVC ç’°å¢ƒï¼šåŒ…å«è³‡æ–™åº«ã€Web APIã€RCS ç­‰ç®¡ç†ç³»çµ±

**is_agv_environment** - æª¢æ¸¬ç•¶å‰æ˜¯å¦ç‚º AGV ç’°å¢ƒ
```bash
if is_agv_environment; then
    echo "AGV è»Šè¼‰ç’°å¢ƒ"
else
    echo "AGVC ç®¡ç†ç’°å¢ƒ"
fi
```

æª¢æ¸¬æ–¹æ³•ï¼š
- ä¸»è¦æª¢æ¸¬ `$CONTAINER_TYPE` ç’°å¢ƒè®Šæ•¸
- ç•¶ `$CONTAINER_TYPE = "agv"` æ™‚è¿”å› true (0)
- AGV ç’°å¢ƒï¼šåŒ…å« AGV æ§åˆ¶ã€æ„Ÿæ¸¬å™¨ã€PLC é€šè¨Šç­‰

#### 1.5 ç¯€é»å•Ÿå‹•é©—è­‰å‡½æ•¸

Setup Modules æä¾›ä¸‰ç¨®ç¯€é»å•Ÿå‹•é©—è­‰æ–¹æ³•ï¼Œæ ¹æ“šä¸åŒå ´æ™¯é¸æ“‡ä½¿ç”¨ï¼š

**æ–¹æ³• 1: verify_ros2_node_startup** - ROS 2 ç¯€é»åˆ—è¡¨é©—è­‰
```bash
verify_ros2_node_startup <node_name> [timeout] [show_progress]

# ç¯„ä¾‹
if verify_ros2_node_startup "/agvc/plc_service" 10 true; then
    echo "âœ… ç¯€é»å•Ÿå‹•æˆåŠŸ"
fi
```

**åŸç†**: ä½¿ç”¨ `ros2 node list | grep "node_name"` æª¢æŸ¥ç¯€é»æ˜¯å¦è¨»å†Šåˆ° ROS 2 ç¶²è·¯

**é©ç”¨å ´æ™¯**:
- âœ… ros2 run å•Ÿå‹•çš„å–®ä¸€ç¯€é»ï¼ˆæœ‰æ˜ç¢ºå‘½åç©ºé–“ï¼‰
- âœ… ros2 launch ç”¢ç”Ÿçš„å‘½åç¯€é»
- âœ… æ ¸å¿ƒåŸºç¤è¨­æ–½æœå‹™ï¼ˆéœ€è¦ç¢ºèª ROS 2 é€šè¨Šæ­£å¸¸ï¼‰

**æª¢æ¸¬æ™‚é–“**: 1-3 ç§’ï¼ˆéœ€ç­‰å¾… ROS 2 ç¶²è·¯è¨»å†Šï¼‰

**æ–¹æ³• 2: verify_process_startup** - é€²ç¨‹æ¨¡å¼åŒ¹é…é©—è­‰
```bash
verify_process_startup <process_pattern> [timeout] [show_progress]

# ç¯„ä¾‹
if verify_process_startup "rcs_launch.py" 10 true; then
    echo "âœ… Launch é€²ç¨‹å•Ÿå‹•æˆåŠŸ"
fi
```

**åŸç†**: ä½¿ç”¨ `pgrep -f "process_pattern"` æª¢æŸ¥é€²ç¨‹æ˜¯å¦å­˜åœ¨

**é©ç”¨å ´æ™¯**:
- âœ… ros2 launch å•Ÿå‹•çš„è¤‡é›œå¤šé€²ç¨‹æœå‹™
- âœ… åŸç”Ÿé€²ç¨‹æœå‹™ï¼ˆé ROS 2 ç¯€é»ï¼Œå¦‚ Zenoh Routerã€SSHï¼‰
- âœ… ROS 2 ç¶²è·¯å¯èƒ½ä¸ç©©å®šæ™‚çš„å¿«é€Ÿæª¢æŸ¥

**æª¢æ¸¬æ™‚é–“**: < 100msï¼ˆå³æ™‚æª¢æ¸¬ï¼ŒæŸ¥è©¢ /proc æ–‡ä»¶ç³»çµ±ï¼‰

**æ–¹æ³• 3: verify_node_startup_combined** - çµ„åˆé©—è­‰
```bash
verify_node_startup_combined <parent_pid> <node_name> <process_pattern> [timeout]

# ç¯„ä¾‹
if verify_node_startup_combined "$PID" "/agvc/node" "launch.py" 15; then
    echo "âœ… å®Œæ•´é©—è­‰é€šé"
fi
```

**åŸç†**: åŒæ™‚æª¢æŸ¥é€²ç¨‹å­˜æ´» + ROS 2 ç¯€é»è¨»å†Šæˆ–é€²ç¨‹æ¨¡å¼

**é©ç”¨å ´æ™¯**:
- âœ… éœ€è¦å¤šå±¤é©—è­‰çš„è¤‡é›œç¯€é»
- âœ… éœ€è¦åŒæ™‚ç¢ºèªé€²ç¨‹å­˜åœ¨å’ŒåŠŸèƒ½æ­£å¸¸

**æª¢æ¸¬æ™‚é–“**: è¦–é©—è­‰å…§å®¹è€Œå®šï¼ˆé€šå¸¸ 5-15 ç§’ï¼‰

**è¿”å›å€¼**:
- 0: é©—è­‰æˆåŠŸ
- 1: é©—è­‰è¶…æ™‚
- 2: ä¸»é€²ç¨‹æ„å¤–çµ‚æ­¢ï¼ˆåƒ… combined æ¨¡å¼ï¼‰

**è¶…æ™‚å»ºè­°å€¼**:

| ç¯€é»é¡å‹ | å»ºè­°è¶…æ™‚ | åŸå›  |
|---------|---------|------|
| ros2 run (å–®ä¸€ç¯€é») | 10 ç§’ | ç¯€é»è¨»å†Šé€šå¸¸éœ€è¦ 2-5 ç§’ |
| ros2 run (with namespace) | 10 ç§’ | å‘½åç©ºé–“å¢åŠ çš„é–‹éŠ·å¾ˆå° |
| ros2 launch (ç°¡å–®ï¼Œå–®ç¯€é») | 10 ç§’ | Launch é–‹éŠ· + ç¯€é»è¨»å†Š |
| ros2 launch (è¤‡é›œï¼Œå¤šç¯€é») | 15 ç§’ | å¤šç¯€é» + ä¾è³´é—œä¿‚åˆå§‹åŒ– |
| åŸç”Ÿé€²ç¨‹ï¼ˆç„¡ ROS 2ï¼‰ | 5 ç§’ | ç„¡ ROS 2 é–‹éŠ·ï¼Œå•Ÿå‹•å¿« |
| èˆŠç³»çµ±æˆ–é‡é‡ç´šæœå‹™ | 15-20 ç§’ | å¯èƒ½æœ‰è¤‡é›œåˆå§‹åŒ–é‚è¼¯ |

---

## ğŸ”¨ æ¨¡çµ„ 2: build-tools.bash - å»ºç½®å·¥å…·æ¨¡çµ„

**è·¯å¾‘**: `/app/setup_modules/build-tools.bash`

### åŠŸèƒ½æ¦‚è¿°
æä¾›å·¥ä½œç©ºé–“å»ºç½®ã€æ¸…ç†ç›¸é—œå‡½æ•¸ï¼Œæ”¯æ´ AGV/AGVC é›™ç’°å¢ƒè‡ªé©æ‡‰å»ºç½®ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 2.1 è‡ªå‹•å»ºç½®å‡½æ•¸

**build_all / ba** - è‡ªå‹•å»ºç½®å·¥ä½œç©ºé–“
```bash
build_all
ba  # åˆ¥å

# æ ¹æ“šå®¹å™¨ç’°å¢ƒè‡ªå‹•é¸æ“‡ï¼š
# - AGV ç’°å¢ƒ â†’ å»ºç½® AGV å°ˆç”¨å·¥ä½œç©ºé–“
# - AGVC ç’°å¢ƒ â†’ å»ºç½® AGVC å°ˆç”¨å·¥ä½œç©ºé–“
```

**ç’°å¢ƒæª¢æ¸¬é‚è¼¯**:
1. æª¢æŸ¥ `$CONTAINER_TYPE` ç’°å¢ƒè®Šæ•¸
2. èª¿ç”¨ `is_agvc_environment()` å‡½æ•¸
3. é è¨­ç‚º AGV ç’°å¢ƒ

#### 2.2 å°ˆç”¨å»ºç½®å‡½æ•¸

**build_agv** - å»ºç½® AGV è»Šè¼‰ç³»çµ±å°ˆç”¨å·¥ä½œç©ºé–“
```bash
build_agv
```

**å»ºç½®é †åºï¼ˆAGV åŸºç¤å·¥ä½œç©ºé–“ï¼‰**:
1. shared_constants_wsï¼ˆå…±äº«å¸¸æ•¸ï¼Œæœ€å„ªå…ˆï¼‰
2. keyence_plc_wsï¼ˆPLC é€šè¨Šï¼‰
3. plc_proxy_wsï¼ˆPLC ä»£ç†ï¼‰
4. path_algorithmï¼ˆè·¯å¾‘æ¼”ç®—æ³•ï¼‰
5. db_proxy_wsï¼ˆè³‡æ–™åº«ä»£ç†ï¼‰

**å»ºç½®é †åºï¼ˆAGV æ‡‰ç”¨å·¥ä½œç©ºé–“ï¼‰**:
6. agv_cmd_service_wsï¼ˆAGV å‘½ä»¤æœå‹™ï¼‰
7. joystick_wsï¼ˆæ–æ¡¿æ§åˆ¶ï¼‰
8. agv_wsï¼ˆæ ¸å¿ƒ AGV æ§åˆ¶ï¼‰
9. sensorpart_wsï¼ˆæ„Ÿæ¸¬å™¨è™•ç†ï¼‰
10. uno_gpio_wsï¼ˆGPIO æ§åˆ¶ï¼‰
11. launch_wsï¼ˆLaunch é…ç½®ï¼‰

**build_agvc** - å»ºç½® AGVC ç®¡ç†ç³»çµ±å°ˆç”¨å·¥ä½œç©ºé–“
```bash
build_agvc
```

**å»ºç½®é †åºï¼ˆAGVC åŸºç¤å·¥ä½œç©ºé–“ï¼‰**:
1. shared_constants_ws
2. keyence_plc_ws
3. plc_proxy_ws
4. path_algorithm
5. agv_ws
6. db_proxy_ws

**å»ºç½®é †åºï¼ˆAGVC æ‡‰ç”¨å·¥ä½œç©ºé–“ï¼‰**:
7. ecs_wsï¼ˆè¨­å‚™æ§åˆ¶ç³»çµ±ï¼‰
8. rcs_wsï¼ˆæ©Ÿå™¨äººæ§åˆ¶ç³»çµ±ï¼‰
9. tafl_wsï¼ˆTAFL parser and executorï¼‰
10. tafl_wcs_wsï¼ˆTAFL WCS integrationï¼Œç›®å‰ä½¿ç”¨çš„ WCS å¯¦ä½œï¼‰
11. web_api_wsï¼ˆWeb API æœå‹™ï¼‰
12. kuka_fleet_wsï¼ˆKUKA Fleet æ•´åˆï¼‰
13. launch_ws
14. wcs_ws

#### 2.3 é«˜ç´šå»ºç½®å‡½æ•¸

**build_all_workspaces** - å»ºç½®æ‰€æœ‰å·¥ä½œç©ºé–“ï¼ˆå‚³çµ±æ–¹å¼ï¼‰
```bash
build_all_workspaces
# åŒ…å«æ‰€æœ‰ AGV + AGVC å·¥ä½œç©ºé–“ï¼ŒæŒ‰å®Œæ•´ä¾è³´é †åºå»ºç½®
```

**build_all_smart / bas** - ä¾è³´è§£æå»ºç½®
```bash
build_all_smart
bas  # åˆ¥å

# ä½¿ç”¨ colcon ä¾è³´è§£æåŠŸèƒ½
# å»ºç«‹çµ±ä¸€å»ºç½®ç©ºé–“ï¼Œè‡ªå‹•è™•ç†ä¾è³´é—œä¿‚
```

**åŸç†**:
1. æ”¶é›†æ‰€æœ‰å·¥ä½œç©ºé–“çš„ src ç›®éŒ„
2. å»ºç«‹çµ±ä¸€å»ºç½®ç©ºé–“ `/tmp/rosagv_unified_build`
3. ä½¿ç”¨ç¬¦è™Ÿé€£çµéˆæ¥æ‰€æœ‰å¥—ä»¶
4. ä½¿ç”¨ `colcon build --executor sequential` å»ºç½®
5. è¤‡è£½å»ºç½®çµæœå›å„å·¥ä½œç©ºé–“

**å„ªå‹¢**:
- è‡ªå‹•è™•ç†è·¨å·¥ä½œç©ºé–“ä¾è³´
- æ¸›å°‘é‡è¤‡å»ºç½®
- é©åˆå¤§è¦æ¨¡é‡æ§‹

#### 2.4 å–®ä¸€å·¥ä½œç©ºé–“æ“ä½œ

**build_ws / build_single / build1** - å»ºç½®å–®ä¸€å·¥ä½œç©ºé–“
```bash
build_ws agv_ws
build_single web_api_ws
build1 db_proxy_ws  # åˆ¥å
```

**ç‰¹é»**:
- å»ºç½®å¾Œè‡ªå‹•è¼‰å…¥ç’°å¢ƒ
- é¡¯ç¤ºå»ºç½®ç‹€æ…‹
- æ”¯æ´éŒ¯èª¤è™•ç†

#### 2.5 æ¸…ç†å‡½æ•¸

**clean_all / ca** - æ¸…ç†æ‰€æœ‰å·¥ä½œç©ºé–“
```bash
clean_all
ca  # åˆ¥å

# åˆªé™¤æ‰€æœ‰å·¥ä½œç©ºé–“çš„ build/, install/, log/ ç›®éŒ„
```

**clean_ws / clean_single / clean1** - æ¸…ç†å–®ä¸€å·¥ä½œç©ºé–“
```bash
clean_ws agv_ws
clean_single web_api_ws
clean1 db_proxy_ws  # åˆ¥å
```

#### 2.6 å»ºç½®çµæœçµ±è¨ˆ

æ‰€æœ‰å»ºç½®å‡½æ•¸éƒ½æœƒé¡¯ç¤ºçµ±è¨ˆçµæœï¼š
```
ğŸ“Š å»ºç½®å®Œæˆ: 8/10 å€‹å·¥ä½œç©ºé–“å»ºç½®æˆåŠŸ
```

---

## ğŸ“¦ æ¨¡çµ„ 3: workspace-loader.bash - å·¥ä½œç©ºé–“è¼‰å…¥æ¨¡çµ„

**è·¯å¾‘**: `/app/setup_modules/workspace-loader.bash`

### åŠŸèƒ½æ¦‚è¿°
æä¾›å·¥ä½œç©ºé–“ç’°å¢ƒè¼‰å…¥ã€é ç«¯æª”æ¡ˆåŒæ­¥å’Œå¹«åŠ©æ–‡æª”å‡½æ•¸ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 3.1 è‡ªå‹•è¼‰å…¥å‡½æ•¸

**all_source / sa / load_all** - è‡ªå‹•è¼‰å…¥å·¥ä½œç©ºé–“
```bash
all_source
sa         # åˆ¥å
load_all   # åˆ¥å

# æ ¹æ“šå®¹å™¨ç’°å¢ƒè‡ªå‹•é¸æ“‡ï¼š
# - AGV ç’°å¢ƒ â†’ è¼‰å…¥ AGV å°ˆç”¨å·¥ä½œç©ºé–“
# - AGVC ç’°å¢ƒ â†’ è¼‰å…¥ AGVC å°ˆç”¨å·¥ä½œç©ºé–“
```

**ç’°å¢ƒæª¢æ¸¬é‚è¼¯**:
1. æª¢æŸ¥ `$CONTAINER_TYPE` ç’°å¢ƒè®Šæ•¸
2. èª¿ç”¨ `is_agvc_environment()` å‡½æ•¸
3. é è¨­ç‚º AGV ç’°å¢ƒ

#### 3.2 å°ˆç”¨è¼‰å…¥å‡½æ•¸

**agv_source / agv** - è¼‰å…¥ AGV è»Šè¼‰ç³»çµ±å°ˆç”¨å·¥ä½œç©ºé–“
```bash
agv_source
agv  # åˆ¥å
```

**è¼‰å…¥é †åºï¼ˆAGV åŸºç¤å·¥ä½œç©ºé–“ï¼‰**:
1. /app/shared_constants_ws/install
2. /app/keyence_plc_ws/install
3. /app/plc_proxy_ws/install
4. /app/path_algorithm/install
5. /app/db_proxy_ws/install

**è¼‰å…¥é †åºï¼ˆAGV æ‡‰ç”¨å·¥ä½œç©ºé–“ï¼‰**:
6. /app/agv_cmd_service_ws/install
7. /app/joystick_ws/install
8. /app/agv_ws/install
9. /app/sensorpart_ws/install
10. /app/uno_gpio_ws/install
11. /app/launch_ws/install

**agvc_source / agvc** - è¼‰å…¥ AGVC ç®¡ç†ç³»çµ±å°ˆç”¨å·¥ä½œç©ºé–“
```bash
agvc_source
agvc  # åˆ¥å
```

**è¼‰å…¥é †åºï¼ˆAGVC åŸºç¤å·¥ä½œç©ºé–“ï¼‰**:
1. /app/shared_constants_ws/install
2. /app/keyence_plc_ws/install
3. /app/plc_proxy_ws/install
4. /app/path_algorithm/install
5. /app/agv_ws/install
6. /app/db_proxy_ws/install

**è¼‰å…¥é †åºï¼ˆAGVC æ‡‰ç”¨å·¥ä½œç©ºé–“ï¼‰**:
7. /app/ecs_ws/install
8. /app/rcs_ws/install
9. /app/tafl_ws/install
10. /app/tafl_wcs_ws/install
11. /app/web_api_ws/install
12. /app/kuka_fleet_ws/install
13. /app/launch_ws/install
14. /app/wcs_ws/install

**ç‰¹é»**:
- è‡ªå‹•æª¢æ¸¬å·¥ä½œç©ºé–“æ˜¯å¦å·²å»ºç½®
- æœªå»ºç½®çš„å·¥ä½œç©ºé–“é¡¯ç¤ºè­¦å‘Š
- æŒ‰ä¾è³´é †åºè¼‰å…¥ï¼Œç¢ºä¿ç’°å¢ƒæ­£ç¢º

#### 3.3 é ç«¯æª”æ¡ˆåŒæ­¥

**app_upload** - åŒæ­¥æª”æ¡ˆåˆ°é ç«¯ä¸»æ©Ÿ
```bash
app_upload 192.168.10.5
# ä½¿ç”¨ rsync åŒæ­¥ /app/ ç›®éŒ„åˆ°é ç«¯ä¸»æ©Ÿ
```

**app_download** - å¾é ç«¯ä¸»æ©Ÿä¸‹è¼‰æª”æ¡ˆ
```bash
app_download 192.168.10.5
# ä½¿ç”¨ rsync å¾é ç«¯ä¸»æ©Ÿä¸‹è¼‰ /app/ ç›®éŒ„
```

**rsync é¸é …**:
- `-a`: æ­¸æª”æ¨¡å¼ï¼ˆä¿ç•™æ¬Šé™ã€æ™‚é–“æˆ³ç­‰ï¼‰
- `-v`: è©³ç´°è¼¸å‡º
- `-z`: å£“ç¸®å‚³è¼¸
- `--delete`: åˆªé™¤ç›®çš„åœ°å¤šé¤˜æª”æ¡ˆï¼ˆåƒ… uploadï¼‰

**å®‰å…¨æª¢æŸ¥**:
- åŸ·è¡Œå‰æª¢æŸ¥é ç«¯ä¸»æ©Ÿæ˜¯å¦å¯é”
- ä½¿ç”¨ SSH é‡‘é‘°èªè­‰ï¼ˆéœ€é å…ˆé…ç½®ï¼‰

#### 3.4 å¹«åŠ©ç³»çµ±

**show_help / help** - é¡¯ç¤ºå¹«åŠ©è³‡è¨Š
```bash
show_help
help  # åˆ¥å

# é¡¯ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤å’Œä½¿ç”¨ç¯„ä¾‹
```

**å…§å®¹åŒ…å«**:
- ğŸ”§ å»ºç½®å’Œæ¸¬è©¦å‘½ä»¤
- ğŸ“Š ç‹€æ…‹å’Œç›£æ§å‘½ä»¤
- âš™ï¸ æœå‹™ç®¡ç†å‘½ä»¤
- ğŸŒ ç¶²è·¯å’ŒåŒæ­¥å‘½ä»¤
- ğŸ’¡ ä½¿ç”¨ç¯„ä¾‹

---

## âš™ï¸ æ¨¡çµ„ 4: node-management.bash - ç¯€é»ç®¡ç†æ¨¡çµ„

**è·¯å¾‘**: `/app/setup_modules/node-management.bash`

### åŠŸèƒ½æ¦‚è¿°
æä¾›æ‰€æœ‰ ROS 2 ç¯€é»å’Œæœå‹™çš„ç®¡ç†å‡½æ•¸ï¼ŒåŒ…å«å•Ÿå‹•é©—è­‰ã€ç‹€æ…‹æª¢æŸ¥å’Œè‡¨æ™‚æª”æ¡ˆæ¸…ç†ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 4.1 ç¯€é»å•Ÿå‹•é©—è­‰æ±ºç­–æ¨¹

Setup Modules æä¾›è©³ç´°çš„ç¯€é»å•Ÿå‹•é©—è­‰æ–¹æ³•æ±ºç­–æ¨¹ï¼ˆè¦‹ common.bash æ¨¡çµ„èªªæ˜ï¼‰ï¼Œå¹«åŠ©é¸æ“‡åˆé©çš„é©—è­‰æ–¹æ³•ã€‚

**æ±ºç­–æµç¨‹**:
```
Q: æˆ‘è¦å•Ÿå‹•ä¸€å€‹ ros2 run çš„ç¯€é»ï¼Œæœ‰ namespaceï¼Œæ‡‰è©²ç”¨ä»€éº¼æ–¹æ³•ï¼Ÿ
A: ä½¿ç”¨ verify_ros2_node_startup "/namespace/node_name" 10

Q: æˆ‘è¦å•Ÿå‹•ä¸€å€‹ ros2 launch æª”æ¡ˆï¼Œæœƒç”¢ç”Ÿå¤šå€‹ç¯€é»ï¼Œæ‡‰è©²ç”¨ä»€éº¼æ–¹æ³•ï¼Ÿ
A: ä½¿ç”¨ verify_process_startup "launch_file.py" 10

Q: æˆ‘è¦å•Ÿå‹•çš„æœå‹™ä¸æ˜¯ ROS 2 ç¯€é»ï¼ˆå¦‚ Zenohï¼‰ï¼Œæ‡‰è©²ç”¨ä»€éº¼æ–¹æ³•ï¼Ÿ
A: ä½¿ç”¨ verify_process_startup "process_name" 5

Q: æˆ‘éœ€è¦åŒæ™‚æª¢æŸ¥é€²ç¨‹å’Œ ROS 2 è¨»å†Šï¼Œæ‡‰è©²ç”¨ä»€éº¼æ–¹æ³•ï¼Ÿ
A: ä½¿ç”¨ verify_node_startup_combined "$PID" "/node/name" "process_pattern" 15
```

#### 4.2 è‡¨æ™‚æª”æ¡ˆæ¸…ç†

**cleanup_temp_files / ct / cleanup_temp** - æ¸…ç†è‡¨æ™‚æª”æ¡ˆ
```bash
cleanup_temp_files [é¸é …]

# é¸é …
--dry-run           # æ¨¡æ“¬åŸ·è¡Œï¼Œä¸å¯¦éš›åˆªé™¤
--force             # å¼·åˆ¶æ¸…ç†ï¼ˆæ¸…ç† 1 å¤©å‰çš„æª”æ¡ˆï¼‰
--all               # æ¸…ç†æ‰€æœ‰è‡¨æ™‚æª”æ¡ˆï¼ˆä¿è­·æ­£åœ¨é‹è¡Œçš„é€²ç¨‹ï¼‰
--days N            # æ¸…ç† N å¤©å‰çš„æª”æ¡ˆï¼ˆé è¨­: 7ï¼‰
--help, -h          # é¡¯ç¤ºå¹«åŠ©è¨Šæ¯
```

**ä½¿ç”¨ç¯„ä¾‹**:
```bash
cleanup_temp_files                # æ¸…ç† 7 å¤©å‰çš„è‡¨æ™‚æª”æ¡ˆ
cleanup_temp_files --dry-run      # æ¨¡æ“¬æ¸…ç†
cleanup_temp_files --force        # æ¸…ç† 1 å¤©å‰çš„æª”æ¡ˆ
cleanup_temp_files --all          # æ¸…ç†æ‰€æœ‰æª”æ¡ˆ
cleanup_temp_files --days 3       # æ¸…ç† 3 å¤©å‰çš„æª”æ¡ˆ
```

**æ¸…ç†ç›®æ¨™**:
- /tmp/launch_params_* ç›®éŒ„ï¼ˆros2 launch åƒæ•¸æš«å­˜ï¼‰
- å…¶ä»–ç³»çµ±è‡¨æ™‚æª”æ¡ˆ
- ä¿è­·æ­£åœ¨é‹è¡Œçš„é€²ç¨‹ç›¸é—œæª”æ¡ˆ

**çµ±è¨ˆé¡¯ç¤º**:
```
ğŸ“Š æ¸…ç†çµ±è¨ˆ:
  æ¸…ç†æª”æ¡ˆæ•¸: 15
  é‡‹æ”¾ç©ºé–“: 2.3 MB
```

#### 4.3 æœå‹™ç®¡ç†å‡½æ•¸

Node Management æ¨¡çµ„åŒ…å«å¤§é‡æœå‹™ç®¡ç†å‡½æ•¸ï¼Œç”¨æ–¼ç®¡ç† ROS 2 ç¯€é»å’Œç³»çµ±æœå‹™ã€‚ç”±æ–¼æª”æ¡ˆéå¤§ï¼ˆè¶…é 27615 tokensï¼‰ï¼Œé€™è£¡åˆ—å‡ºä¸»è¦ç®¡ç†å‡½æ•¸é¡å‹ï¼š

**ç®¡ç†å‡½æ•¸å‘½åè¦ç¯„**:
```bash
manage_<service_name> <action>

# action: start | stop | restart | status | logs
```

**å¸¸è¦‹ç®¡ç†å‡½æ•¸**:
- `manage_zenoh` - Zenoh Router ç®¡ç† [AGVC]
- `manage_ssh` - SSH æœå‹™ç®¡ç† [é€šç”¨]
- `manage_web_api_launch` - Web API Launch ç®¡ç†ï¼ˆAPI/AGVCUI/OPUI, 8000/8001/8002ï¼‰[AGVC]
- `manage_web_agv_launch` - Web AGV Launch ç®¡ç†ï¼ˆAGVUI è»Šè¼‰ç›£æ§, 8003ï¼‰[AGV]
- `manage_agvc_database_node` - AGVC è³‡æ–™åº«ç¯€é»ç®¡ç† [AGVC]
- `manage_tafl_wcs` - TAFL WCS ç¯€é»ç®¡ç† [AGVC]
- `manage_rcs_core` - RCS æ ¸å¿ƒç¯€é»ç®¡ç†
- `manage_ecs_core` - ECS æ ¸å¿ƒç¯€é»ç®¡ç†
- `manage_room_task_build` - æˆ¿é–“ä»»å‹™å»ºç½®ç¯€é»ç®¡ç†
- `manage_plc_service_agvc` - PLC æœå‹™ç¯€é»ç®¡ç†ï¼ˆAGVCï¼‰

**å¤šé€²ç¨‹ç¾¤çµ„ç®¡ç†ç¯„ä¾‹ï¼ˆmanage_web_api_launchï¼‰**:
```bash
manage_web_api_launch start
# å•Ÿå‹• 3 å€‹ Web ä¼ºæœå™¨ï¼š
# - api_server (8000)
# - agvcui (8001)
# - opui (8002)

manage_web_api_launch status
# æª¢æŸ¥æ‰€æœ‰é€²ç¨‹ç‹€æ…‹

manage_web_api_launch stop
# åœæ­¢æ‰€æœ‰ç›¸é—œé€²ç¨‹
```

**PID æª”æ¡ˆç®¡ç†**:
- å¤šé€²ç¨‹æœå‹™ä½¿ç”¨ PID æª”æ¡ˆè¿½è¹¤ï¼ˆä¾‹å¦‚ `/tmp/web_api_launch.pid`ï¼‰
- ä½¿ç”¨ `kill -0 $pid` é©—è­‰é€²ç¨‹å­˜æ´»
- é‡å•Ÿæ™‚ç¢ºä¿æ¸…ç†èˆŠé€²ç¨‹

---

## ğŸ” æ¨¡çµ„ 5: system-checks.bash - ç³»çµ±æª¢æŸ¥æ¨¡çµ„

**è·¯å¾‘**: `/app/setup_modules/system-checks.bash`

### åŠŸèƒ½æ¦‚è¿°
æä¾›ç³»çµ±ç‹€æ…‹æª¢æŸ¥å’Œè¨ºæ–·å‡½æ•¸ï¼Œç”¨æ–¼å¿«é€Ÿäº†è§£ç³»çµ±é‹è¡Œç‹€æ…‹ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 5.1 ROS ç’°å¢ƒæª¢æŸ¥

**check_ros_env / rosenv** - æª¢æŸ¥ ROS 2 ç’°å¢ƒ
```bash
check_ros_env
rosenv  # åˆ¥å
```

**æª¢æŸ¥é …ç›®**:
```
âœ… ROS_DISTRO: jazzy
âœ… RMW_IMPLEMENTATION: rmw_zenoh_cpp
âœ… ros2 æŒ‡ä»¤å¯ç”¨
âœ… Python è™›æ“¬ç’°å¢ƒ: /opt/pyvenv_env
```

**å¤±æ•—æƒ…æ³**:
- ROS_DISTRO æœªè¨­å®š
- ros2 æŒ‡ä»¤ä¸å¯ç”¨
- RMW_IMPLEMENTATION ä¸æ˜¯ rmw_zenoh_cpp

#### 5.2 Zenoh ç‹€æ…‹æª¢æŸ¥

**check_zenoh_status / zenoh** - æª¢æŸ¥ Zenoh Router ç‹€æ…‹
```bash
check_zenoh_status
zenoh  # åˆ¥å
```

**æª¢æŸ¥é …ç›®**:
```
âœ… Zenoh Router é‹è¡Œä¸­ (PID: 1234)
âœ… PID æª”æ¡ˆå­˜åœ¨: 1234
âœ… æ—¥èªŒæª”æ¡ˆå­˜åœ¨
ğŸ“ æœ€è¿‘æ—¥èªŒ:
   [INFO] Zenoh router started
   [INFO] Listening on tcp/7447
âœ… Zenoh é…ç½®æª”æ¡ˆå­˜åœ¨
âœ… Zenoh Router ç«¯å£ 7447 å·²é–‹å•Ÿ
```

**è¨ºæ–·é‚è¼¯**:
1. æª¢æŸ¥é€²ç¨‹æ˜¯å¦é‹è¡Œï¼ˆ`pgrep -f rmw_zenohd`ï¼‰
2. æª¢æŸ¥ PID æª”æ¡ˆï¼ˆ`/tmp/zenoh_router.pid`ï¼‰
3. æª¢æŸ¥æ—¥èªŒæª”æ¡ˆï¼ˆ`/tmp/zenoh_router.log`ï¼‰
4. æª¢æŸ¥é…ç½®æª”æ¡ˆï¼ˆ`/app/routerconfig.json5`ï¼‰
5. æª¢æŸ¥ç«¯å£ 7447 æ˜¯å¦é–‹å•Ÿ

#### 5.3 ç³»çµ±æ•´é«”ç‹€æ…‹æª¢æŸ¥

**check_system_status / status** - æª¢æŸ¥ç³»çµ±æ•´é«”ç‹€æ…‹
```bash
check_system_status
status  # åˆ¥å
```

**æª¢æŸ¥é …ç›®**:

**1. åŸºç¤æœå‹™**:
```
âœ… SSH æœå‹™é‹è¡Œä¸­
âœ… Zenoh Router é‹è¡Œä¸­ (PID: 1234)
```

**2. ROS 2 ç’°å¢ƒ**:
```
âœ… ROS_DISTRO: jazzy
âœ… RMW_IMPLEMENTATION: rmw_zenoh_cpp
âœ… ros2 æŒ‡ä»¤å¯ç”¨
```

**3. å·¥ä½œç©ºé–“ç‹€æ…‹**:
```
âœ… shared_constants_ws (å·²å»ºç½®)
âœ… keyence_plc_ws (å·²å»ºç½®)
âš ï¸ agv_cmd_service_ws (æœªå»ºç½®)
...

ğŸ“Š å·¥ä½œç©ºé–“çµ±è¨ˆ: 8/10 å·²å»ºç½®
```

#### 5.4 è‡ªå‹•å•Ÿå‹•æœå‹™

**Zenoh Router è‡ªå‹•å•Ÿå‹•**:
```bash
# system-checks.bash æœ«å°¾è‡ªå‹•åŸ·è¡Œ
manage_zenoh start
```

- å®¹å™¨å•Ÿå‹•æ™‚è‡ªå‹•å•Ÿå‹• Zenoh Router
- ç¢ºä¿ ROS 2 é€šè¨ŠåŸºç¤è¨­æ–½å¯ç”¨

#### 5.5 åˆ¥åå®šç¾©

æ¨¡çµ„å…§å®šç¾©äº†å¤§é‡ä¾¿æ·åˆ¥åï¼š

**æª”æ¡ˆç³»çµ±åˆ¥å**:
```bash
ll='ls -alF'    # è©³ç´°åˆ—è¡¨
la='ls -A'      # é¡¯ç¤ºéš±è—æª”æ¡ˆ
l='ls -CF'      # ç·Šæ¹Šåˆ—è¡¨
..='cd ..'      # ä¸Šä¸€å±¤ç›®éŒ„
...='cd ../..'  # ä¸Šå…©å±¤ç›®éŒ„
```

**ROS 2 åˆ¥å**:
```bash
rn='ros2 node list'       # åˆ—å‡ºç¯€é»
rt='ros2 topic list'      # åˆ—å‡ºä¸»é¡Œ
rs='ros2 service list'    # åˆ—å‡ºæœå‹™
ri='ros2 interface list'  # åˆ—å‡ºä»‹é¢
```

**å·¥ä½œç©ºé–“ç®¡ç†åˆ¥å**:
```bash
ba='build_all'            # è‡ªå‹•å»ºç½®
bas='build_all_smart'     # ä¾è³´è§£æå»ºç½®
ta='test_all'             # æ¸¬è©¦æ‰€æœ‰
ca='clean_all'            # æ¸…ç†æ‰€æœ‰
sa='all_source'           # è‡ªå‹•è¼‰å…¥
load_all='all_source'     # è¼‰å…¥æ‰€æœ‰

agv='agv_source'          # AGV å·¥ä½œç©ºé–“
agvc='agvc_source'        # AGVC å·¥ä½œç©ºé–“

build1='build_single'     # å»ºç½®å–®ä¸€
test1='test_single'       # æ¸¬è©¦å–®ä¸€
clean1='clean_single'     # æ¸…ç†å–®ä¸€
```

**ç‹€æ…‹æª¢æŸ¥åˆ¥å**:
```bash
status='check_system_status'    # ç³»çµ±ç‹€æ…‹
zenoh='check_zenoh_status'      # Zenoh ç‹€æ…‹
rosenv='check_ros_env'          # ROS ç’°å¢ƒ
help='show_help'                # å¹«åŠ©è³‡è¨Š
```

**è‡¨æ™‚æª”æ¡ˆæ¸…ç†åˆ¥å**:
```bash
ct='cleanup_temp_files'         # æ¸…ç†è‡¨æ™‚æª”æ¡ˆ
cleanup_temp='cleanup_temp_files'
```

---

## ğŸ” æ¨¡çµ„ 6: device-identity.bash - è¨­å‚™è­˜åˆ¥æ¨¡çµ„

**è·¯å¾‘**: `/app/setup_modules/device-identity.bash`

### åŠŸèƒ½æ¦‚è¿°
æä¾›è¨­å‚™èº«ä»½è­˜åˆ¥ã€MAC åœ°å€æª¢æ¸¬å’Œé…ç½®ç”Ÿæˆå‡½æ•¸ï¼Œæ”¯æ´ AGV/AGVC é›™ç’°å¢ƒè‡ªå‹•è­˜åˆ¥ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 6.1 è¨­å‚™èº«ä»½æª¢æŸ¥

**check_device_identity** - æª¢æŸ¥è¨­å‚™èº«ä»½è³‡è¨Š
```bash
check_device_identity
```

**é¡¯ç¤ºè³‡è¨Š**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ çµ±ä¸€è¨­å‚™èº«ä»½è³‡è¨Š
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”§ çµ±ä¸€è¨­å‚™è³‡è¨Š:
  è¨­å‚™ ID: agvc001
  å®¹å™¨é¡å‹: agvc
  ä¸»è¦ MAC: 00:11:22:33:44:55
  è­˜åˆ¥æ™‚é–“: 2025-10-31 08:39:58
  è­˜åˆ¥ç‹€æ…‹: âœ… æˆåŠŸ
  è­˜åˆ¥æ–¹æ³•: mac_address

ğŸ–¥ï¸ AGVC å°ˆå±¬è³‡è¨Š:
  AGVC ID: agvc001
  AGVC é¡å‹: server
  AGVC è§’è‰²: primary
  ROS å‘½åç©ºé–“: /agvc
  é…ç½®æª”æ¡ˆ: /app/config/agvc/agvc001.yaml
  å·¥ä½œç©ºé–“: all
```

**èº«ä»½æª”æ¡ˆ**:
- `/app/.device_identity` - çµ±ä¸€è¨­å‚™èº«ä»½
- `/app/.agv_identity` - AGV å°ˆå±¬èº«ä»½ï¼ˆAGV ç’°å¢ƒï¼‰
- `/app/.agvc_identity` - AGVC å°ˆå±¬èº«ä»½ï¼ˆAGVC ç’°å¢ƒï¼‰

#### 6.2 æ‰‹å‹•èº«ä»½è­˜åˆ¥

**identify_device_manual** - æ‰‹å‹•è§¸ç™¼è¨­å‚™èº«ä»½è­˜åˆ¥
```bash
identify_device_manual
```

**è­˜åˆ¥æµç¨‹**:
1. åŸ·è¡Œ `/app/scripts/config_driven_device_detector.bash`
2. æª¢æ¸¬ç¡¬é«”è³‡è¨Šï¼ˆMAC åœ°å€ã€CPUã€è¨˜æ†¶é«”ç­‰ï¼‰
3. åŒ¹é…é…ç½®æª”æ¡ˆ `/app/config/hardware_mapping.yaml`
4. ç”Ÿæˆè¨­å‚™èº«ä»½æª”æ¡ˆ
5. é¡¯ç¤ºè­˜åˆ¥çµæœ

**ç’°å¢ƒè®Šæ•¸**:
- `DEVICE_DEBUG=true` - å•Ÿç”¨é™¤éŒ¯æ¨¡å¼ï¼Œé¡¯ç¤ºè©³ç´°è­˜åˆ¥éç¨‹

#### 6.3 MAC åœ°å€è³‡è¨Šç®¡ç†

**show_device_mac_info / mac_info** - é¡¯ç¤ºè¨­å‚™ MAC åœ°å€è³‡è¨Šå’Œç®¡ç†å»ºè­°
```bash
show_device_mac_info [é¸é …]
mac_info [é¸é …]  # ç°¡åŒ–åˆ¥å

# é¸é …
--verbose, -v         # é¡¯ç¤ºè©³ç´°çš„ç¶²è·¯ä»‹é¢è³‡è¨Š
--update-config, -u   # è‡ªå‹•æ›´æ–°é…ç½®æª”æ¡ˆä¸­çš„ MAC åœ°å€
--generate-compose, -g # ç”Ÿæˆå›ºå®š MAC åœ°å€çš„ Docker Compose é…ç½®
--help, -h           # é¡¯ç¤ºå¹«åŠ©è³‡è¨Š
```

**ä½¿ç”¨ç¯„ä¾‹**:
```bash
mac_info                    # åŸºæœ¬è³‡è¨Š
mac_info --verbose          # è©³ç´°è³‡è¨Š
mac_info --update-config    # æ›´æ–°é…ç½®
mac_info --generate-compose # ç”Ÿæˆ Docker Compose é…ç½®
```

**åŠŸèƒ½èªªæ˜**:

**1. é¡¯ç¤ºç•¶å‰è¨­å‚™è³‡è¨Š**:
```
ğŸ”§ ç•¶å‰è¨­å‚™è³‡è¨Š:
  è¨­å‚™ ID: agvc001
  è¨­å‚™é¡å‹: server
  å®¹å™¨é¡å‹: agvc
  è­˜åˆ¥æ–¹æ³•: mac_address
  ç¶²è·¯æ¨¡å¼: bridge (å®¹å™¨ç¨ç«‹ç¶²è·¯ï¼Œå‹•æ…‹ MAC)
```

**2. ç²å–å¯¦éš›ç¶²è·¯ä»‹é¢ MAC åœ°å€**:
```
ğŸ“¡ å¯¦éš›ç¶²è·¯ä»‹é¢ MAC åœ°å€:
  âœ… enp4s0: 00:11:22:33:44:55 (ä¸»è¦è­˜åˆ¥ MAC)
  ğŸ“± wlan0: AA:BB:CC:DD:EE:FF (ç„¡ç·šç¶²è·¯)
  ğŸš« å·²æ’é™¤: lo, docker0, br-xxx, veth...
```

**MAC åœ°å€å„ªå…ˆç´š**:
1. enp4s0ï¼ˆç¬¬ä¸€å„ªå…ˆï¼‰
2. eth0ï¼ˆç¬¬äºŒå„ªå…ˆï¼‰
3. enx*ï¼ˆUSB ç¶²è·¯ä»‹é¢ï¼‰
4. å…¶ä»–éè™›æ“¬ä»‹é¢

**3. ç²å–é…ç½®æª”æ¡ˆä¸­çš„ MAC åœ°å€**:
```
ğŸ“‹ é…ç½®æª”æ¡ˆä¸­çš„ MAC åœ°å€:
  âœ… 00:11:22:33:44:55 (åŒ¹é…)
  âŒ 66:77:88:99:AA:BB (ä¸åŒ¹é…)
```

**4. é¡¯ç¤ºè­˜åˆ¥ç‹€æ…‹å’Œå»ºè­°**:
```
ğŸ¯ è­˜åˆ¥ç‹€æ…‹:
  âœ… MAC åœ°å€åŒ¹é…ï¼Œè¨­å‚™è­˜åˆ¥æ­£å¸¸
  ğŸ’¡ å»ºè­°: é…ç½®æª”æ¡ˆå·²åŒ…å«æ­£ç¢ºçš„ MAC åœ°å€
```

**æˆ–**:
```
ğŸ¯ è­˜åˆ¥ç‹€æ…‹:
  âŒ MAC åœ°å€ä¸åŒ¹é…ï¼Œä½¿ç”¨é è¨­é™ç´šè­˜åˆ¥

âš ï¸ AGVC å®¹å™¨ MAC åœ°å€å•é¡Œ:
  å•é¡Œ: Bridge ç¶²è·¯æ¨¡å¼ä¸‹ï¼Œå®¹å™¨ MAC åœ°å€æ¯æ¬¡ compose up éƒ½æœƒè®Šæ›´

ğŸ”§ è§£æ±ºæ–¹æ¡ˆå»ºè­°:
  1. å›ºå®šå®¹å™¨ MAC åœ°å€ (æ¨è–¦):
     åœ¨ docker-compose.agvc.yml ä¸­æ·»åŠ :
     services:
       agvc_server:
         networks:
           agvc_network:
             mac_address: "02:42:AC:14:00:10"

  2. ä½¿ç”¨ host ç¶²è·¯æ¨¡å¼:
     network_mode: "host"
     (æ³¨æ„: æœƒèˆ‡å®¿ä¸»æ©Ÿå…±äº«ç¶²è·¯ï¼Œå¯èƒ½æœ‰ç«¯å£è¡çª)

  3. æ›´æ–°é…ç½®æª”æ¡ˆ MAC åœ°å€:
     åŸ·è¡Œ: show_device_mac_info --update-config
```

**ç¶²è·¯æ¨¡å¼æª¢æ¸¬**:
- **host æ¨¡å¼**: ä½¿ç”¨å®¿ä¸»æ©Ÿç¶²è·¯ï¼ŒMAC åœ°å€ç©©å®š
- **bridge æ¨¡å¼**: å®¹å™¨ç¨ç«‹ç¶²è·¯ï¼Œå¯èƒ½æœ‰å‹•æ…‹ MAC åœ°å€å•é¡Œ
- **bridge + å›ºå®š MAC**: åœ¨ docker-compose.yml ä¸­å›ºå®š MAC åœ°å€

#### 6.4 è‡ªå‹•æ›´æ–°é…ç½®æª”æ¡ˆ

**--update-config é¸é …** - è‡ªå‹•æ›´æ–°é…ç½®æª”æ¡ˆä¸­çš„ MAC åœ°å€
```bash
show_device_mac_info --update-config
```

**æ“ä½œæµç¨‹**:
1. æª¢æ¸¬ä¸»è¦ MAC åœ°å€
2. æª¢æŸ¥é…ç½®æª”æ¡ˆæ˜¯å¦å·²åŒ…å«è©² MAC
3. å‚™ä»½åŸå§‹é…ç½®æª”æ¡ˆï¼ˆ`hardware_mapping.yaml.backup.YYYYMMDD_HHMMSS`ï¼‰
4. ä½¿ç”¨ Python æ›´æ–° YAML é…ç½®
5. æ·»åŠ  MAC åœ°å€åˆ°è¨­å‚™é…ç½®ä¸­
6. æ›´æ–°æè¿°æ¬„ä½ï¼ˆè¨˜éŒ„æ›´æ–°æ™‚é–“ï¼‰

**å®‰å…¨æ©Ÿåˆ¶**:
- è‡ªå‹•å‚™ä»½åŸå§‹é…ç½®
- é©—è­‰é…ç½®çµæ§‹
- éŒ¯èª¤è™•ç†å’Œå›æ»¾

#### 6.5 ç”Ÿæˆ Docker Compose é…ç½®

**--generate-compose é¸é …** - ç”Ÿæˆå›ºå®š MAC åœ°å€çš„ Docker Compose é…ç½®
```bash
show_device_mac_info --generate-compose
```

**ç”Ÿæˆæª”æ¡ˆ**: `/tmp/docker-compose.agvc.mac-fixed.yml`

**é…ç½®å…§å®¹**:
```yaml
# Docker Compose é…ç½® - å›ºå®š AGVC å®¹å™¨ MAC åœ°å€
# ç”Ÿæˆæ™‚é–“: 2025-10-31 08:39:58
# è¨­å‚™ ID: agvc001
# MAC åœ°å€: 02:42:AC:14:00:10

version: '3.8'

services:
  agvc_server:
    image: yazelin/agvc:latest
    container_name: agvc_server
    restart: unless-stopped

    # å›ºå®š MAC åœ°å€é…ç½®
    networks:
      agvc_network:
        mac_address: "02:42:AC:14:00:10"

    ports:
      - "2200:2200"
      - "7447:7447"
      - "8000-8002:8000-8002"

    volumes:
      - ./app:/app
      - ./data:/data

    environment:
      - CONTAINER_TYPE=agvc
      - MANUAL_DEVICE_ID=agvc001

networks:
  agvc_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
          gateway: 172.20.0.1
```

**ä½¿ç”¨èªªæ˜**:
```
ğŸ“‹ ä½¿ç”¨æ–¹å¼:
  1. åœæ­¢ç•¶å‰ AGVC å®¹å™¨:
     docker compose -f docker-compose.agvc.yml down

  2. ä½¿ç”¨æ–°é…ç½®å•Ÿå‹•:
     docker compose -f /tmp/docker-compose.agvc.mac-fixed.yml up -d

  3. æˆ–è€…å°‡é…ç½®åˆä½µåˆ°ç¾æœ‰çš„ docker-compose.agvc.yml ä¸­

âš ï¸ æ³¨æ„äº‹é …:
  - ç¢ºä¿ MAC åœ°å€åœ¨ç¶²è·¯ä¸­æ˜¯å”¯ä¸€çš„
  - å›ºå®š MAC åœ°å€å¾Œï¼Œè¨­å‚™è­˜åˆ¥å°‡æ›´åŠ ç©©å®š
  - å»ºè­°åœ¨ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²å‰é€²è¡Œæ¸¬è©¦
```

#### 6.6 é¡¯ç¤ºè¨­å‚™é…ç½®è³‡è¨Š

**show_device_config** - é¡¯ç¤ºè¨­å‚™é…ç½®è³‡è¨Š
```bash
show_device_config
```

**é¡¯ç¤ºå…§å®¹**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ è¨­å‚™é…ç½®è³‡è¨Š
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ é…ç½®æª”æ¡ˆæª¢æŸ¥:
  âœ… é…ç½®æª”æ¡ˆå­˜åœ¨: /app/config/agvc/agvc001.yaml
  ğŸ“Š æª”æ¡ˆå¤§å°: 2.3 KB
  ğŸ•’ ä¿®æ”¹æ™‚é–“: 2025-10-31 07:30:45

ğŸ—‚ï¸ ç¡¬é«”æ˜ å°„æª”æ¡ˆæª¢æŸ¥:
  âœ… ç¡¬é«”æ˜ å°„æª”æ¡ˆå­˜åœ¨
  ğŸ“Š æª”æ¡ˆå¤§å°: 5.6 KB

ğŸ“‹ æ—¥èªŒæª”æ¡ˆæª¢æŸ¥:
  âœ… device_identification.log: 1.2 KB
  âœ… device_hardware_info.log: 856 B
```

---

## ğŸŒ æ¨¡çµ„ 7: remote-agv-management.bash - é ç¨‹ AGV ç®¡ç†æ¨¡çµ„

**è·¯å¾‘**: `/app/setup_modules/remote-agv-management.bash`

### åŠŸèƒ½æ¦‚è¿°
æä¾›é€šé SSH é ç¨‹ç®¡ç† AGV å®¹å™¨çš„ launch ç¯€é»åŠŸèƒ½ï¼Œæ”¯æ´æ‰¹é‡æ“ä½œå’Œç‹€æ…‹æª¢æŸ¥ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 7.1 é ç¨‹ AGV Launch ç®¡ç†

**manage_remote_agv_launch** - ç®¡ç†é ç¨‹ AGV Launch
```bash
manage_remote_agv_launch <agv_name> {start|stop|restart|status|logs}

# ç¯„ä¾‹
manage_remote_agv_launch cargo02 status    # æª¢æŸ¥ç‹€æ…‹
manage_remote_agv_launch cargo02 start     # å•Ÿå‹• launch
manage_remote_agv_launch loader02 restart  # é‡å•Ÿ
manage_remote_agv_launch cargo02 logs      # æŸ¥çœ‹æ—¥èªŒ
```

**å¯ç”¨çš„ AGV**:
```
- cargo02     (192.168.10.11:2222)  Cargo Mover AGV
- loader02    (192.168.10.12:2222)  Loader AGV
- unloader02  (192.168.10.13:2222)  Unloader AGV
```

**é…ç½®ä¾†æº**:
1. **ä¸»è¦ä¾†æº**: `/app/config/node_registry.yaml`ï¼ˆä½¿ç”¨ yq è§£æï¼‰
2. **é™ç´šæ–¹æ¡ˆ**: ç¡¬ç·¨ç¢¼é…ç½®ï¼ˆèˆ‡èˆŠç‰ˆæœ¬å…¼å®¹ï¼‰

**é…ç½®çµæ§‹ï¼ˆnode_registry.yamlï¼‰**:
```yaml
remote_agvs:
  cargo02:
    ip: 192.168.10.11
    port: 2222              # å®¿ä¸»æ©Ÿ SSH ç«¯å£
    user: ct
    password: "36274806"
    type: cargo_agv
  loader02:
    ip: 192.168.10.12
    port: 2222
    user: ct
    password: "36274806"
    type: loader_agv
  unloader02:
    ip: 192.168.10.13
    port: 2222
    user: ct
    password: "36274806"
    type: unloader_agv
```

#### 7.2 æ“ä½œè©³è§£

**status - æª¢æŸ¥ç‹€æ…‹**:
```bash
manage_remote_agv_launch cargo02 status
```

**æª¢æŸ¥æµç¨‹**:
1. æ¸¬è©¦ SSH é€£æ¥
2. æŸ¥è©¢ ROS 2 ç¯€é»ï¼ˆ`ros2 node list`ï¼‰
3. é¡¯ç¤ºé‹è¡Œä¸­çš„ç¯€é»

**è¼¸å‡ºç¯„ä¾‹**:
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸš— ç®¡ç†é ç¨‹ AGV: cargo02
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ç›®æ¨™: ct@192.168.10.11:2222
ğŸ·ï¸  é¡å‹: cargo_agv
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š æª¢æŸ¥ AGV ç¯€é»ç‹€æ…‹...

âœ… SSH é€£æ¥æˆåŠŸ
ğŸ” æŸ¥è©¢ ROS 2 ç¯€é»...
âœ… AGV ç¯€é»é‹è¡Œä¸­:
   â€¢ /cargo/plc_service
   â€¢ /cargo/joy_linux_node
   â€¢ /cargo/agv_core_node
```

**start - å•Ÿå‹• Launch**:
```bash
manage_remote_agv_launch cargo02 start
```

**å•Ÿå‹•æµç¨‹**:
1. æ ¹æ“š AGV é¡å‹ç¢ºå®š package åç¨±
   - cargo_agv â†’ cargo_mover_agv
   - loader_agv â†’ loader_agv
   - unloader_agv â†’ unloader_agv
2. ç™¼é€å•Ÿå‹•å‘½ä»¤ï¼š`ros2 launch <package> launch.py`
3. ä½¿ç”¨ nohup èƒŒæ™¯åŸ·è¡Œï¼Œæ—¥èªŒè¼¸å‡ºåˆ° `/tmp/agv_launch.log`
4. ç­‰å¾… 2 ç§’å¾Œé©—è­‰ç¯€é»ç‹€æ…‹

**è¼¸å‡ºç¯„ä¾‹**:
```
ğŸš€ å•Ÿå‹• AGV Launch...

ğŸ“¦ Package: cargo_mover_agv
ğŸ¯ Action: ros2 launch cargo_mover_agv launch.py

âœ… AGV Launch å•Ÿå‹•å‘½ä»¤å·²ç™¼é€

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  é©—è­‰ç¯€é»ç‹€æ…‹...
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… AGV ç¯€é»é‹è¡Œä¸­:
   â€¢ /cargo/plc_service
   â€¢ /cargo/agv_core_node
```

**stop - åœæ­¢ç¯€é»**:
```bash
manage_remote_agv_launch cargo02 stop
```

**åœæ­¢æµç¨‹**:
1. æ ¹æ“š AGV é¡å‹ç¢ºå®š package åç¨±
2. ä½¿ç”¨ pkill åœæ­¢ç›¸é—œé€²ç¨‹ï¼š`pkill -f 'ros2 launch <package>'`

**restart - é‡å•Ÿç¯€é»**:
```bash
manage_remote_agv_launch cargo02 restart
```

**é‡å•Ÿæµç¨‹**:
1. èª¿ç”¨ stop æ“ä½œ
2. ç­‰å¾… 2 ç§’
3. èª¿ç”¨ start æ“ä½œ
4. é©—è­‰ç¯€é»ç‹€æ…‹

**logs - æŸ¥çœ‹æ—¥èªŒ**:
```bash
manage_remote_agv_launch cargo02 logs
```

**æ—¥èªŒæŸ¥çœ‹**:
- é¡¯ç¤º `/tmp/agv_launch.log` æœ€å¾Œ 30 è¡Œ
- å¦‚æœæ—¥èªŒæª”æ¡ˆä¸å­˜åœ¨ï¼Œæç¤º Launch å¯èƒ½å¾æœªå•Ÿå‹•

#### 7.3 æ‰¹é‡æ“ä½œå·¥å…·

**list_remote_agvs / list_agvs** - åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„é ç¨‹ AGV
```bash
list_remote_agvs
list_agvs  # åˆ¥å
```

**è¼¸å‡ºç¯„ä¾‹**:
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸš— å¯ç”¨çš„é ç¨‹ AGV
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  â€¢ cargo02
    â”œâ”€ é¡å‹: cargo_agv
    â”œâ”€ IP: 192.168.10.11
    â””â”€ Port: 2222

  â€¢ loader02
    â”œâ”€ é¡å‹: loader_agv
    â”œâ”€ IP: 192.168.10.12
    â””â”€ Port: 2222

  â€¢ unloader02
    â”œâ”€ é¡å‹: unloader_agv
    â”œâ”€ IP: 192.168.10.13
    â””â”€ Port: 2222

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ ä½¿ç”¨æ–¹æ³•: manage_remote_agv_launch <agv_name> {start|stop|status|logs}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**check_all_remote_agvs / check_agvs** - æ‰¹é‡æª¢æŸ¥æ‰€æœ‰é ç¨‹ AGV ç‹€æ…‹
```bash
check_all_remote_agvs
check_agvs  # åˆ¥å
```

**æ“ä½œæµç¨‹**:
1. å¾é…ç½®æª”æ¡ˆæˆ–é™ç´šæ–¹æ¡ˆç²å– AGV åˆ—è¡¨
2. é€ä¸€èª¿ç”¨ `manage_remote_agv_launch <agv> status`
3. é¡¯ç¤ºæ‰€æœ‰ AGV çš„ç‹€æ…‹

**è¼¸å‡ºç¯„ä¾‹**:
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“Š æ‰¹é‡æª¢æŸ¥æ‰€æœ‰é ç¨‹ AGV ç‹€æ…‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[cargo02 ç‹€æ…‹æª¢æŸ¥çµæœ]
âœ… AGV ç¯€é»é‹è¡Œä¸­

[loader02 ç‹€æ…‹æª¢æŸ¥çµæœ]
âš ï¸  æœªæª¢æ¸¬åˆ° AGV ç¯€é»

[unloader02 ç‹€æ…‹æª¢æŸ¥çµæœ]
âŒ SSH é€£æ¥å¤±æ•—

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  æª¢æŸ¥å®Œæˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

#### 7.4 é…ç½®è®€å–æ©Ÿåˆ¶

**get_agv_config** - å¾é…ç½®æª”æ¡ˆè®€å– AGV é…ç½®ï¼ˆå…§éƒ¨å‡½æ•¸ï¼‰
```bash
# å…§éƒ¨ä½¿ç”¨ï¼Œä¸å»ºè­°ç›´æ¥èª¿ç”¨
get_agv_config <agv_name>

# è¿”å›æ ¼å¼: "ip|port|user|password|type"
# ç¯„ä¾‹: "192.168.10.11|2222|ct|36274806|cargo_agv"
```

**è®€å–é‚è¼¯**:
1. **ä¸»è¦æ–¹æ³•**: ä½¿ç”¨ yq è§£æ `/app/config/node_registry.yaml`
   ```bash
   yq -r ".remote_agvs.$agv_name.ip" "$config_file"
   yq -r ".remote_agvs.$agv_name.port" "$config_file"
   yq -r ".remote_agvs.$agv_name.user" "$config_file"
   yq -r ".remote_agvs.$agv_name.password" "$config_file"
   yq -r ".remote_agvs.$agv_name.type" "$config_file"
   ```

2. **é™ç´šæ–¹æ¡ˆ**: å¦‚æœ yq ä¸å¯ç”¨æˆ–é…ç½®æª”æ¡ˆä¸å­˜åœ¨ï¼Œä½¿ç”¨ç¡¬ç·¨ç¢¼é…ç½®
   - ç¢ºä¿èˆ‡èˆŠç‰ˆæœ¬å…¼å®¹
   - æä¾›åŸºæœ¬çš„ AGV ç®¡ç†åŠŸèƒ½

#### 7.5 ä¾è³´å·¥å…·

**sshpass** - SSH å¯†ç¢¼èªè­‰å·¥å…·
- ç”¨æ–¼éäº’å‹•å¼ SSH é€£æ¥
- å®¹å™¨å…§å·²é å®‰è£

**yq** - YAML è™•ç†å·¥å…·ï¼ˆå¯é¸ï¼‰
- ç”¨æ–¼è§£æ node_registry.yaml
- å¦‚ä¸å¯ç”¨ï¼Œè‡ªå‹•é™ç´šåˆ°ç¡¬ç·¨ç¢¼é…ç½®

**SSH é€£æ¥é¸é …**:
```bash
-p $agv_port                # æŒ‡å®šç«¯å£ï¼ˆ2222ï¼‰
-o StrictHostKeyChecking=no # ä¸æª¢æŸ¥ host key
-o ConnectTimeout=5         # é€£æ¥è¶…æ™‚ 5 ç§’
```

#### 7.6 åˆ¥åå®šç¾©

```bash
alias list_agvs='list_remote_agvs'
alias check_agvs='check_all_remote_agvs'
```

---

## ğŸš€ ä½¿ç”¨å ´æ™¯å’Œæœ€ä½³å¯¦è¸

### å ´æ™¯ 1: å®¹å™¨å•Ÿå‹•å¾Œåˆå§‹åŒ–ç’°å¢ƒ

```bash
# [å®¹å™¨å…§] å®¹å™¨å•Ÿå‹•å¾Œè‡ªå‹•åŸ·è¡Œ
source /app/setup.bash

# ç³»çµ±è‡ªå‹•å®Œæˆï¼š
# 1. è¼‰å…¥æ‰€æœ‰æ¨¡çµ„
# 2. è¨­å®š ROS 2 ç’°å¢ƒï¼ˆjazzy + rmw_zenohï¼‰
# 3. è‡ªå‹•å•Ÿå‹• Zenoh Router
# 4. å®šç¾©æ‰€æœ‰åˆ¥åå’Œå‡½æ•¸
# 5. é¡¯ç¤ºåˆå§‹åŒ–è¨Šæ¯
```

### å ´æ™¯ 2: é–‹ç™¼æµç¨‹ - ä¿®æ”¹ä»£ç¢¼å¾Œé‡æ–°å»ºç½®

```bash
# [å®¹å™¨å…§] å®Œæ•´æµç¨‹
manage_web_api_launch stop    # 1. åœæ­¢æœå‹™
ba                           # 2. é‡æ–°å»ºç½®ï¼ˆæ ¹æ“šç’°å¢ƒè‡ªå‹•é¸æ“‡ï¼‰
sa                           # 3. é‡æ–°è¼‰å…¥ç’°å¢ƒ
manage_web_api_launch start  # 4. å•Ÿå‹•æœå‹™
```

### å ´æ™¯ 3: å–®ä¸€å¥—ä»¶é–‹ç™¼

```bash
# [å®¹å™¨å…§] åªé‡å»ºç‰¹å®šå·¥ä½œç©ºé–“
manage_web_api_launch stop
build_ws web_api_ws          # å»ºç½®å–®ä¸€å·¥ä½œç©ºé–“ï¼Œè‡ªå‹•è¼‰å…¥
manage_web_api_launch start
```

### å ´æ™¯ 4: è¨ºæ–·ç³»çµ±å•é¡Œ

```bash
# [å®¹å™¨å…§] ç³»çµ±è¨ºæ–·
status                       # æª¢æŸ¥æ•´é«”ç‹€æ…‹
zenoh                        # æª¢æŸ¥ Zenoh Router
rosenv                       # æª¢æŸ¥ ROS 2 ç’°å¢ƒ
check_device_identity        # æª¢æŸ¥è¨­å‚™èº«ä»½
mac_info                     # æª¢æŸ¥ MAC åœ°å€å•é¡Œ
```

### å ´æ™¯ 5: æ¸…ç†å’Œé‡æ–°å»ºç½®

```bash
# [å®¹å™¨å…§] å®Œå…¨æ¸…ç†é‡å»º
manage_web_api_launch stop   # åœæ­¢æœå‹™
ca                          # æ¸…ç†æ‰€æœ‰å·¥ä½œç©ºé–“
ba                          # é‡æ–°å»ºç½®
sa                          # é‡æ–°è¼‰å…¥
manage_web_api_launch start # å•Ÿå‹•æœå‹™
```

### å ´æ™¯ 6: é ç¨‹ AGV ç®¡ç†

```bash
# [AGVC å®¹å™¨å…§] æ‰¹é‡æª¢æŸ¥æ‰€æœ‰ AGV
check_agvs

# å•Ÿå‹•ç‰¹å®š AGV
manage_remote_agv_launch cargo02 start

# æŸ¥çœ‹ AGV æ—¥èªŒ
manage_remote_agv_launch cargo02 logs
```

### å ´æ™¯ 7: è‡¨æ™‚æª”æ¡ˆæ¸…ç†

```bash
# [å®¹å™¨å…§] å®šæœŸç¶­è­·
cleanup_temp_files --dry-run  # å…ˆæ¨¡æ“¬æ¸…ç†
cleanup_temp_files            # åŸ·è¡Œæ¸…ç†ï¼ˆ7 å¤©å‰ï¼‰
cleanup_temp_files --force    # å¼·åˆ¶æ¸…ç†ï¼ˆ1 å¤©å‰ï¼‰
```

### å ´æ™¯ 8: MAC åœ°å€å•é¡Œè¨ºæ–·å’Œä¿®å¾©

```bash
# [å®¹å™¨å…§] æª¢æ¸¬ MAC åœ°å€å•é¡Œ
mac_info

# è©³ç´°è¨ºæ–·
mac_info --verbose

# è‡ªå‹•ä¿®å¾©é…ç½®
mac_info --update-config

# ç”Ÿæˆå›ºå®š MAC çš„ Docker Compose é…ç½®
mac_info --generate-compose
```

---

## ğŸ“Š æ¨¡çµ„ä¾è³´é—œä¿‚åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /app/setup.bash (ä¸»å…¥å£)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. common.bash (åŸºç¤æ¨¡çµ„ï¼Œè¢«æ‰€æœ‰æ¨¡çµ„ä¾è³´)                      â”‚
â”‚    - æ—¥èªŒç³»çµ±ã€é¡è‰²å®šç¾©                                        â”‚
â”‚    - åŸºç¤å·¥å…·å‡½æ•¸ã€ç’°å¢ƒæª¢æ¸¬                                    â”‚
â”‚    - ç¯€é»å•Ÿå‹•é©—è­‰å‡½æ•¸                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. build-tools.bash  â”‚ 3. workspace-loader  â”‚ 4. node-mgmt    â”‚
â”‚    - AGV/AGVC å»ºç½®   â”‚    - AGV/AGVC è¼‰å…¥   â”‚    - æœå‹™ç®¡ç†   â”‚
â”‚    - ä¾è³´è§£æå»ºç½®    â”‚    - é ç«¯åŒæ­¥        â”‚    - è‡¨æ™‚æ¸…ç†   â”‚
â”‚    - æ¸…ç†å·¥å…·        â”‚    - å¹«åŠ©ç³»çµ±        â”‚    - é©—è­‰æ©Ÿåˆ¶   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. system-checks.bash        â”‚ 6. device-identity.bash         â”‚
â”‚    - ROS ç’°å¢ƒæª¢æŸ¥            â”‚    - è¨­å‚™èº«ä»½è­˜åˆ¥               â”‚
â”‚    - Zenoh ç‹€æ…‹æª¢æŸ¥          â”‚    - MAC åœ°å€ç®¡ç†               â”‚
â”‚    - ç³»çµ±æ•´é«”è¨ºæ–·            â”‚    - é…ç½®ç”Ÿæˆ                   â”‚
â”‚    - è‡ªå‹•å•Ÿå‹•æœå‹™            â”‚    - Docker Compose ç”Ÿæˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. remote-agv-management.bash                                   â”‚
â”‚    - é ç¨‹ SSH ç®¡ç†                                              â”‚
â”‚    - æ‰¹é‡ AGV æ“ä½œ                                              â”‚
â”‚    - é…ç½®æª”æ¡ˆè®€å–                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ ç’°å¢ƒè®Šæ•¸åƒè€ƒ

### ROS 2 ç’°å¢ƒè®Šæ•¸
```bash
ROS_DISTRO=jazzy                        # ROS 2 ç™¼è¡Œç‰ˆ
RMW_IMPLEMENTATION=rmw_zenoh_cpp        # RMW å¯¦ä½œï¼ˆä½¿ç”¨ Zenohï¼‰
ZENOH_ROUTER_CONFIG_URI=/app/routerconfig.json5
```

### å®¹å™¨ç’°å¢ƒè®Šæ•¸
```bash
CONTAINER_TYPE=agv|agvc                 # å®¹å™¨é¡å‹ï¼ˆç”¨æ–¼ç’°å¢ƒæª¢æ¸¬ï¼‰
MANUAL_DEVICE_ID=<device_id>            # æ‰‹å‹•æŒ‡å®šè¨­å‚™ IDï¼ˆå¯é¸ï¼‰
```

### é™¤éŒ¯ç’°å¢ƒè®Šæ•¸
```bash
LOG_LEVEL=DEBUG                         # å•Ÿç”¨é™¤éŒ¯æ—¥èªŒ
DEVICE_DEBUG=true                       # è¨­å‚™è­˜åˆ¥é™¤éŒ¯æ¨¡å¼
```

### Python è™›æ“¬ç’°å¢ƒ
```bash
PYTHONPATH=/opt/pyvenv_env/lib/python3.12/site-packages:$PYTHONPATH
VIRTUAL_ENV=/opt/pyvenv_env
```

---

## ğŸ“š å¸¸ç”¨åˆ¥åé€ŸæŸ¥è¡¨

### æª”æ¡ˆç³»çµ±
| åˆ¥å | å®Œæ•´å‘½ä»¤ | èªªæ˜ |
|------|---------|------|
| `ll` | `ls -alF` | è©³ç´°åˆ—è¡¨ |
| `la` | `ls -A` | é¡¯ç¤ºéš±è—æª”æ¡ˆ |
| `l` | `ls -CF` | ç·Šæ¹Šåˆ—è¡¨ |
| `..` | `cd ..` | ä¸Šä¸€å±¤ç›®éŒ„ |
| `...` | `cd ../..` | ä¸Šå…©å±¤ç›®éŒ„ |

### ROS 2 æ“ä½œ
| åˆ¥å | å®Œæ•´å‘½ä»¤ | èªªæ˜ |
|------|---------|------|
| `rn` | `ros2 node list` | åˆ—å‡ºç¯€é» |
| `rt` | `ros2 topic list` | åˆ—å‡ºä¸»é¡Œ |
| `rs` | `ros2 service list` | åˆ—å‡ºæœå‹™ |
| `ri` | `ros2 interface list` | åˆ—å‡ºä»‹é¢ |

### å·¥ä½œç©ºé–“ç®¡ç†
| åˆ¥å | å®Œæ•´å‘½ä»¤ | èªªæ˜ |
|------|---------|------|
| `ba` | `build_all` | è‡ªå‹•å»ºç½® |
| `bas` | `build_all_smart` | ä¾è³´è§£æå»ºç½® |
| `ta` | `test_all` | æ¸¬è©¦æ‰€æœ‰ |
| `ca` | `clean_all` | æ¸…ç†æ‰€æœ‰ |
| `sa` | `all_source` | è‡ªå‹•è¼‰å…¥ |
| `agv` | `agv_source` | AGV å·¥ä½œç©ºé–“ |
| `agvc` | `agvc_source` | AGVC å·¥ä½œç©ºé–“ |
| `build1` | `build_single` | å»ºç½®å–®ä¸€ |
| `test1` | `test_single` | æ¸¬è©¦å–®ä¸€ |
| `clean1` | `clean_single` | æ¸…ç†å–®ä¸€ |

### ç³»çµ±è¨ºæ–·
| åˆ¥å | å®Œæ•´å‘½ä»¤ | èªªæ˜ |
|------|---------|------|
| `status` | `check_system_status` | ç³»çµ±ç‹€æ…‹ |
| `zenoh` | `check_zenoh_status` | Zenoh ç‹€æ…‹ |
| `rosenv` | `check_ros_env` | ROS ç’°å¢ƒ |
| `help` | `show_help` | å¹«åŠ©è³‡è¨Š |

### è‡¨æ™‚æª”æ¡ˆæ¸…ç†
| åˆ¥å | å®Œæ•´å‘½ä»¤ | èªªæ˜ |
|------|---------|------|
| `ct` | `cleanup_temp_files` | æ¸…ç†è‡¨æ™‚æª”æ¡ˆ |
| `cleanup_temp` | `cleanup_temp_files` | æ¸…ç†è‡¨æ™‚æª”æ¡ˆ |

### è¨­å‚™ç®¡ç†
| åˆ¥å | å®Œæ•´å‘½ä»¤ | èªªæ˜ |
|------|---------|------|
| `mac_info` | `show_device_mac_info` | MAC åœ°å€è³‡è¨Š |

### é ç¨‹ AGV
| åˆ¥å | å®Œæ•´å‘½ä»¤ | èªªæ˜ |
|------|---------|------|
| `list_agvs` | `list_remote_agvs` | åˆ—å‡º AGV |
| `check_agvs` | `check_all_remote_agvs` | æ‰¹é‡æª¢æŸ¥ |

---

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ 1: æ¨¡çµ„è¼‰å…¥å¤±æ•—

**ç—‡ç‹€**:
```
âŒ éŒ¯èª¤: common.bash æ¨¡çµ„ä¸å­˜åœ¨
```

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥æ¨¡çµ„æª”æ¡ˆæ˜¯å¦å­˜åœ¨
ls -la /app/setup_modules/

# é‡æ–°ä¸‹è¼‰æˆ–æ¢å¾©æ¨¡çµ„æª”æ¡ˆ
# ç¢ºä¿æ‰€æœ‰ 7 å€‹æ¨¡çµ„æª”æ¡ˆéƒ½å­˜åœ¨
```

### å•é¡Œ 2: ç’°å¢ƒè®Šæ•¸æœªè¨­å®š

**ç—‡ç‹€**:
```
âŒ ROS_DISTRO æœªè¨­å®š
```

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# ç¢ºä¿è¼‰å…¥ setup.bash
source /app/setup.bash

# æª¢æŸ¥ ROS 2 å®‰è£
ls /opt/ros/jazzy/setup.bash
```

### å•é¡Œ 3: Zenoh Router å•Ÿå‹•å¤±æ•—

**ç—‡ç‹€**:
```
âŒ Zenoh Router æœªé‹è¡Œ
```

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥é…ç½®æª”æ¡ˆ
cat /app/routerconfig.json5

# æ‰‹å‹•å•Ÿå‹• Zenoh
manage_zenoh restart

# æª¢æŸ¥æ—¥èªŒ
cat /tmp/zenoh_router.log
```

### å•é¡Œ 4: å·¥ä½œç©ºé–“å»ºç½®å¤±æ•—

**ç—‡ç‹€**:
```
âŒ agv_ws å»ºç½®å¤±æ•—
```

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æ¸…ç†ä¸¦é‡å»º
clean_ws agv_ws
build_ws agv_ws

# æª¢æŸ¥ä¾è³´æ˜¯å¦å·²å»ºç½®
ls /app/shared_constants_ws/install/
ls /app/keyence_plc_ws/install/
```

### å•é¡Œ 5: MAC åœ°å€ä¸åŒ¹é…

**ç—‡ç‹€**:
```
âŒ MAC åœ°å€ä¸åŒ¹é…ï¼Œä½¿ç”¨é è¨­é™ç´šè­˜åˆ¥
```

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆ 1: æ›´æ–°é…ç½®æª”æ¡ˆ
mac_info --update-config

# æ–¹æ¡ˆ 2: ç”Ÿæˆå›ºå®š MAC çš„ Docker Compose
mac_info --generate-compose

# æ–¹æ¡ˆ 3: ä½¿ç”¨ host ç¶²è·¯æ¨¡å¼ï¼ˆéœ€ä¿®æ”¹ docker-compose.ymlï¼‰
```

### å•é¡Œ 6: é ç¨‹ AGV é€£æ¥å¤±æ•—

**ç—‡ç‹€**:
```
âŒ SSH é€£æ¥å¤±æ•—
```

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# 1. æª¢æŸ¥ç¶²è·¯é€£æ¥
ping 192.168.10.11

# 2. æª¢æŸ¥ SSH æœå‹™ï¼ˆåœ¨ AGV å®¹å™¨å…§ï¼‰
ps aux | grep sshd
manage_ssh status

# 3. æª¢æŸ¥ç«¯å£ï¼ˆåœ¨ AGV å®¿ä¸»æ©Ÿï¼‰
ss -tulpn | grep 2222

# 4. æª¢æŸ¥æ†‘è­‰ï¼ˆåœ¨ AGVC å®¹å™¨å…§ï¼‰
cat /app/config/node_registry.yaml

# 5. æ¸¬è©¦æ‰‹å‹•é€£æ¥
sshpass -p password ssh -p 2222 ct@192.168.10.11
```

---

## ğŸ“ é–‹ç™¼æŒ‡å—

### æ–°å¢æ¨¡çµ„

**æ­¥é©Ÿ 1: å‰µå»ºæ¨¡çµ„æª”æ¡ˆ**
```bash
# åœ¨ /app/setup_modules/ å‰µå»ºæ–°æ¨¡çµ„
touch /app/setup_modules/my-module.bash
chmod +x /app/setup_modules/my-module.bash
```

**æ­¥é©Ÿ 2: ç·¨å¯«æ¨¡çµ„å…§å®¹**
```bash
#!/bin/bash
# My Module - æ¨¡çµ„æè¿°

# ä½¿ç”¨ common.bash çš„æ—¥èªŒå‡½æ•¸
log_info "è¼‰å…¥ My Module..."

# å®šç¾©å‡½æ•¸
my_function() {
    log_info "åŸ·è¡Œ my_function"
    # å‡½æ•¸é‚è¼¯
}

# å®šç¾©åˆ¥å
alias my='my_function'

# æ¨¡çµ„åˆå§‹åŒ–
log_debug "âœ… My Module å·²è¼‰å…¥"
```

**æ­¥é©Ÿ 3: åœ¨ setup.bash ä¸­è¼‰å…¥**
```bash
# ç·¨è¼¯ /app/setup.bash
# åœ¨é©ç•¶ä½ç½®æ·»åŠ ï¼š

if [ -f "$MODULES_DIR/my-module.bash" ]; then
    source "$MODULES_DIR/my-module.bash"
    log_debug "âœ… è¼‰å…¥ my-module æ¨¡çµ„"
else
    log_error "my-module.bash æ¨¡çµ„ä¸å­˜åœ¨"
fi
```

### æ¨¡çµ„é–‹ç™¼æœ€ä½³å¯¦è¸

1. **ä½¿ç”¨ log å‡½æ•¸**: çµ±ä¸€ä½¿ç”¨ `log_info`, `log_success`, `log_error` ç­‰
2. **éŒ¯èª¤è™•ç†**: å‡½æ•¸æ‡‰è¿”å›æ­£ç¢ºçš„é€€å‡ºç¢¼ï¼ˆ0 = æˆåŠŸï¼Œé 0 = å¤±æ•—ï¼‰
3. **ä¾è³´æª¢æŸ¥**: æª¢æŸ¥å¿…è¦çš„å·¥å…·å’Œç’°å¢ƒè®Šæ•¸
4. **ç’°å¢ƒå…¼å®¹**: æ”¯æ´ AGV/AGVC é›™ç’°å¢ƒ
5. **åˆ¥åå®šç¾©**: æä¾›ç°¡çŸ­æ˜“è¨˜çš„åˆ¥å
6. **æ–‡æª”è¨»è§£**: æ·»åŠ è©³ç´°çš„å‡½æ•¸èªªæ˜

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [ROS 2 é–‹ç™¼è¦å‰‡](../../../ai-agents/ros2-development-rules.md)
- [å®¹å™¨é–‹ç™¼è¦å‰‡](../../../ai-agents/container-development-rules.md)
- [çµ±ä¸€å·¥å…·ä½¿ç”¨æŒ‡å—](../../../ai-agents/unified-tools-usage.md)
- [Docker é–‹ç™¼æµç¨‹](../development/docker-development.md)

---

**æ–‡æª”ç‰ˆæœ¬**: 1.0.0
**æœ€å¾Œæ›´æ–°**: 2025-10-31
**ç¶­è­·è€…**: RosAGV é–‹ç™¼åœ˜éšŠ
