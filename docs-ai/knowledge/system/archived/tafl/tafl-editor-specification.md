# âš ï¸ å·²æ£„ç”¨ä¸¦æ­¸æª” (DEPRECATED & ARCHIVED)

**æ£„ç”¨æ—¥æœŸ**: 2025-11-18
**æ­¸æª”åŸå› **: TAFL Editor å’Œ TAFL WCS ç³»çµ±å·²è¢« KUKA WCS å®Œå…¨å–ä»£
**æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨ `kuka_wcs_ws` é€²è¡Œå€‰å„²æ§åˆ¶ç³»çµ±é–‹ç™¼
**é·ç§»æŒ‡å—**: åƒè¦‹ /home/ct/RosAGV/docs-ai/guides/migration-from-tafl-to-kuka-wcs.md

æœ¬æ–‡æª”å·²ç§»è‡³ archived ç›®éŒ„ï¼Œåƒ…ä¾›æ­·å²åƒè€ƒã€‚ä¸æ‡‰å†ç”¨æ–¼æ–°çš„é–‹ç™¼å·¥ä½œã€‚

---

# TAFL Editor è¦æ ¼æ›¸ (Specification Document)

## ğŸ“‹ æ–‡ä»¶è³‡è¨Š
- **ç‰ˆæœ¬**: v3.1
- **æ›´æ–°æ—¥æœŸ**: 2025-09-03
- **å¯¦ä½œä½ç½®**: `/home/ct/RosAGV/app/web_api_ws/src/agvcui/agvcui/static/js/tafl-editor.js`
- **å¥—ä»¶æ­¸å±¬**: agvcui (è»ŠéšŠç®¡ç†ç•Œé¢ç³»çµ±)
- **æœå‹™ç«¯å£**: 8001 (AGVCUI ç®¡ç†ç•Œé¢)
- **æª”æ¡ˆå¤§å°**: 2606 è¡Œ (å–®é«”æ¶æ§‹ï¼Œè¨ˆåŠƒæ¨¡çµ„åŒ–)
- **åŸ·è¡Œæ¨¡å¼**: Real Mode (PostgreSQL) / Simulation Mode

## ğŸ¯ ç³»çµ±æ¦‚è¿°

### ç”¢å“å®šç¾©
**TAFL Editor** æ˜¯ä¸€å€‹å°ˆæ¥­çš„è¦–è¦ºåŒ–æµç¨‹ç·¨è¼¯å™¨ï¼Œç”¨æ–¼å‰µå»ºå’Œç·¨è¼¯ TAFL (Task Automation Flow Language) æ ¼å¼çš„è‡ªå‹•åŒ–æµç¨‹ã€‚æä¾›æ‹–æ”¾å¼ä»‹é¢ã€å³æ™‚é©—è­‰ã€è¦–è¦ºåŒ–é è¦½ç­‰ä¼æ¥­ç´šåŠŸèƒ½ã€‚

### æ ¸å¿ƒå®šä½
- **æ‰€å±¬ç³»çµ±**: agvcui è»ŠéšŠç®¡ç†ç•Œé¢çš„ä¸€éƒ¨åˆ†
- **ä½¿ç”¨è€…**: ç³»çµ±ç®¡ç†å“¡ã€æµç¨‹è¨­è¨ˆå¸«
- **ç”¨é€”**: è¨­è¨ˆ AGV ä»»å‹™è‡ªå‹•åŒ–æµç¨‹ã€WCS å·¥ä½œæµç¨‹
- **è¼¸å‡ºæ ¼å¼**: TAFL v1.1 YAML æª”æ¡ˆ

### æŠ€è¡“æ¶æ§‹
- **å‰ç«¯æ¡†æ¶**: Vanilla JavaScript ES6
- **CSS æ¡†æ¶**: Bulma 1.0.4
- **åœ–æ¨™åº«**: Font Awesome 5
- **ç·¨è¼¯å™¨**: CodeMirror (YAML æ¨¡å¼)
- **å„²å­˜ç³»çµ±**: agvcui miniStore (è¨ˆåŠƒæ•´åˆ)
- **å¾Œç«¯ API**: FastAPI `/tafl/` ç«¯é»ç¾¤çµ„
- **åŸ·è¡Œå¼•æ“**: tafl_editor_direct.py (å¢å¼·ç‰ˆ)
- **è³‡æ–™åº«æ©‹æ¥**: TAFLDatabaseBridge (PostgreSQL)

## ğŸ“ åŠŸèƒ½è¦æ ¼

### 1. æµç¨‹çµæ§‹æ”¯æ´ (TAFL v1.1)

#### å…­æ®µå¼çµæ§‹ (6-Segment Structure)
```yaml
# TAFL v1.1 å®Œæ•´çµæ§‹
metadata:       # æµç¨‹å…ƒè³‡æ–™
settings:       # åŸ·è¡Œè¨­å®š (Phase 0)
preload:        # è³‡æ–™é è¼‰ (Phase 1)
rules:          # æ¥­å‹™è¦å‰‡ (Phase 2)
variables:      # è®Šæ•¸å®šç¾© (Phase 3)
flow:           # ä¸»è¦æµç¨‹ (Phase 4)
```

#### å››éšæ®µåŸ·è¡Œæ¨¡å‹ (4-Phase Execution Model)
1. **Phase 0**: Settings - è¨­å®šåŸ·è¡Œåƒæ•¸
2. **Phase 1**: Preload - é è¼‰å¿…è¦è³‡æ–™
3. **Phase 2**: Rules - é©—è­‰æ¥­å‹™è¦å‰‡
4. **Phase 3**: Variables - åˆå§‹åŒ–è®Šæ•¸
5. **Phase 4**: Flow - åŸ·è¡Œä¸»è¦æµç¨‹

### 2. è¦–è¦ºåŒ–ç·¨è¼¯åŠŸèƒ½

#### æ‹–æ”¾æ“ä½œ (Drag & Drop)
- **å‹•è©å¡ç‰‡æ‹–æ”¾**: å¾å·¦å´é¢æ¿æ‹–å‹•å‹•è©åˆ°ç•«å¸ƒ
- **å¡ç‰‡é‡æ–°æ’åº**: æ‹–å‹•å¡ç‰‡æ”¹è®ŠåŸ·è¡Œé †åº
- **å·¢ç‹€çµæ§‹æ”¯æ´**: æ”¯æ´ if/for ç­‰æ§åˆ¶çµæ§‹çš„å·¢ç‹€æ‹–æ”¾
- **è¦–è¦ºå›é¥‹**: æ‹–å‹•æ™‚é¡¯ç¤ºæ’å…¥ä½ç½®æŒ‡ç¤ºå™¨
- **è‡ªå‹•æ²å‹•**: æ‹–å‹•åˆ°é‚Šç·£æ™‚è‡ªå‹•æ²å‹•ç•«å¸ƒ

#### å¡ç‰‡é¡¯ç¤º (Card Display)
- **åœ–æ¨™ç³»çµ±**: æ¯å€‹å‹•è©æœ‰å°æ‡‰çš„ Font Awesome åœ–æ¨™
- **é¡è‰²ç·¨ç¢¼**: ä¸åŒé¡åˆ¥å‹•è©ä½¿ç”¨ä¸åŒé¡è‰²
- **ç‹€æ…‹æŒ‡ç¤º**: é¸ä¸­ã€éŒ¯èª¤ã€è­¦å‘Šç­‰ç‹€æ…‹è¦–è¦ºåŒ–
- **å·¢ç‹€ç¸®æ’**: æ§åˆ¶çµæ§‹å…§çš„å¡ç‰‡è‡ªå‹•ç¸®æ’é¡¯ç¤º
- **é€£ç·šæ¸²æŸ“**: é¡¯ç¤ºå¡ç‰‡é–“çš„åŸ·è¡Œæµç¨‹é€£ç·š

### 3. å‹•è©æ”¯æ´ (Verb Support)

#### æ”¯æ´çš„ TAFL å‹•è© (10å€‹)
åŸºæ–¼ `/app/web_api_ws/src/agvcui/agvcui/routers/tafl_editor.py` çš„å¯¦éš›å¯¦ä½œï¼š

```python
# å¯¦éš›æ”¯æ´çš„ TAFL v1.1.2 å‹•è©
TAFL_VERBS = {
    "query": {
        "name": "Query",
        "description": "Query data from database or system",
        "color": "is-info",
        "icon": "fas fa-database",
        "params": ["target", "where", "limit", "as"]
    },
    "check": {
        "name": "Check",
        "description": "Check conditions or status",
        "color": "is-success",
        "icon": "fas fa-check-circle",
        "params": ["condition", "as"]  # v1.1.3: 'as' is required
    },
    "create": {
        "name": "Create",
        "description": "Create new resources or records",
        "color": "is-primary",
        "icon": "fas fa-plus-circle",
        "params": ["target", "with", "as"]
    },
    "update": {
        "name": "Update",
        "description": "Update existing data",
        "color": "is-warning",
        "icon": "fas fa-edit",
        "params": ["target", "where", "set"]
    },
    "if": {
        "name": "If",
        "description": "Conditional execution",
        "color": "is-danger",
        "icon": "fas fa-question-circle",
        "params": ["condition", "then", "else"]
    },
    "for": {
        "name": "For",
        "description": "Loop through collection",
        "color": "is-purple",
        "icon": "fas fa-redo",
        "params": ["in", "as", "do", "filter"]
    },
    "switch": {
        "name": "Switch",
        "description": "Multi-branch conditional",
        "color": "is-orange",
        "icon": "fas fa-code-branch",
        "params": ["expression", "cases"]
    },
    "set": {
        "name": "Set",
        "description": "Set variable values",
        "color": "is-dark",
        "icon": "fas fa-equals",
        "params": []  # Dictionary format only in v1.1.2
    },
    "stop": {
        "name": "Stop",
        "description": "Stop flow execution",
        "color": "is-danger-dark",
        "icon": "fas fa-stop-circle",
        "params": ["reason", "condition"]
    },
    "notify": {
        "name": "Notify",
        "description": "Send notifications",
        "color": "is-link",
        "icon": "fas fa-bell",
        "params": ["level", "message", "recipients", "details"]
    }
}
```

#### âš ï¸ ä¸æ”¯æ´çš„å‹•è©
ä»¥ä¸‹å‹•è©åœ¨ TAFL v1.1.2 ä¸­**ä¸å­˜åœ¨**ï¼š
- âŒ delete (åˆªé™¤)
- âŒ while (æ¢ä»¶è¿´åœˆ)
- âŒ break/continue (è¿´åœˆæ§åˆ¶)
- âŒ call/return (å‡½æ•¸å‘¼å«)
- âŒ wait (ç­‰å¾…)
- âŒ get (å–å¾—ï¼Œä½¿ç”¨ query æ›¿ä»£)
- âŒ exec/execute (åŸ·è¡Œå¤–éƒ¨å‘½ä»¤)
- âŒ publish/subscribe (ç™¼å¸ƒè¨‚é–±)
- âŒ api/mqtt/websocket (å¤–éƒ¨é€šè¨Š)
- âŒ log/alert/validate/transform (å·¥å…·å‡½æ•¸)

### 4. å´é‚Šé¢æ¿åŠŸèƒ½

#### å·¦å´é¢æ¿ - å‹•è©åº«
- **å‹•è©åˆ—è¡¨**: 10 å€‹æ”¯æ´çš„ TAFL å‹•è©
- **å‹•è©å¡ç‰‡**: å¯æ‹–å‹•çš„å‹•è©å¡ç‰‡åˆ—è¡¨
- **æœå°‹åŠŸèƒ½**: å¿«é€Ÿæœå°‹å‹•è©ï¼ˆè¨ˆåŠƒåŠŸèƒ½ï¼‰
- **èªªæ˜æç¤º**: æ»‘é¼ æ‡¸åœé¡¯ç¤ºå‹•è©èªªæ˜

#### å³å´é¢æ¿ - å±¬æ€§ç·¨è¼¯
- **Metadata æ¨™ç±¤**: ç·¨è¼¯æµç¨‹å…ƒè³‡æ–™
- **Variables æ¨™ç±¤**: ç®¡ç†æµç¨‹è®Šæ•¸
- **Preload æ¨™ç±¤**: é…ç½®é è¼‰è³‡æ–™
- **Rules æ¨™ç±¤**: å®šç¾©æ¥­å‹™è¦å‰‡
- **Settings æ¨™ç±¤**: åŸ·è¡Œè¨­å®š
- **Properties æ¨™ç±¤**: ç·¨è¼¯é¸ä¸­å¡ç‰‡å±¬æ€§
- **YAML æ¨™ç±¤**: æª¢è¦–/ç·¨è¼¯åŸå§‹ YAML

### 5. ç·¨è¼¯å™¨åŠŸèƒ½

#### åŸºæœ¬ç·¨è¼¯
- **æ–°å¢å¡ç‰‡**: æ‹–æ”¾æˆ–é›™æ“Šå‹•è©
- **åˆªé™¤å¡ç‰‡**: Delete éµæˆ–åˆªé™¤æŒ‰éˆ•
- **è¤‡è£½å¡ç‰‡**: Ctrl+D æˆ–è¤‡è£½æŒ‰éˆ•
- **é¸æ“‡å¡ç‰‡**: å–®æ“Šé¸ä¸­ï¼Œé¡¯ç¤ºå±¬æ€§
- **æ‰¹é‡æ“ä½œ**: å¤šé¸æ”¯æ´ï¼ˆè¨ˆåŠƒåŠŸèƒ½ï¼‰

#### å±¬æ€§ç·¨è¼¯
- **å‹•æ…‹è¡¨å–®**: æ ¹æ“šå‹•è©å®šç¾©ç”Ÿæˆåƒæ•¸è¡¨å–®
- **é¡å‹é©—è­‰**: å³æ™‚é©—è­‰åƒæ•¸é¡å‹
- **å¿…å¡«æª¢æŸ¥**: æ¨™ç¤ºå¿…å¡«åƒæ•¸
- **è‡ªå‹•æç¤º**: åƒæ•¸å€¼å»ºè­°å’Œè‡ªå‹•å®Œæˆ

#### YAML ç·¨è¼¯
- **CodeMirror æ•´åˆ**: èªæ³•é«˜äº®ã€è‡ªå‹•ç¸®æ’
- **é›™å‘åŒæ­¥**: YAML èˆ‡è¦–è¦ºåŒ–å³æ™‚åŒæ­¥
- **éŒ¯èª¤æç¤º**: YAML èªæ³•éŒ¯èª¤å³æ™‚é¡¯ç¤º
- **æ ¼å¼åŒ–**: è‡ªå‹•æ ¼å¼åŒ– YAML å…§å®¹

### 6. è³‡æ–™ç®¡ç†

#### è®Šæ•¸ç®¡ç† (Variables)
```javascript
variables = {
    "user_id": 123,
    "status": "active",
    "items": ["item1", "item2"],
    "config": { "timeout": 30 }
}
```
- **CRUD æ“ä½œ**: æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤è®Šæ•¸
- **é¡å‹æ”¯æ´**: stringã€numberã€booleanã€arrayã€object
- **é©—è­‰è¦å‰‡**: è®Šæ•¸åç¨±æ ¼å¼é©—è­‰
- **ä½¿ç”¨è¿½è¹¤**: é¡¯ç¤ºè®Šæ•¸ä½¿ç”¨ä½ç½®

#### é è¼‰è³‡æ–™ (Preload)
```javascript
preload = {
    "users": {
        query: {
            type: "database",
            target: "users",
            select: ["id", "name", "role"],
            where: "status = 'active'"
        }
    }
}
```
- **è³‡æ–™ä¾†æº**: databaseã€apiã€fileã€constant
- **æŸ¥è©¢å»ºæ§‹å™¨**: è¦–è¦ºåŒ–æŸ¥è©¢é…ç½®
- **å¿«å–è¨­å®š**: è³‡æ–™å¿«å–ç­–ç•¥
- **é‡æ–°æ•´ç†**: æ‰‹å‹•é‡æ–°è¼‰å…¥è³‡æ–™

#### æ¥­å‹™è¦å‰‡ (Rules)
```javascript
rules = {
    "max_retry": 3,
    "timeout": 300,
    "require_approval": true,
    "validation_pattern": "^[A-Z]{3}\\d{4}$"
}
```
- **è¦å‰‡é¡å‹**: validationã€constraintã€calculationã€condition
- **å•Ÿç”¨æ§åˆ¶**: è¦å‰‡å•Ÿç”¨/åœç”¨é–‹é—œ
- **å„ªå…ˆé †åº**: è¦å‰‡åŸ·è¡Œé †åºè¨­å®š
- **æè¿°èªªæ˜**: è¦å‰‡ç”¨é€”èªªæ˜æ–‡å­—

### 7. æª”æ¡ˆæ“ä½œ

#### è¼‰å…¥æµç¨‹
- **æµç¨‹åˆ—è¡¨**: å¾ `/tafl/flows` API ç²å–
- **è¼‰å…¥å°è©±æ¡†**: é¸æ“‡ä¸¦è¼‰å…¥ç¾æœ‰æµç¨‹
- **æ ¼å¼é©—è­‰**: è¼‰å…¥æ™‚é©—è­‰ TAFL æ ¼å¼
- **éŒ¯èª¤è™•ç†**: é¡¯ç¤ºè¼‰å…¥éŒ¯èª¤è©³æƒ…

#### å„²å­˜æµç¨‹
- **å„²å­˜å°è©±æ¡†**: è¼¸å…¥æµç¨‹ ID å’Œåç¨±
- **è¦†å¯«ç¢ºèª**: è¦†å¯«ç¾æœ‰æµç¨‹æ™‚ç¢ºèª
- **æ ¼å¼è½‰æ›**: è¦–è¦ºåŒ–è½‰æ›ç‚º YAML
- **æˆåŠŸé€šçŸ¥**: å„²å­˜æˆåŠŸæç¤º

#### åŒ¯å‡º/åŒ¯å…¥
- **åŒ¯å‡º YAML**: ä¸‹è¼‰ç‚º .yaml æª”æ¡ˆ
- **åŒ¯å…¥ YAML**: ä¸Šå‚³ä¸¦è¼‰å…¥ .yaml æª”æ¡ˆ
- **æ ¼å¼è½‰æ›**: æ”¯æ´èˆŠç‰ˆæ ¼å¼å‡ç´š

### 8. é©—è­‰åŠŸèƒ½

#### å³æ™‚é©—è­‰
- **åƒæ•¸é©—è­‰**: æª¢æŸ¥å¿…å¡«åƒæ•¸
- **é¡å‹æª¢æŸ¥**: é©—è­‰åƒæ•¸é¡å‹
- **å¼•ç”¨æª¢æŸ¥**: é©—è­‰è®Šæ•¸å¼•ç”¨
- **èªæ³•æª¢æŸ¥**: YAML èªæ³•é©—è­‰

#### æµç¨‹é©—è­‰
- **çµæ§‹é©—è­‰**: æª¢æŸ¥æµç¨‹çµæ§‹å®Œæ•´æ€§
- **é‚è¼¯é©—è­‰**: æª¢æŸ¥æ§åˆ¶æµç¨‹é‚è¼¯
- **ä¾è³´é©—è­‰**: æª¢æŸ¥è³‡æ–™ä¾è³´é—œä¿‚
- **åŸ·è¡Œè·¯å¾‘**: åˆ†æå¯èƒ½çš„åŸ·è¡Œè·¯å¾‘

### 9. åŸ·è¡ŒåŠŸèƒ½

#### æ¸¬è©¦åŸ·è¡Œ
- **ä¹¾è·‘æ¨¡å¼**: ä¸å¯¦éš›åŸ·è¡Œï¼Œåƒ…é©—è­‰
- **å–®æ­¥åŸ·è¡Œ**: é€æ­¥åŸ·è¡Œä¸¦é¡¯ç¤ºç‹€æ…‹
- **æ–·é»è¨­å®š**: åœ¨ç‰¹å®šå¡ç‰‡è¨­å®šæ–·é»
- **è®Šæ•¸ç›£çœ‹**: å³æ™‚é¡¯ç¤ºè®Šæ•¸å€¼

#### åŸ·è¡Œç›£æ§
- **é€²åº¦é¡¯ç¤º**: é¡¯ç¤ºåŸ·è¡Œé€²åº¦
- **æ—¥èªŒè¼¸å‡º**: å³æ™‚é¡¯ç¤ºåŸ·è¡Œæ—¥èªŒ
- **éŒ¯èª¤è¿½è¹¤**: é¡¯ç¤ºéŒ¯èª¤ä½ç½®å’Œè©³æƒ…
- **æ€§èƒ½åˆ†æ**: é¡¯ç¤ºå„æ­¥é©ŸåŸ·è¡Œæ™‚é–“

## ğŸ”Œ API æ•´åˆ

### å¾Œç«¯ API ç«¯é»
```python
# FastAPI è·¯ç”±å®šç¾©
GET    /tafl/verbs           # ç²å–å‹•è©å®šç¾©
GET    /tafl/flows           # ç²å–æµç¨‹åˆ—è¡¨
GET    /tafl/flows/{flow_id} # ç²å–ç‰¹å®šæµç¨‹
POST   /tafl/flows           # å‰µå»ºæ–°æµç¨‹
PUT    /tafl/flows/{flow_id} # æ›´æ–°æµç¨‹
DELETE /tafl/flows/{flow_id} # åˆªé™¤æµç¨‹
POST   /tafl/validate        # é©—è­‰æµç¨‹
POST   /tafl/execute         # åŸ·è¡Œæµç¨‹
POST   /tafl/convert-to-yaml # JSON è½‰ YAML
POST   /tafl/import-yaml     # YAML åŒ¯å…¥
```

### API å¯¦ä½œç‹€æ…‹ (2025-09-02 é©—è­‰)
| API ç«¯é» | å¯¦éš›åŠŸèƒ½ | å¯¦ä½œç‹€æ…‹ | å‚™è¨» |
|---------|---------|----------|------|
| `/tafl/verbs` | è¿”å›å‹•è©å®šç¾© | âœ… å®Œæ•´å¯¦ä½œ | 10å€‹æ ¸å¿ƒå‹•è© |
| `/tafl/flows` | åˆ—å‡ºæ‰€æœ‰æµç¨‹ | âœ… å®Œæ•´å¯¦ä½œ | å¾ `/app/config/tafl/flows/` è®€å– |
| `/tafl/flows/{id}` | ç²å–ç‰¹å®šæµç¨‹ | âœ… å®Œæ•´å¯¦ä½œ | æ”¯æ´ v1.1 æ ¼å¼ |
| `/tafl/flows` (POST) | ä¿å­˜æµç¨‹ | âœ… å®Œæ•´å¯¦ä½œ | è‡ªå‹•æ¸…ç† card IDs |
| `/tafl/flows/{id}` (DELETE) | åˆªé™¤æµç¨‹ | âœ… å®Œæ•´å¯¦ä½œ | åˆªé™¤ YAML æª”æ¡ˆ |
| `/tafl/validate` | é©—è­‰æµç¨‹ | âœ… å®Œæ•´å¯¦ä½œ | æ”¯æ´ v1.1 å…­æ®µå¼é©—è­‰ |
| `/tafl/execute` | åŸ·è¡Œæµç¨‹ | âš ï¸ æ¨¡æ“¬åŸ·è¡Œ | åƒ… dry runï¼Œæœªå¯¦éš›åŸ·è¡Œ |
| `/tafl/convert-to-yaml` | æ ¼å¼è½‰æ› | âœ… å®Œæ•´å¯¦ä½œ | JSON â†’ YAML |
| `/tafl/import-yaml` | æ ¼å¼åŒ¯å…¥ | âœ… å®Œæ•´å¯¦ä½œ | YAML â†’ JSON |

**é‡è¦èªªæ˜**ï¼š
- æµç¨‹å„²å­˜ä½ç½®ï¼š`/app/config/tafl/flows/` (å®¹å™¨å…§è·¯å¾‘)
- åŸ·è¡ŒåŠŸèƒ½ï¼šç›®å‰åƒ…æ¨¡æ“¬åŸ·è¡Œï¼Œå¯¦éš›åŸ·è¡Œéœ€æ•´åˆ TAFL_WCS æˆ–å…¶ä»–åŸ·è¡Œå¼•æ“
- ID æ¸…ç†ï¼š`clean_card_ids()` å‡½æ•¸æœƒè‡ªå‹•ç§»é™¤ç·¨è¼¯å™¨ç”Ÿæˆçš„æš«æ™‚ IDs

### è³‡æ–™æ ¼å¼
```typescript
// TypeScript ä»‹é¢å®šç¾©ï¼ˆåƒè€ƒç”¨ï¼‰
interface TAFLFlow {
    metadata: {
        id: string;
        name: string;
        version: string;
        description: string;
        created_at?: string;
        updated_at?: string;
    };
    settings?: {
        timeout: number;
        max_retries: number;
        retry_on_failure: boolean;
    };
    preload?: Record<string, PreloadConfig>;
    rules?: Record<string, any>;
    variables?: Record<string, any>;
    flow: FlowStep[];
}

interface FlowStep {
    id: string;
    [verb: string]: any;  // å‹•è©åƒæ•¸
    comment?: string;
    skip_if?: string;
    as?: string;  // TAFL v1.1.2: çµ±ä¸€ä½¿ç”¨ 'as' åƒæ•¸
}
```

## ğŸ’¾ è³‡æ–™å„²å­˜

### localStorage çµæ§‹ï¼ˆç¾è¡Œï¼‰
```javascript
// ç•¶å‰ä½¿ç”¨åŸç”Ÿ localStorage
localStorage.setItem('tafl_current_flow', JSON.stringify(flow));
localStorage.setItem('tafl_recent_flows', JSON.stringify(recentList));
localStorage.setItem('tafl_editor_preferences', JSON.stringify(prefs));
```

### miniStore æ•´åˆï¼ˆè¨ˆåŠƒï¼‰
```javascript
// è¨ˆåŠƒæ•´åˆ agvcui çš„ miniStore ç³»çµ±
import { createStore } from '../store/miniStore.js';

const taflStore = createStore('taflEditor', {
    currentFlow: null,
    recentFlows: [],
    preferences: {},
    isDirty: false
});
```

## ğŸ¨ UI/UX è¦æ ¼

### è¦–è¦ºè¨­è¨ˆ
- **ä¸»é¡Œ**: Bulma é è¨­ä¸»é¡Œ + è‡ªè¨‚æ“´å±•
- **é…è‰²æ–¹æ¡ˆ**: 
  - Flow: è—è‰² (is-info)
  - Control: é»ƒè‰² (is-warning)
  - Data: ç¶ è‰² (is-success)
  - Task: ä¸»è‰² (is-primary)
  - Error: ç´…è‰² (is-danger)
- **å­—é«”**: ç³»çµ±é è¨­å­—é«”
- **åœ–æ¨™**: Font Awesome 5 åœ–æ¨™é›†

### éŸ¿æ‡‰å¼è¨­è¨ˆ
- **æœ€å°å¯¬åº¦**: 1024pxï¼ˆä¸æ”¯æ´è¡Œå‹•è£ç½®ï¼‰
- **å»ºè­°è§£æåº¦**: 1920x1080
- **ç€è¦½å™¨æ”¯æ´**: Chromeã€Firefoxã€Edgeï¼ˆç¾ä»£ç€è¦½å™¨ï¼‰

### äº’å‹•è¨­è¨ˆ
- **æ‹–æ”¾å›é¥‹**: æ‹–å‹•æ™‚åŠé€æ˜é¡¯ç¤º
- **æ‡¸åœæ•ˆæœ**: é¡¯ç¤ºå·¥å…·æç¤º
- **é¸ä¸­ç‹€æ…‹**: è—è‰²é‚Šæ¡†é«˜äº®
- **éŒ¯èª¤ç‹€æ…‹**: ç´…è‰²é‚Šæ¡†å’Œåœ–æ¨™
- **è¼‰å…¥ç‹€æ…‹**: è¼‰å…¥å‹•ç•«å’Œé®ç½©

## ğŸ”„ æ¨¡çµ„åŒ–è¨ˆåŠƒ

### è¨ˆåŠƒæ¨¡çµ„çµæ§‹
```
tafl-editor/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ tafl-editor-core.js      # ä¸»æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ tafl-editor-state.js     # ç‹€æ…‹ç®¡ç†ï¼ˆminiStoreï¼‰
â”‚   â””â”€â”€ tafl-editor-config.js    # é…ç½®ç®¡ç†
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ tafl-editor-ui.js        # UI æ›´æ–°
â”‚   â”œâ”€â”€ tafl-editor-cards.js     # å¡ç‰‡æ¸²æŸ“
â”‚   â”œâ”€â”€ tafl-editor-panels.js    # é¢æ¿ç®¡ç†
â”‚   â””â”€â”€ tafl-editor-modals.js    # å°è©±æ¡†
â”œâ”€â”€ interactions/
â”‚   â”œâ”€â”€ tafl-editor-drag-drop.js # æ‹–æ”¾åŠŸèƒ½
â”‚   â”œâ”€â”€ tafl-editor-events.js    # äº‹ä»¶è™•ç†
â”‚   â””â”€â”€ tafl-editor-selection.js # é¸æ“‡ç®¡ç†
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ tafl-editor-flow.js      # æµç¨‹ç®¡ç†
â”‚   â”œâ”€â”€ tafl-editor-variables.js # è®Šæ•¸ç®¡ç†
â”‚   â”œâ”€â”€ tafl-editor-preload.js   # é è¼‰ç®¡ç†
â”‚   â””â”€â”€ tafl-editor-rules.js     # è¦å‰‡ç®¡ç†
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ tafl-editor-api.js       # API é€šè¨Š
â”‚   â””â”€â”€ tafl-editor-storage.js   # å„²å­˜ç®¡ç†
â””â”€â”€ utils/
    â”œâ”€â”€ tafl-editor-yaml.js      # YAML è™•ç†
    â”œâ”€â”€ tafl-editor-validation.js # é©—è­‰é‚è¼¯
    â””â”€â”€ tafl-editor-helpers.js   # è¼”åŠ©å‡½æ•¸
```

### æ¨¡çµ„åŒ–å„ªå‹¢
- **ç¨‹å¼ç¢¼çµ„ç¹”**: å¾ 2606 è¡Œå–®æª”æ¡ˆæ‹†åˆ†ç‚º 19 å€‹æ¨¡çµ„
- **ç¶­è­·æ€§**: æ¯å€‹æ¨¡çµ„å°ˆæ³¨å–®ä¸€è·è²¬
- **å¯æ¸¬è©¦æ€§**: æ¨¡çµ„åŒ–ä¾¿æ–¼å–®å…ƒæ¸¬è©¦
- **miniStore æ•´åˆ**: çµ±ä¸€ç‹€æ…‹ç®¡ç†å’Œè‡ªå‹•æŒä¹…åŒ–
- **ç¨‹å¼ç¢¼ç¸®æ¸›**: é€é miniStore æ¸›å°‘ç´„ 170 è¡Œç¨‹å¼ç¢¼

## ğŸ“Š æ•ˆèƒ½è¦æ ¼

### æ•ˆèƒ½ç›®æ¨™
- **è¼‰å…¥æ™‚é–“**: < 2 ç§’ï¼ˆåŒ…å«å‹•è©å®šç¾©è¼‰å…¥ï¼‰
- **æ‹–æ”¾éŸ¿æ‡‰**: < 50ms
- **æµç¨‹é©—è­‰**: < 500msï¼ˆ100 å€‹æ­¥é©Ÿï¼‰
- **YAML åŒæ­¥**: < 100ms
- **æœ€å¤§æµç¨‹**: æ”¯æ´ 500+ æ­¥é©Ÿ

### è¨˜æ†¶é«”ç®¡ç†
- **æœ€å¤§æµç¨‹å¤§å°**: 10MB
- **æ’¤éŠ·æ­·å²**: ä¿ç•™æœ€è¿‘ 50 å€‹æ“ä½œ
- **å¿«å–ç­–ç•¥**: LRU å¿«å–æœ€è¿‘ 10 å€‹æµç¨‹

## ğŸ› å·²çŸ¥å•é¡Œèˆ‡é™åˆ¶

### ç•¶å‰é™åˆ¶
1. **å–®é«”æ¶æ§‹**: 2606 è¡Œå–®ä¸€æª”æ¡ˆï¼Œç¶­è­·å›°é›£
2. **ç„¡æ’¤éŠ·åŠŸèƒ½**: å°šæœªå¯¦ä½œ Undo/Redo
3. **ç„¡æ‰¹é‡æ“ä½œ**: ä¸æ”¯æ´å¤šé¸å’Œæ‰¹é‡ç·¨è¼¯
4. **ç„¡æœå°‹åŠŸèƒ½**: å‹•è©åº«ç„¡æœå°‹åŠŸèƒ½
5. **ç„¡ç‰ˆæœ¬æ§åˆ¶**: æµç¨‹ç„¡ç‰ˆæœ¬æ­·å²è¨˜éŒ„

### å·²çŸ¥å•é¡Œ
1. **Preload/Rules é¡¯ç¤º**: è¼‰å…¥æµç¨‹æ™‚éœ€æ‰‹å‹•å‘¼å« refreshPreloadUI() å’Œ refreshRulesUI()
2. **æ‹–æ”¾é–ƒçˆ**: æŸäº›æƒ…æ³ä¸‹æ‹–æ”¾æœƒé€ æˆç•«é¢é–ƒçˆ
3. **è¨˜æ†¶é«”æ´©æ¼**: é•·æ™‚é–“ä½¿ç”¨å¯èƒ½æœ‰è¼•å¾®è¨˜æ†¶é«”æ´©æ¼

## ğŸ”® æœªä¾†ç™¼å±•

### çŸ­æœŸè¨ˆåŠƒï¼ˆ1-3 å€‹æœˆï¼‰
1. **æ¨¡çµ„åŒ–é‡æ§‹**: åŸ·è¡Œ 19 å€‹æ¨¡çµ„çš„æ‹†åˆ†è¨ˆåŠƒ
2. **miniStore æ•´åˆ**: ä½¿ç”¨ agvcui çš„ miniStore ç³»çµ±
3. **æ’¤éŠ·/é‡åš**: å¯¦ä½œ Undo/Redo åŠŸèƒ½
4. **æœå°‹åŠŸèƒ½**: æ–°å¢å‹•è©æœå°‹å’Œæµç¨‹å…§æœå°‹

### ä¸­æœŸè¨ˆåŠƒï¼ˆ3-6 å€‹æœˆï¼‰
1. **å”ä½œåŠŸèƒ½**: å¤šäººåŒæ™‚ç·¨è¼¯æ”¯æ´
2. **ç‰ˆæœ¬æ§åˆ¶**: æµç¨‹ç‰ˆæœ¬æ­·å²å’Œæ¯”è¼ƒ
3. **æ¨¡æ¿ç³»çµ±**: é è¨­æµç¨‹æ¨¡æ¿åº«
4. **é™¤éŒ¯å·¥å…·**: å¢å¼·çš„é™¤éŒ¯å’Œåˆ†æåŠŸèƒ½

### é•·æœŸé¡˜æ™¯ï¼ˆ6+ å€‹æœˆï¼‰
1. **AI è¼”åŠ©**: AI å»ºè­°å’Œè‡ªå‹•å®Œæˆ
2. **è¦–è¦ºåŒ–å¢å¼·**: æ›´è±å¯Œçš„è¦–è¦ºåŒ–æ•ˆæœ
3. **å¤–æ›ç³»çµ±**: æ”¯æ´è‡ªè¨‚å‹•è©å’Œæ“´å±•
4. **è¡Œå‹•æ”¯æ´**: éŸ¿æ‡‰å¼è¨­è¨ˆæ”¯æ´å¹³æ¿

## ğŸ“š ç›¸é—œæ–‡ä»¶

### é–‹ç™¼æ–‡ä»¶
- **TAFL èªè¨€è¦æ ¼**: docs-ai/knowledge/system/tafl/tafl-language-specification.md
- **TAFL Editor è¦æ ¼**: æœ¬æ–‡ä»¶
- **miniStore æ•´åˆ**: è¨ˆåŠƒä¸­ï¼ˆå¾…å¯¦ä½œå¾Œè£œå……æ–‡ä»¶ï¼‰

### å¯¦ä½œä½ç½®
- **ä¸»ç¨‹å¼**: `/home/ct/RosAGV/app/web_api_ws/src/agvcui/agvcui/static/js/tafl-editor.js`
- **æ¨£å¼è¡¨**: `/home/ct/RosAGV/app/web_api_ws/src/agvcui/agvcui/static/css/tafl-editor.css`
- **å¾Œç«¯ API**: `/home/ct/RosAGV/app/web_api_ws/src/agvcui/agvcui/routers/tafl.py`

### æ¸¬è©¦æª”æ¡ˆ
- **æ•´åˆæ¸¬è©¦**: `/home/ct/RosAGV/agents/test_tafl_editor_*.py`
- **UI æ¸¬è©¦**: `/home/ct/RosAGV/agents/test_tafl_editor_*.html`

## ğŸ”„ ç‰ˆæœ¬æ­·å²

### v3.0 (2025-09 é–‹ç™¼ä¸­)
- å®Œæ•´é‡å¯«ï¼Œå°ˆæ¥­æ‹–æ”¾é«”é©—
- æ”¯æ´ TAFL v1.1 å…­æ®µå¼çµæ§‹
- æ–°å¢ Preloadã€Rulesã€Settings æ”¯æ´
- æ”¹é€²è¦–è¦ºåŒ–å’Œä½¿ç”¨è€…é«”é©—
- miniStore æ•´åˆï¼ˆè¨ˆåŠƒä¸­ï¼‰

### v2.0 (2025-08)
- æ”¯æ´å·¢ç‹€çµæ§‹
- æ–°å¢ YAML ç·¨è¼¯å™¨
- æ”¹é€²æ‹–æ”¾åŠŸèƒ½

### v1.0 (2025-07)
- åˆå§‹ç‰ˆæœ¬
- åŸºæœ¬æ‹–æ”¾åŠŸèƒ½
- ç°¡å–®æµç¨‹ç·¨è¼¯

---

**æ–‡ä»¶ç¶­è­·èªªæ˜**: 
- æœ¬è¦æ ¼æ›¸æ‡‰èˆ‡å¯¦éš›å¯¦ä½œåŒæ­¥æ›´æ–°
- ä»»ä½•åŠŸèƒ½è®Šæ›´éƒ½æ‡‰æ›´æ–°å°æ‡‰ç« ç¯€
- æ¨¡çµ„åŒ–å¯¦ä½œæ™‚éœ€åƒè€ƒæœ¬è¦æ ¼æ›¸ç¢ºèªåŠŸèƒ½å®Œæ•´æ€§