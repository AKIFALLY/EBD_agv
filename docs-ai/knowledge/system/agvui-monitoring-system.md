# AGVUI ç›£æ§ç³»çµ±æ¶æ§‹èˆ‡å¯¦ä½œ

## ğŸ¯ é©ç”¨å ´æ™¯
- ç†è§£ AGV UI (AGVUI) ç›£æ§ç³»çµ±çš„æ¶æ§‹å’ŒåŠŸèƒ½
- é–‹ç™¼å’Œéƒ¨ç½² AGV è»Šè¼‰ç›£æ§ç•Œé¢
- æ¸¬è©¦å’Œè¨ºæ–· AGV ç‹€æ…‹é¡¯ç¤ºå•é¡Œ

## ğŸ“‹ ç³»çµ±æ¦‚è¿°

### AGVUI å®šä½
**AGV User Interface (AGVUI)** æ˜¯ RosAGV ç³»çµ±çš„è»Šè¼‰ç›£æ§ç•Œé¢ï¼Œé‹è¡Œåœ¨ port 8003ï¼Œç‚º AGV è¨­å‚™æä¾›ç°¡åŒ–çš„ Web ç•Œé¢ï¼Œç”¨æ–¼é¡¯ç¤º AGV ç‹€æ…‹ã€ä»»å‹™è³‡è¨Šå’ŒåŸºæœ¬æ§åˆ¶åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **è¼•é‡ç´šè¨­è¨ˆ**: å°ˆç‚ºè»Šè¼‰è¨­å‚™è³‡æºé™åˆ¶ç’°å¢ƒè¨­è¨ˆ
- **è‡ªé©æ‡‰æ¨¡å¼**: è‡ªå‹•è­˜åˆ¥å–®æ©Ÿéƒ¨ç½²æˆ–å¤šæ©Ÿæ¸¬è©¦ç’°å¢ƒ
- **å³æ™‚æ›´æ–°**: é€é Socket.IO æä¾›å³æ™‚ç‹€æ…‹æ›´æ–°
- **æª”æ¡ˆç›£æ§**: å®šæ™‚è®€å–ç‹€æ…‹æª”æ¡ˆä¸¦å»£æ’­æ›´æ–°

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æŠ€è¡“æ£§
- **å¾Œç«¯**: FastAPI + Socket.IO + ROS 2
- **å‰ç«¯**: åŸç”Ÿ JavaScript + Bulma CSS + miniStore
- **é€šè¨Š**: WebSocket (Socket.IO) + æª”æ¡ˆç³»çµ±ç›£æ§
- **éƒ¨ç½²**: Docker å®¹å™¨å…§é‹è¡Œï¼Œport 8003

### æ ¸å¿ƒæ¨¡çµ„
```
agvui/
â”œâ”€â”€ agv_ui_server.py      # ä¸»ä¼ºæœå™¨ (FastAPI + Socket.IO)
â”œâ”€â”€ agv_ui_socket.py      # Socket.IO äº‹ä»¶è™•ç†
â”œâ”€â”€ agv_ui_ros.py         # ROS 2 ç¯€é»æ•´åˆ
â”œâ”€â”€ static/               # å‰ç«¯éœæ…‹è³‡æº
â”‚   â”œâ”€â”€ js/              # JavaScript é‚è¼¯
â”‚   â””â”€â”€ css/             # æ¨£å¼æª”æ¡ˆ
â””â”€â”€ templates/           # HTML æ¨¡æ¿
    â”œâ”€â”€ agv.html        # ä¸»ç›£æ§é é¢
    â””â”€â”€ test.html       # æ¸¬è©¦é¸æ“‡é é¢
```

## ğŸ”§ ç‹€æ…‹æª”æ¡ˆè¼‰å…¥æ©Ÿåˆ¶

### é›™æ¨¡å¼è‡ªé©æ‡‰
AGVUI æœƒæ ¹æ“šç’°å¢ƒè‡ªå‹•æ±ºå®šè¼‰å…¥æ¨¡å¼ï¼š

#### 1. å¤šæ©Ÿæ¨¡å¼ï¼ˆæ¸¬è©¦/æ¨¡æ“¬ç’°å¢ƒï¼‰
- **æª”æ¡ˆæ ¼å¼**: `/tmp/agv_status_<agv_id>.json`
- **AGV åˆ—è¡¨**: loader01, loader02, cargo01, cargo02, unloader01, unloader02
- **ç”¨é€”**: æ¸¬è©¦ç’°å¢ƒæˆ–ä¸­å¤®ç›£æ§ç³»çµ±
- **ç‰¹é»**: åŒæ™‚ç›£æ§å¤šå° AGV ç‹€æ…‹

#### 2. å–®æ©Ÿæ¨¡å¼ï¼ˆå¯¦éš› AGV éƒ¨ç½²ï¼‰
- **æª”æ¡ˆæ ¼å¼**: `/tmp/agv_status.json`
- **ç”¨é€”**: å¯¦éš› AGV è»Šè¼‰éƒ¨ç½²
- **ç‰¹é»**: åªç›£æ§æœ¬æ©Ÿ AGV ç‹€æ…‹

### èº«ä»½è­˜åˆ¥æ©Ÿåˆ¶
```python
# è¼‰å…¥é †åº
1. è®€å– /app/.device_identity ç¢ºèªå®¹å™¨é¡å‹
2. å¦‚æœæ˜¯ AGV å®¹å™¨ï¼Œè®€å– /app/.agv_identity
3. å‚™ç”¨ï¼šå¾ç’°å¢ƒè®Šæ•¸ AGV_ID è®€å–
4. ç„¡æ³•è­˜åˆ¥æ™‚é¡¯ç¤ºæ‰€æœ‰ AGV ç‹€æ…‹
```

## ğŸš€ æ¸¬è©¦å·¥å…·

### æ¨¡æ“¬è³‡æ–™ç”¢ç”Ÿè…³æœ¬
**ä½ç½®**: `/home/ct/EBD_agv/scripts/test-agvui-multi.sh`

**åŠŸèƒ½**:
- ç”Ÿæˆ 6 å° AGV çš„æ¸¬è©¦ç‹€æ…‹æª”æ¡ˆ
- åŒ…å« 330+ å€‹ç‹€æ…‹å±¬æ€§
- è‡ªå‹•è¤‡è£½åˆ° Docker å®¹å™¨å…§
- æ”¯æ´éš¨æ©Ÿæ•¸æ“šç”Ÿæˆ

**ä½¿ç”¨æ–¹å¼**:
```bash
# ç”Ÿæˆæ¸¬è©¦è³‡æ–™
bash /home/ct/EBD_agv/scripts/test-agvui-multi.sh

# è¨ªå•æ¸¬è©¦é é¢
http://localhost:8003/test       # é¸æ“‡è¦ç›£æ§çš„ AGV
http://localhost:8003/?agv_id=loader01  # ç›´æ¥ç›£æ§ç‰¹å®š AGV
```

### å–®æ©Ÿæ¸¬è©¦è…³æœ¬
**ä½ç½®**: `/home/ct/EBD_agv/scripts/test-agvui.sh`
- ç”Ÿæˆå–®ä¸€ AGV ç‹€æ…‹æª”æ¡ˆ
- é©ç”¨æ–¼å–®æ©Ÿéƒ¨ç½²æ¸¬è©¦

## ğŸ“Š ç‹€æ…‹è³‡æ–™çµæ§‹

### æ ¸å¿ƒç‹€æ…‹å±¬æ€§
```json
{
  "AGV_ID": "loader01",
  "MAGIC": 13243,
  "timestamp": "2025-08-15T17:28:00+08:00",
  "namespace": "loader01",
  "AGV_Auto": 1,
  "AGV_Manual": 0,
  "AGV_MOVING": 0,
  "AGV_SLAM_X": 3456,
  "AGV_SLAM_Y": 2890,
  "AGV_SLAM_ANGLE": 45.6,
  "POWER": 85,
  "AGV_SPEED": 120.5,
  // ... 330+ å±¬æ€§
}
```

### ç‹€æ…‹åˆ†é¡
- **åŸºæœ¬ç‹€æ…‹**: AGV_ID, æ¨¡å¼, ç§»å‹•ç‹€æ…‹
- **ä½ç½®è³‡è¨Š**: SLAM åº§æ¨™, PGV åº§æ¨™, è§’åº¦
- **ç³»çµ±ç‹€æ…‹**: é›»é‡, é€Ÿåº¦, ç›®æ¨™é»
- **I/O ç‹€æ…‹**: Input_1-100, Output_1-100
- **è­¦å ±ç‹€æ…‹**: Alarm_1-50
- **PLC è¨˜æ†¶é«”**: PLC_D1-80

## ğŸ” é–‹ç™¼èˆ‡éƒ¨ç½²

### å•Ÿå‹•æœå‹™
```bash
# åœ¨ AGVC å®¹å™¨å…§
cd ~/EBD_agv
docker compose -f docker-compose.agvc.yml exec agvc_server bash
source /app/setup.bash && agvc_source

# å•Ÿå‹• AGVUI
python3 -m agvui.agv_ui_server

# æˆ–ä½¿ç”¨ ROS 2
ros2 run agvui agv_ui_server
```

### API ç«¯é»
- `GET /` - ä¸»ç›£æ§é é¢
- `GET /test` - æ¸¬è©¦é¸æ“‡é é¢
- `GET /api/identity` - å–å¾—æœ¬æ©Ÿ AGV èº«ä»½

### Socket.IO äº‹ä»¶
- `agv_status_update` - AGV ç‹€æ…‹æ›´æ–°äº‹ä»¶
- `connect` - å®¢æˆ¶ç«¯é€£æ¥äº‹ä»¶
- `disconnect` - å®¢æˆ¶ç«¯æ–·é–‹äº‹ä»¶

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### ç„¡ç‹€æ…‹æ›´æ–°
1. æª¢æŸ¥ç‹€æ…‹æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼š
```bash
docker compose -f docker-compose.agvc.yml exec agvc_server ls -la /tmp/agv_status*.json
```

2. åŸ·è¡Œæ¸¬è©¦è…³æœ¬ç”Ÿæˆè³‡æ–™ï¼š
```bash
bash /home/ct/EBD_agv/scripts/test-agvui-multi.sh
```

#### æœå‹™ç„¡æ³•å•Ÿå‹•
1. æª¢æŸ¥ç«¯å£ä½”ç”¨ï¼š
```bash
netstat -tulpn | grep :8003
```

2. æª¢æŸ¥ç’°å¢ƒè¼‰å…¥ï¼š
```bash
source /app/setup.bash && agvc_source
```

## ğŸ’¡ æœ€ä½³å¯¦è¸

### éƒ¨ç½²å»ºè­°
1. **è»Šè¼‰éƒ¨ç½²**: ä½¿ç”¨å–®æ©Ÿæ¨¡å¼ï¼Œåªè®€å– `/tmp/agv_status.json`
2. **æ¸¬è©¦ç’°å¢ƒ**: ä½¿ç”¨å¤šæ©Ÿæ¨¡å¼ï¼Œæ”¯æ´å¤š AGV ç›£æ§
3. **è³‡æºå„ªåŒ–**: å£“ç¸®å‰ç«¯è³‡æºï¼Œå¯¦æ–½ç€è¦½å™¨å¿«å–

### é–‹ç™¼å»ºè­°
1. **ç‹€æ…‹æª”æ¡ˆ**: ç¢ºä¿ JSON æ ¼å¼æ­£ç¢ºï¼ŒåŒ…å«å¿…è¦æ¬„ä½
2. **æ›´æ–°é »ç‡**: æ¯ç§’è®€å–ä¸€æ¬¡ç‹€æ…‹æª”æ¡ˆ
3. **éŒ¯èª¤è™•ç†**: è™•ç† JSON è§£æéŒ¯èª¤å’Œæª”æ¡ˆä¸å­˜åœ¨æƒ…æ³

## ğŸ”— äº¤å‰å¼•ç”¨
- AGVC å·¥ä½œç©ºé–“: docs-ai/context/workspaces/agvc-workspaces.md
- Web API ç³»çµ±: `app/web_api_ws/CLAUDE.md`
- Docker é–‹ç™¼: docs-ai/operations/development/docker-development.md
- ç³»çµ±è¨ºæ–·: docs-ai/operations/guides/system-diagnostics.md