# Flow 4: loader_put_soaker.yaml

## ğŸ¯ æ¥­å‹™ç›®çš„
å°‡ Loader AGV è»Šä¸Šçš„è¼‰å…·æ”¾å…¥æ³¡è—¥æ©Ÿï¼Œé€²è¡Œè—¥æ°´æµ¸æ³¡è™•ç†ï¼ˆç‰¹æ®Šè¨­å‚™ï¼š1æ ¼è™•ç†ï¼‰

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

| é …ç›® | å€¼ |
|------|-----|
| æ–‡ä»¶å | `loader_put_soaker.yaml` |
| Flow ID | `loader_put_soaker` |
| å„ªå…ˆç´š | 44 |
| åŸ·è¡Œé–“éš” | 12 ç§’ |
| Work ID | **2040102, 2040202, 2040302, 2040402, 2040502, 2040602**ï¼ˆ6å€‹ï¼‰|

## ğŸ­ æ¥­å‹™å ´æ™¯

### å‰ç½®æ¢ä»¶
1. Loader AGV å·²å¾æ¸…æ´—æ©Ÿæˆ–å…¶ä»–è¨­å‚™å–å‡ºè¼‰å…·
2. AGV è»Šä¸Šæœ‰è¼‰å…·ï¼ˆ**status_id=401 æ³¡è—¥ä¸­ç‹€æ…‹**ï¼‰éœ€è¦æ”¾å…¥æ³¡è—¥æ©Ÿ
3. **æ³¡è—¥æ©Ÿï¼ˆ6å° A-Fï¼‰æœ‰ç©ºä½**
4. **Presence æ„Ÿæ¸¬å™¨ç¢ºèªæ³¡è—¥æ©Ÿç‚ºç©ºï¼ˆç¡¬é«”é©—è­‰ï¼‰**

### è§¸ç™¼æ¢ä»¶
- Loader AGV Port 1ã€3 æœ‰è¼‰å…·ï¼ˆ**è‡³å°‘1å€‹è¼‰å…·ï¼Œstatus_id=401**ï¼‰
- **æ³¡è—¥æ©Ÿï¼ˆä»»ä¸€å° A-Fï¼‰æœ‰ç©ºä½**ï¼ˆè»Ÿé«” status="empty"ï¼‰
- **Presence æ„Ÿæ¸¬å™¨ç¢ºèªç„¡è¼‰å…·åœ¨å¸­**ï¼ˆç¡¬é«” value="0"ï¼Œé›™é‡é©—è­‰ï¼‰
- æ²’æœ‰é‡è¤‡çš„æœªå®Œæˆä»»å‹™

### åŸ·è¡Œçµæœ
- å‰µå»º Loader AGV æ”¾æ–™ä»»å‹™
- ä»»å‹™é€²å…¥å¾…åˆ†æ´¾éšŠåˆ—ï¼ˆstatus_id = 1 PENDINGï¼‰
- è¼‰å…·æ”¾å…¥æ³¡è—¥æ©Ÿé€²è¡Œè—¥æ°´æµ¸æ³¡

## ğŸ”§ æŠ€è¡“è¦æ ¼

### æ³¡è—¥æ©Ÿé…ç½®ï¼ˆç‰¹æ®Šè¨­å‚™ï¼š1 station = 1 portï¼‰

**ç‰©ç†çµæ§‹**ï¼š
- Equipment 204ï¼ˆæ³¡è—¥æ©Ÿ SOAKERï¼‰
- 6å€‹ Portï¼ˆPort 1-6ï¼Œå°æ‡‰æ³¡è—¥æ©Ÿ A-Fï¼‰
- **6å€‹ç¨ç«‹ Station**ï¼ˆ**Station 01-06**ï¼‰

**Station-Port æ˜ å°„**ï¼ˆ**ç‰¹æ®Šè¨­å‚™**ï¼‰ï¼š
- **Station 01**: Port 1ï¼ˆ**1æ ¼è™•ç†**ï¼Œæ³¡è—¥æ©Ÿ Aï¼‰
- **Station 02**: Port 2ï¼ˆ**1æ ¼è™•ç†**ï¼Œæ³¡è—¥æ©Ÿ Bï¼‰
- **Station 03**: Port 3ï¼ˆ**1æ ¼è™•ç†**ï¼Œæ³¡è—¥æ©Ÿ Cï¼‰
- **Station 04**: Port 4ï¼ˆ**1æ ¼è™•ç†**ï¼Œæ³¡è—¥æ©Ÿ Dï¼‰
- **Station 05**: Port 5ï¼ˆ**1æ ¼è™•ç†**ï¼Œæ³¡è—¥æ©Ÿ Eï¼‰
- **Station 06**: Port 6ï¼ˆ**1æ ¼è™•ç†**ï¼Œæ³¡è—¥æ©Ÿ Fï¼‰

**Work ID å°æ‡‰**ï¼ˆ6å€‹ PUT Work IDsï¼‰ï¼š
- `2040102`: Station 01 æ”¾æ³¡è—¥æ©Ÿ Aï¼ˆPort 1ï¼Œ**1æ ¼**ï¼‰
- `2040202`: Station 02 æ”¾æ³¡è—¥æ©Ÿ Bï¼ˆPort 2ï¼Œ**1æ ¼**ï¼‰
- `2040302`: Station 03 æ”¾æ³¡è—¥æ©Ÿ Cï¼ˆPort 3ï¼Œ**1æ ¼**ï¼‰
- `2040402`: Station 04 æ”¾æ³¡è—¥æ©Ÿ Dï¼ˆPort 4ï¼Œ**1æ ¼**ï¼‰
- `2040502`: Station 05 æ”¾æ³¡è—¥æ©Ÿ Eï¼ˆPort 5ï¼Œ**1æ ¼**ï¼‰
- `2040602`: Station 06 æ”¾æ³¡è—¥æ©Ÿ Fï¼ˆPort 6ï¼Œ**1æ ¼**ï¼‰

**é—œéµç‰¹é»**ï¼š
- âœ… **6å€‹ç¨ç«‹ Work ID**ï¼ˆæ³¡è—¥æ©Ÿ A-Fï¼‰
- âœ… **ç‰¹æ®Šè¨­å‚™é…ç½®**ï¼ˆ1 station = 1 portï¼‰
- âœ… **1æ ¼è™•ç†**ï¼ˆèˆ‡æ¨™æº–è¨­å‚™2æ ¼ä¸åŒï¼‰
- âœ… **ç¨ç«‹ Station**ï¼ˆæ¯å€‹æ³¡è—¥æ©Ÿç¨ç«‹æ“ä½œï¼‰

### æ‰¹é‡è™•ç†é‚è¼¯

**ç‰¹æ®Š1æ ¼è™•ç†**ï¼ˆ**æ‰€æœ‰ Station 01-06**ï¼‰ï¼š
- **æ¯å€‹ Station åŒ…å«1æ ¼**ï¼ˆç‰¹æ®Šè¨­å‚™ï¼‰
- **ä¸€æ¬¡æ”¾æ–™æ“ä½œæ”¾å…¥1æ ¼**ï¼ˆ1æ ¼è™•ç†ï¼‰
- **éœ€è¦æª¢æŸ¥ AGV è‡³å°‘æœ‰1å€‹è¼‰å…·**ï¼ˆstatus_id=401 æ³¡è—¥ä¸­ï¼‰
- **éœ€è¦æª¢æŸ¥æ³¡è—¥æ©Ÿè‡³å°‘æœ‰1æ ¼ç©ºä½**ï¼ˆä»»ä¸€å° A-Fï¼‰
- **é›™é‡é©—è­‰æ©Ÿåˆ¶**ï¼š
  - è»Ÿé«”ç‹€æ…‹ï¼šeqp_ports.status = "empty"
  - ç¡¬é«”æ„Ÿæ¸¬å™¨ï¼šPresence signal value = "0"ï¼ˆç„¡è¼‰å…·åœ¨å¸­ï¼‰
- **ä¸æ”¯æŒæ‰¹é‡è™•ç†**ï¼ˆæ¯æ¬¡è™•ç†1æ ¼ï¼‰

## ğŸ“ TAFL Flow è¨­è¨ˆ

### Metadata
```yaml
metadata:
  id: "loader_put_soaker"
  name: "Loader AGV æ”¾æ–™åˆ°æ³¡è—¥æ©Ÿ"
  enabled: true
  version: "1.0.0"
  description: "æª¢æŸ¥ Loader AGV è»Šä¸Šè¼‰å…·å’Œæ³¡è—¥æ©Ÿç©ºä½ï¼Œå‰µå»ºæ”¾æ–™ä»»å‹™ï¼ˆç‰¹æ®Šè¨­å‚™ï¼š1æ ¼è™•ç†ï¼‰"
  author: "TAFL System"
  created_at: "2025-10-16"
  tags: ["loader", "soaker", "put", "automation", "special-equipment"]
```

### Variables
```yaml
variables:
  priority: 44
  model: "LOADER"
  soaker_equipment_id: 204        # æ³¡è—¥æ©Ÿ Equipment ID
  # 6å€‹ Station é…ç½®ï¼ˆç‰¹æ®Šè¨­å‚™ï¼Œå…¨éƒ¨1æ ¼è™•ç†ï¼‰
  stations:
    - station: 1                  # Station 01 (æ³¡è—¥æ©Ÿ A)
      work_id: 2040102
      port: 1
      batch_size: 1               # ç‰¹æ®Šè¨­å‚™ï¼š1æ ¼
      name: "æ³¡è—¥æ©ŸA"
    - station: 2                  # Station 02 (æ³¡è—¥æ©Ÿ B)
      work_id: 2040202
      port: 2
      batch_size: 1
      name: "æ³¡è—¥æ©ŸB"
    - station: 3                  # Station 03 (æ³¡è—¥æ©Ÿ C)
      work_id: 2040302
      port: 3
      batch_size: 1
      name: "æ³¡è—¥æ©ŸC"
    - station: 4                  # Station 04 (æ³¡è—¥æ©Ÿ D)
      work_id: 2040402
      port: 4
      batch_size: 1
      name: "æ³¡è—¥æ©ŸD"
    - station: 5                  # Station 05 (æ³¡è—¥æ©Ÿ E)
      work_id: 2040502
      port: 5
      batch_size: 1
      name: "æ³¡è—¥æ©ŸE"
    - station: 6                  # Station 06 (æ³¡è—¥æ©Ÿ F)
      work_id: 2040602
      port: 6
      batch_size: 1
      name: "æ³¡è—¥æ©ŸF"
```

## ğŸ”„ æµç¨‹é‚è¼¯

### ä¸»è¦æ­¥é©Ÿ

1. æŸ¥è©¢æ‰€æœ‰å•Ÿç”¨çš„æˆ¿é–“ï¼ˆèª¿è©¦é€šçŸ¥ï¼‰
2. éæ­·æ¯å€‹æˆ¿é–“ï¼ˆèª¿è©¦é€šçŸ¥é€²å…¥æˆ¿é–“ï¼‰
3. æŸ¥è©¢ Loader AGVï¼ˆmodel="Loader", enable=1ï¼‰
4. æŸ¥è©¢ AGV Port 1ã€3 è¼‰å…·ï¼ˆâ‰¥ 1å€‹ï¼Œ**status_id=401 æ³¡è—¥ä¸­**ï¼‰
5. **éæ­·6å€‹ Station**ï¼ˆæ³¡è—¥æ©Ÿ A-Fï¼‰
6. æŸ¥è©¢æ¯å€‹æ³¡è—¥æ©Ÿç©ºä½ï¼ˆ1æ ¼ï¼Œè»Ÿé«” status="empty"ï¼‰
7. **é›™é‡é©—è­‰**ï¼šæª¢æŸ¥ Presence æ„Ÿæ¸¬å™¨ï¼ˆç¡¬é«” value="0" ç„¡è¼‰å…·åœ¨å¸­ï¼‰
8. æª¢æŸ¥é‡è¤‡ä»»å‹™ï¼ˆwork_id, room_id, status_id_in=[0,1,2,3]ï¼‰
9. å‰µå»ºæ”¾æ–™ä»»å‹™ï¼ˆå‹•æ…‹é¸æ“‡ç©ºé–’çš„æ³¡è—¥æ©Ÿï¼Œ**å« presence_verified=true**ï¼‰

**é—œéµæŸ¥è©¢**ï¼š
```yaml
# éæ­·6å€‹ Station
- for:
    in: "${stations}"
    as: station
    do:
      # æŸ¥è©¢è©² Station çš„ç©ºä½
      - query:
          target: equipment_ports
          where:
            equipment_id: "${soaker_equipment_id}"  # 204
            port: "${station.port}"                 # 1-6
            status: "empty"
          as: empty_port

      # å¦‚æœæ­¤ Station æœ‰ç©ºä½ï¼Œå‰µå»ºä»»å‹™
      - if:
          condition: "${empty_port != null} && ${has_carriers} && ${no_existing_task}"
          then:
            - create:
                target: task
                with:
                  work_id: "${station.work_id}"
                  # ... å…¶ä»–åƒæ•¸
```

## âš ï¸ æ³¨æ„äº‹é …

### ç‰¹æ®Šè¨­å‚™è¨­è¨ˆé‡é»
- **ç·¨ç¢¼è¦å‰‡**: work_id ä½¿ç”¨ Station ç·¨è™Ÿï¼ˆ**01-06**ï¼‰ï¼Œå°æ‡‰ Port 1-6
- **ç‰¹æ®Šè¨­å‚™æ˜ å°„**: **1 station = 1 port**ï¼ˆèˆ‡æ¨™æº–è¨­å‚™2 portsä¸åŒï¼‰
- **ç¨ç«‹æ“ä½œ**: æ¯å€‹æ³¡è—¥æ©Ÿç¨ç«‹æ“ä½œï¼Œä¸æ‰¹é‡è™•ç†

### æ‰¹é‡è™•ç†é‚è¼¯
- **å›ºå®š1æ ¼è™•ç†**: AGV éœ€ â‰¥ 1å€‹è¼‰å…·ï¼ˆstatus_id=401ï¼‰ï¼Œæ³¡è—¥æ©Ÿéœ€ â‰¥ 1æ ¼ç©ºä½
- **ä¸æ”¯æŒæ‰¹é‡è™•ç†**ï¼ˆæ¯æ¬¡è™•ç†1æ ¼ï¼‰
- **éˆæ´»åˆ†é…**: å‹•æ…‹é¸æ“‡ç©ºé–’çš„æ³¡è—¥æ©Ÿï¼ˆA-Fï¼‰

### å¤šæ¬¡æµ¸æ³¡è™•ç†
- **è£½ç¨‹1**: æ³¡è—¥1æ¬¡ï¼ˆPUT_SOAKER â†’ TAKE_SOAKER â†’ PUT_PRE_DRYERï¼‰
- **è£½ç¨‹2**: æ³¡è—¥2æ¬¡ï¼ˆPUT_SOAKER â†’ TAKE_SOAKER â†’ **PUT_SOAKER â†’ TAKE_SOAKER** â†’ PUT_PRE_DRYERï¼‰
- **éˆæ´»åˆ¶ç¨‹**: æ”¯æ´å¤šæ¬¡æµ¸æ³¡ï¼Œæ ¹æ“šè£½ç¨‹éœ€æ±‚å‹•æ…‹åˆ†é…

### ç‹€æ…‹ç¢¼æ˜ å°„
- å‰ç½®æ¢ä»¶ï¼šè¼‰å…· status_id = 401ï¼ˆ**æ³¡è—¥ä¸­**ï¼Œç­‰å¾…æ”¾å…¥æ³¡è—¥æ©Ÿï¼‰
- æ”¾å…¥æ³¡è—¥æ©Ÿå¾Œï¼šè¼‰å…· status_id æ›´æ–°ç‚º 402ï¼ˆ**æ³¡è—¥ä¸­**ï¼‰

### é›™é‡é©—è­‰æ©Ÿåˆ¶ï¼ˆé‡è¦ï¼‰
- **è»Ÿé«”ç‹€æ…‹æª¢æŸ¥**: eqp_ports è¡¨ status = "empty"
- **ç¡¬é«”æ„Ÿæ¸¬å™¨é©—è­‰**: eqp_signals è¡¨ Presence signal value = "0"
- **åªæœ‰å…©è€…éƒ½æ»¿è¶³æ‰å‰µå»ºä»»å‹™**ï¼Œé¿å…ç¢°æ’æˆ–é‡è¤‡æ”¾æ–™
- ä»»å‹™åƒæ•¸åŒ…å« `presence_verified: true` æ¨™è¨˜

## ğŸ§ª æ¸¬è©¦è¦é»

### å–®å…ƒæ¸¬è©¦
1. âœ… æ­£ç¢ºéæ­·6å€‹ Station
2. âœ… æ­£ç¢ºä½¿ç”¨ç‰¹æ®Šè¨­å‚™é…ç½®ï¼ˆ1 station = 1 portï¼‰
3. âœ… AGV è¼‰å…·æ•¸é‡åˆ¤æ–·ï¼ˆ>= 1ï¼Œstatus_id=401ï¼‰
4. âœ… æ³¡è—¥æ©Ÿç©ºä½åˆ¤æ–·ï¼ˆä»»ä¸€å°æœ‰ç©ºä½ï¼Œè»Ÿé«” status="empty"ï¼‰
5. âœ… **Presence æ„Ÿæ¸¬å™¨é©—è­‰**ï¼ˆç¡¬é«” value="0"ï¼‰
6. âœ… **é›™é‡é©—è­‰é‚è¼¯**ï¼ˆè»Ÿé«” && ç¡¬é«”ï¼‰
7. âœ… èª¿è©¦é€šçŸ¥æ¶ˆæ¯

### æ•´åˆæ¸¬è©¦
1. âœ… å‹•æ…‹é¸æ“‡ç©ºé–’æ³¡è—¥æ©Ÿ
2. âœ… æ”¯æ´å¤šæ¬¡æµ¸æ³¡æµç¨‹
3. âœ… èˆ‡ TAKE_SOAKER éŠœæ¥
4. âœ… Presence æ„Ÿæ¸¬å™¨æ¨¡æ“¬æ¸¬è©¦

### é‚Šç•Œæ¸¬è©¦
1. âœ… 6å°æ³¡è—¥æ©Ÿå…¨æ»¿æ™‚ä¸å‰µå»ºä»»å‹™
2. âœ… AGV ç„¡è¼‰å…·æ™‚ä¸å‰µå»ºä»»å‹™
3. âœ… å¤šå€‹ Loader AGV ç«¶çˆ­æ³¡è—¥æ©Ÿ

## ğŸ”— ç›¸é—œæ–‡æª”

- **Loader AGV ä»£ç¢¼**: `/app/agv_ws/src/loader_agv/loader_agv/robot_states/put_soaker/`
- **Equipment Stations**: `/app/shared_constants_ws/src/shared_constants/shared_constants/equipment_stations.py` (SPECIAL_EQUIPMENT é…ç½®)
- **å¾ŒçºŒæµç¨‹**: Flow 5 - `TAKE_SOAKER`
