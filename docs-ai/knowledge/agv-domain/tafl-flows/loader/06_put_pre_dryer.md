# Flow 6: loader_put_pre_dryer.yaml

## ğŸ¯ æ¥­å‹™ç›®çš„
å°‡ Loader AGV è»Šä¸Šçš„è¼‰å…·æ”¾å…¥é çƒ˜æ©Ÿï¼Œé€²è¡Œé çƒ˜å¹²è™•ç†ï¼Œå®Œæˆå‰æ®µè£½ç¨‹ä¸¦éŠœæ¥ Unloader AGV

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

| é …ç›® | å€¼ |
|------|-----|
| æ–‡ä»¶å | `loader_put_pre_dryer.yaml` |
| Flow ID | `loader_put_pre_dryer` |
| å„ªå…ˆç´š | 42 |
| åŸ·è¡Œé–“éš” | 12 ç§’ |
| Work ID | **2050102, 2050302, 2050502, 2050702**ï¼ˆ4å€‹ï¼‰|

## ğŸ­ æ¥­å‹™å ´æ™¯

### å‰ç½®æ¢ä»¶
1. Loader AGV å·²å¾æ³¡è—¥æ©Ÿå–å‡ºè¼‰å…·ï¼ˆTAKE_SOAKER å®Œæˆï¼‰
2. AGV è»Šä¸Šæœ‰è¼‰å…·ï¼ˆ**status_id=501 é çƒ˜ä¸­ç‹€æ…‹**ï¼‰éœ€è¦æ”¾å…¥é çƒ˜æ©Ÿ
3. **é çƒ˜æ©Ÿï¼ˆ4å°ï¼‰æœ‰ç©ºä½**

### è§¸ç™¼æ¢ä»¶
- Loader AGV Port 2ã€4 æœ‰è¼‰å…·ï¼ˆ**è‡³å°‘1å€‹è¼‰å…·ï¼Œstatus_id=501**ï¼‰
- **é çƒ˜æ©Ÿï¼ˆä»»ä¸€å°ï¼‰æœ‰ç©ºä½**ï¼ˆè»Ÿé«” status="empty"ï¼‰
- æ²’æœ‰é‡è¤‡çš„æœªå®Œæˆä»»å‹™

**æ³¨æ„**ï¼šé çƒ˜æ©Ÿ**ç„¡ Presence æ„Ÿæ¸¬å™¨**ï¼Œåƒ…ä¾è³´è»Ÿé«”ç‹€æ…‹åˆ¤æ–·

### åŸ·è¡Œçµæœ
- å‰µå»º Loader AGV æ”¾æ–™ä»»å‹™
- ä»»å‹™é€²å…¥å¾…åˆ†æ´¾éšŠåˆ—ï¼ˆstatus_id = 1 PENDINGï¼‰
- è¼‰å…·æ”¾å…¥é çƒ˜æ©Ÿé€²è¡Œé çƒ˜å¹²
- **éŠœæ¥ Unloader AGV TAKE_PRE_DRYER æµç¨‹**

## ğŸ”§ æŠ€è¡“è¦æ ¼

### é çƒ˜æ©Ÿé…ç½®ï¼ˆStation-basedï¼‰

**ç‰©ç†çµæ§‹**ï¼š
- Equipment 205ï¼ˆé çƒ˜æ©Ÿ PRE_DRYERï¼‰
- 8å€‹ Portï¼ˆPort 1-8ï¼‰
- **4å€‹ Station**ï¼ˆ**Station 01, 03, 05, 07**ï¼‰

**Station-Port æ˜ å°„**ï¼ˆLoader AGV æ¨™æº–è¨­å‚™ï¼‰ï¼š
- **Station 01**: Port 1-2ï¼ˆ**Loader æ“ä½œ**ï¼‰
- **Station 03**: Port 3-4ï¼ˆ**Loader æ“ä½œ**ï¼‰
- **Station 05**: Port 5-6ï¼ˆ**Loader æ“ä½œ**ï¼‰
- **Station 07**: Port 7-8ï¼ˆ**Loader æ“ä½œ**ï¼‰

**Work ID å°æ‡‰**ï¼ˆ4å€‹ PUT Work IDsï¼‰ï¼š
- `2050102`: Station 01 æ”¾é çƒ˜æ©Ÿï¼ˆPort 1-2ï¼‰
- `2050302`: Station 03 æ”¾é çƒ˜æ©Ÿï¼ˆPort 3-4ï¼‰
- `2050502`: Station 05 æ”¾é çƒ˜æ©Ÿï¼ˆPort 5-6ï¼‰
- `2050702`: Station 07 æ”¾é çƒ˜æ©Ÿï¼ˆPort 7-8ï¼‰

**é—œéµç‰¹é»**ï¼š
- âœ… **4å€‹ Work ID**ï¼ˆLoader PUT æ“ä½œï¼‰
- âœ… **æ¨™æº–è¨­å‚™é…ç½®**ï¼ˆ1 station = 2 portsï¼‰
- âœ… **AGV ä¸€æ¬¡æ“ä½œ1æ ¼**ï¼ˆå…§éƒ¨é¸æ“‡åˆé©çš„ portï¼‰
- âœ… **èˆ‡ Unloader å…±äº«è¨­å‚™**ï¼ˆUnloader ä½¿ç”¨ Station 01, 03 æ‰¹é‡4æ ¼ï¼‰

### Loader æ“ä½œé‚è¼¯

**Loader AGV ç‰¹æ€§**ï¼ˆ1æ ¼ç²¾å¯†æ“ä½œï¼‰ï¼š
- **æ¯å€‹ Station åŒ…å«2å€‹ Port**ï¼ˆæ¨™æº–è¨­å‚™ï¼‰
- **ä¸€æ¬¡æ”¾æ–™æ“ä½œè™•ç†1æ ¼**ï¼ˆAGV å…§éƒ¨é¸æ“‡ç©ºé–’çš„ portï¼‰
- **éœ€è¦æª¢æŸ¥ AGV è‡³å°‘æœ‰1å€‹è¼‰å…·**ï¼ˆstatus_id=501 é çƒ˜ä¸­ï¼‰
- **éœ€è¦æª¢æŸ¥é çƒ˜æ©Ÿè‡³å°‘æœ‰1æ ¼ç©ºä½**ï¼ˆä»»ä¸€ Stationï¼‰
- **è»Ÿé«”ç‹€æ…‹æª¢æŸ¥**ï¼šeqp_ports.status = "empty"
- **å‹•æ…‹é¸æ“‡**ï¼šæ ¹æ“š port ç©ºé–’ç‹€æ…‹è‡ªå‹•é¸æ“‡æœ€ä½³ port

**è¨­å‚™ç‰¹æ€§**ï¼š
- âš ï¸ **é çƒ˜æ©Ÿç„¡ Presence æ„Ÿæ¸¬å™¨**
- åƒ…ä½¿ç”¨è»Ÿé«”ç‹€æ…‹åˆ¤æ–·ï¼Œç„¡ç¡¬é«”é©—è­‰

### èˆ‡ Unloader AGV éŠœæ¥

**è£½ç¨‹éŠœæ¥é»**ï¼š
- **Loader å®Œæˆ**: PUT_PRE_DRYER â†’ è¼‰å…·æ”¾å…¥é çƒ˜æ©Ÿï¼ˆstatus_id: 502 é çƒ˜ä¸­ï¼‰
- **è£½ç¨‹è™•ç†**: é çƒ˜æ©Ÿå®Œæˆé çƒ˜å¹² â†’ è¼‰å…· status_id æ›´æ–°ç‚º 503ï¼ˆé çƒ˜å®Œæˆï¼‰
- **Unloader æ¥æ‰‹**: TAKE_PRE_DRYER â†’ Unloader AGV å¾é çƒ˜æ©Ÿå–å‡ºè¼‰å…·

**å‰å¾Œæ®µéŠœæ¥**ï¼š
```
Loader AGV å‰æ®µè£½ç¨‹:
å…¥å£ç®± â†’ æ¸…æ´—æ©Ÿ â†’ æ³¡è—¥æ©Ÿ â†’ é çƒ˜æ©Ÿ (PUT_PRE_DRYER)
    â†“
[é çƒ˜æ©Ÿ] â† é—œéµéŠœæ¥é»
    â†“
Unloader AGV å¾Œæ®µè£½ç¨‹:
é çƒ˜æ©Ÿ (TAKE_PRE_DRYER) â†’ çƒ¤ç®± â†’ å‡ºå£ç®±
```

## ğŸ“ TAFL Flow è¨­è¨ˆ

### Metadata
```yaml
metadata:
  id: "loader_put_pre_dryer"
  name: "Loader AGV æ”¾æ–™åˆ°é çƒ˜æ©Ÿ"
  enabled: true
  version: "1.0.0"
  description: "æª¢æŸ¥ Loader AGV è»Šä¸Šè¼‰å…·å’Œé çƒ˜æ©Ÿç©ºä½ï¼Œå‰µå»ºæ”¾æ–™ä»»å‹™ï¼ˆéŠœæ¥ Unloader AGVï¼‰"
  author: "TAFL System"
  created_at: "2025-10-16"
  tags: ["loader", "pre_dryer", "put", "automation", "handover"]
```

### Variables
```yaml
variables:
  priority: 42
  model: "LOADER"
  pre_dryer_equipment_id: 205      # é çƒ˜æ©Ÿ Equipment ID
  # 4å€‹ Station é…ç½®ï¼ˆæ¨™æº–è¨­å‚™ï¼ŒLoader ä½¿ç”¨ï¼‰
  stations:
    - station: 1                   # Station 01
      work_id: 2050102
      ports: [1, 2]
      batch_size: 1                # Loader: 1æ ¼æ“ä½œ
      name: "é çƒ˜æ©Ÿ01"
    - station: 3                   # Station 03
      work_id: 2050302
      ports: [3, 4]
      batch_size: 1
      name: "é çƒ˜æ©Ÿ03"
    - station: 5                   # Station 05
      work_id: 2050502
      ports: [5, 6]
      batch_size: 1
      name: "é çƒ˜æ©Ÿ05"
    - station: 7                   # Station 07
      work_id: 2050702
      ports: [7, 8]
      batch_size: 1
      name: "é çƒ˜æ©Ÿ07"
```

## ğŸ”„ æµç¨‹é‚è¼¯

### ä¸»è¦æ­¥é©Ÿ

1. æŸ¥è©¢æ‰€æœ‰å•Ÿç”¨çš„æˆ¿é–“ï¼ˆèª¿è©¦é€šçŸ¥ï¼‰
2. éæ­·æ¯å€‹æˆ¿é–“ï¼ˆèª¿è©¦é€šçŸ¥é€²å…¥æˆ¿é–“ï¼‰
3. æŸ¥è©¢ Loader AGVï¼ˆmodel="Loader", enable=1ï¼‰
4. æŸ¥è©¢ AGV Port 2ã€4 è¼‰å…·ï¼ˆâ‰¥ 1å€‹ï¼Œ**status_id=501 é çƒ˜ä¸­**ï¼‰
5. **éæ­·4å€‹ Station**ï¼ˆé çƒ˜æ©Ÿ 01, 03, 05, 07ï¼‰
6. æŸ¥è©¢æ¯å€‹ Station çš„ç©ºä½ï¼ˆè»Ÿé«” status="empty"ï¼‰
7. æª¢æŸ¥é‡è¤‡ä»»å‹™ï¼ˆwork_id, room_id, status_id_in=[0,1,2,3]ï¼‰
8. å‰µå»ºæ”¾æ–™ä»»å‹™ï¼ˆå‹•æ…‹é¸æ“‡æœ‰ç©ºä½çš„ Stationï¼‰

**æ³¨æ„**ï¼šé çƒ˜æ©Ÿç„¡ Presence æ„Ÿæ¸¬å™¨ï¼Œç„¡ç¡¬é«”é©—è­‰æ­¥é©Ÿ

**é—œéµæŸ¥è©¢**ï¼š
```yaml
# éæ­·4å€‹ Station
- for:
    in: "${stations}"
    as: station
    do:
      # æŸ¥è©¢è©² Station çš„ç©ºä½ï¼ˆæª¢æŸ¥ 2 å€‹ portï¼‰
      - query:
          target: equipment_ports
          where:
            equipment_id: "${pre_dryer_equipment_id}"  # 205
            port_in: "${station.ports}"                # [1,2] æˆ– [3,4] ç­‰
            status: "empty"
          as: empty_ports

      # å¦‚æœæ­¤ Station æœ‰ç©ºä½ï¼Œå‰µå»ºä»»å‹™
      - if:
          condition: "${empty_ports.length > 0} && ${has_carriers} && ${no_existing_task}"
          then:
            - create:
                target: task
                with:
                  work_id: "${station.work_id}"
                  # ... å…¶ä»–åƒæ•¸
```

## âš ï¸ æ³¨æ„äº‹é …

### Station-based è¨­è¨ˆé‡é»
- **ç·¨ç¢¼è¦å‰‡**: work_id ä½¿ç”¨ Station ç·¨è™Ÿï¼ˆ**01/03/05/07**ï¼‰ï¼Œé Port èµ·å§‹è™Ÿ
- **æ¨™æº–è¨­å‚™æ˜ å°„**: **1 station = 2 ports**ï¼ˆLoader æ¨™æº–è¨­å‚™é…ç½®ï¼‰
- **å‹•æ…‹æ“ä½œ**: AGV å…§éƒ¨æ ¹æ“š port ç©ºé–’ç‹€æ…‹é¸æ“‡æœ€ä½³ port æ“ä½œ

### èˆ‡ Unloader å…±äº«è¨­å‚™
- **Loader PUT**: Station 01/03/05/07ï¼ˆ4å€‹ Stationï¼Œ1æ ¼æ“ä½œï¼‰
- **Unloader TAKE**: Station 01/03ï¼ˆ2å€‹ Stationï¼Œæ‰¹é‡4æ ¼ï¼‰
- **è¨­å‚™å…±äº«**: é çƒ˜æ©ŸåŒæ™‚æ”¯æ´ Loader å’Œ Unloader æ“ä½œ
- **ç„¡è¡çªè¨­è¨ˆ**: Loader æ”¾æ–™ â†’ é çƒ˜ â†’ Unloader å–æ–™ï¼Œé †åºæµç¨‹

### å‰å¾Œæ®µéŠœæ¥è¨­è¨ˆ
- **Loader æœ€å¾Œæµç¨‹**: PUT_PRE_DRYER å®Œæˆå‰æ®µè£½ç¨‹
- **Unloader é¦–å€‹æµç¨‹**: TAKE_PRE_DRYER å•Ÿå‹•å¾Œæ®µè£½ç¨‹
- **é—œéµéŠœæ¥é»**: é çƒ˜æ©Ÿä½œç‚ºå‰å¾Œæ®µè£½ç¨‹çš„æ©‹æ¨‘
- **ç‹€æ…‹è½‰æ›**: 502ï¼ˆé çƒ˜ä¸­ï¼‰â†’ 503ï¼ˆé çƒ˜å®Œæˆï¼‰

### ç‹€æ…‹ç¢¼æ˜ å°„
- å‰ç½®æ¢ä»¶ï¼šè¼‰å…· status_id = 501ï¼ˆ**é çƒ˜ä¸­**ï¼Œç­‰å¾…æ”¾å…¥é çƒ˜æ©Ÿï¼‰
- æ”¾å…¥é çƒ˜æ©Ÿå¾Œï¼šè¼‰å…· status_id æ›´æ–°ç‚º 502ï¼ˆ**é çƒ˜ä¸­**ï¼‰
- é çƒ˜å®Œæˆå¾Œï¼šè¼‰å…· status_id æ›´æ–°ç‚º 503ï¼ˆ**é çƒ˜å®Œæˆ**ï¼Œç­‰å¾… Unloader å–æ–™ï¼‰

### é©—è­‰æ©Ÿåˆ¶
- **è»Ÿé«”ç‹€æ…‹æª¢æŸ¥**: eqp_ports è¡¨ status = "empty"
- âš ï¸ **ç„¡ Presence æ„Ÿæ¸¬å™¨**ï¼šé çƒ˜æ©Ÿåƒ…ä½¿ç”¨è»Ÿé«”ç‹€æ…‹åˆ¤æ–·
- **é‡è¤‡ä»»å‹™æª¢æŸ¥**ï¼šé¿å…å‰µå»ºé‡è¤‡çš„æ”¾æ–™ä»»å‹™

## ğŸ§ª æ¸¬è©¦è¦é»

### å–®å…ƒæ¸¬è©¦
1. âœ… æ­£ç¢ºéæ­·4å€‹ Station
2. âœ… æ­£ç¢ºä½¿ç”¨æ¨™æº–è¨­å‚™é…ç½®ï¼ˆ1 station = 2 portsï¼‰
3. âœ… AGV è¼‰å…·æ•¸é‡åˆ¤æ–·ï¼ˆ>= 1ï¼Œstatus_id=501ï¼‰
4. âœ… é çƒ˜æ©Ÿç©ºä½åˆ¤æ–·ï¼ˆä»»ä¸€ Station æœ‰ç©ºä½ï¼Œè»Ÿé«” status="empty"ï¼‰
5. âœ… é‡è¤‡ä»»å‹™æª¢æŸ¥
6. âœ… èª¿è©¦é€šçŸ¥æ¶ˆæ¯

### æ•´åˆæ¸¬è©¦
1. âœ… å‹•æ…‹é¸æ“‡ç©ºé–’ Station
2. âœ… èˆ‡å‰ç½®æµç¨‹éŠœæ¥ï¼ˆTAKE_SOAKER æˆ–å…¶ä»–å‰æ®µæµç¨‹ï¼‰
3. âœ… èˆ‡ Unloader AGV éŠœæ¥ï¼ˆPUT_PRE_DRYER â†’ TAKE_PRE_DRYERï¼‰
4. âœ… å®Œæ•´è£½ç¨‹æµç¨‹ï¼ˆå…¥å£ â†’ æ¸…æ´— â†’ æ³¡è—¥ â†’ é çƒ˜ â†’ Unloaderï¼‰

### é‚Šç•Œæ¸¬è©¦
1. âœ… 4å€‹ Station å…¨æ»¿æ™‚ä¸å‰µå»ºä»»å‹™
2. âœ… AGV ç„¡è¼‰å…·æ™‚ä¸å‰µå»ºä»»å‹™
3. âœ… å¤šå€‹ Loader AGV ç«¶çˆ­é çƒ˜æ©Ÿ
4. âœ… Loader å’Œ Unloader åŒæ™‚æ“ä½œé çƒ˜æ©Ÿ

## ğŸ”— ç›¸é—œæ–‡æª”

- **Loader AGV ä»£ç¢¼**: `/app/agv_ws/src/loader_agv/loader_agv/robot_states/put_pre_dryer/`
- **Equipment Stations**: `/app/shared_constants_ws/src/shared_constants/shared_constants/equipment_stations.py`
- **å‰ç½®æµç¨‹**: Flow 5 - `TAKE_SOAKER`ï¼ˆæˆ–å…¶ä»–å‰æ®µæµç¨‹ï¼‰
- **å¾ŒçºŒæµç¨‹**: **Unloader AGV** - `TAKE_PRE_DRYER`ï¼ˆå¾Œæ®µè£½ç¨‹å•Ÿå‹•ï¼‰
