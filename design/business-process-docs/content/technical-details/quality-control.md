# 品質管制系統 (規劃中)

## 概述

**⚠️ 注意：品質管制功能目前處於規劃階段，以下描述為系統設計目標，實際功能尚未完全實作。**

RosAGV 系統規劃整合視覺檢測和異常處理機制，以支援眼鏡生產的品質管理需求。

## 規劃功能

### 視覺檢測系統 (開發中)

#### SensorPart 整合 (計劃)
- **規劃功能**: 3D 視覺定位 + OCR 識別
- **預定部署**: Cargo AGV 機械臂
- **目標能力**:
  - Rack 整體掃描定位
  - Carrier 位置識別
  - 產品編號讀取 (OCR)
  - 產品類型識別

#### 檢測流程 (概念設計)
```
規劃的視覺檢測流程
1. Rack 整體掃描 → 取得 Carrier 位置
2. 逐一 Carrier 處理：
   ├── 移動到指定位置
   ├── 執行視覺識別
   └── 記錄處理結果
```

### 製程適配驗證 (概念)

#### 規劃的驗證機制
- **目標功能**:
  - 產品類型識別
  - 房間製程能力匹配
  - 異常產品標記

#### 處理邏輯 (設計概念)
```
規劃的處理流程：
- 正常情況：將產品送入製程
- 異常情況：標記並隔離處理
```

## 品質管制機制 (設計階段)

### 規劃的檢查體系

#### 基礎功能目標
- **產品識別**: 透過視覺系統識別產品
- **狀態追蹤**: 記錄產品處理狀態
- **異常處理**: 隔離異常產品

### 異常處理流程 (規劃)

#### 異常產品處理
- **隔離區域**: 規劃 NG 處理區 (71-72)
- **人工介入**: 需要人工確認和處理
- **狀態重置**: 透過 AGVCUI 介面管理

#### 基本處理步驟
```
規劃的異常處理流程：
1. 識別異常 → 標記產品
2. 隔離處理 → 送到專用區域
3. 人工處理 → 確認和修正
4. 狀態重置 → 更新系統記錄
```

## 資料管理

### 實際資料庫結構

#### Carrier 資料表 (現有)
```sql
-- 實際的 carrier 表結構
carrier 表:
├── id: 主鍵
├── room_id: 房間 ID (可選)
├── rack_id: 所屬 Rack ID (可選)
├── port_id: 設備端口 ID (可選)
├── rack_index: Rack 位置索引 (可選)
├── status_id: 狀態 ID (可選)
├── created_at: 建立時間
└── updated_at: 更新時間
```

**註：** 目前 Carrier 表僅追蹤基本位置和狀態資訊，尚未包含品質檢查相關欄位。

### 監控功能 (規劃)

#### 規劃的監控機制
- **狀態追蹤**: Carrier 和 Rack 狀態監控
- **異常通知**: 透過 Web 介面顯示
- **基本統計**: 處理數量統計

## 系統整合現況

### AGV 整合

#### Cargo AGV 視覺定位 (實作中)
- **rack_vision_position_state.py**: 處理 Rack 上下層拍照定位
- **transfer_vision_position_state.py**: 處理傳送箱視覺定位
- **實際功能**: 目前主要用於位置定位，OCR 功能尚在開發中

### WCS 整合

#### 任務優先級配置 (YAML 驅動)
```yaml
# 實際的優先級配置 (來自 TAFL 流程)
priorities:
  100: AGV旋轉檢查
  90: NG料架回收
  80: 滿料架到人工收料區
  60: 系統準備區到房間
  40: 空料架搬運
```

### Web API 現況

#### 實際可用的 API
- **Carrier 查詢**: `/carrier_query` (ROS 2 服務)
- **Rack 查詢**: `/rack_query` (ROS 2 服務)
- **狀態更新**: 透過 AGVCUI 介面進行

**註：** 專門的品質管理 API 尚未實作。

## 監控指標 (規劃)

### 基礎指標
- **處理數量**: Carrier 處理總數
- **狀態分佈**: 各狀態 Carrier 數量
- **處理時間**: 平均處理時間

### 未來發展
- 視覺系統整合完成後，可增加識別準確率等指標
- 異常處理機制完善後，可追蹤 NG 處理效率

## 開發建議

### 當前重點
1. **完成視覺整合**: 實作 SensorPart OCR 功能
2. **資料庫擴展**: 在 Carrier 表增加品質相關欄位
3. **API 開發**: 實作品質管理相關 API
4. **介面完善**: 在 AGVCUI 增加品質監控功能

### 實施步驟
1. **第一階段**: 完成基本 Carrier 狀態追蹤
2. **第二階段**: 整合視覺系統和 OCR 功能
3. **第三階段**: 實作異常處理流程
4. **第四階段**: 增加統計和報表功能

## 相關文檔

- [系統架構](../system-architecture/dual-environment.md) - RosAGV 雙環境架構
- [技術棧詳細](../system-architecture/technology-stack.md) - 系統技術組件
- [車型特性](../agv-vehicles/vehicle-types.md) - AGV 車型和功能
- [PLC 整合](plc-integration.md) - PLC 通訊和控制
- [眼鏡生產流程](../business-processes/eyewear-production.md) - 完整業務流程