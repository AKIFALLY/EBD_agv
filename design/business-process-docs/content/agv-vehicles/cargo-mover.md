# Cargo Mover AGV - 貨物搬運車

## 🚛 Cargo Mover AGV 概述

Cargo Mover AGV 是 RosAGV 系統中專門負責架台與傳送箱間貨物搬運的自動導引車，採用麥克納姆輪全向移動技術，具備完整的機械臂操作能力。

## ⚙️ 核心特性

### 基本規格
- **移動系統**: 麥克納姆輪全向移動
- **機械臂**: Robot 控制系統 (共用 agv_base.robot.Robot)
- **控制架構**: 3層狀態機 (Base-AGV-Robot)
- **光通訊**: Hokuyo 8bit 光通訊模組 (左右側配置)

### 機械結構
```
Cargo Mover 結構組成
├── 移動底盤
│   ├── 麥克納姆輪系統 (全向移動)
│   ├── PLC 控制系統 (IP: 192.168.2.101:8501)
│   └── 安全感測器系統
├── 機械臂系統
│   ├── Robot 控制器 (agv_base.robot.Robot)
│   ├── PLC 通訊介面
│   ├── PGNO 指令系統 (40000-40009, 50000)
│   └── 參數管理 (CargoRobotParameter)
└── 光通訊系統
    ├── Hokuyo 8bit 光通訊模組 (左右側)
    ├── PLC 資料通訊
    └── 8bit 資料傳輸
```

## 🏭 應用場景

### 主要工作流程

#### ENTRANCE 流程 (入口流程)
```python
# 入口流程：架台 → 等待旋轉 → 傳送箱
1. AGV 到達架台位置
2. 機械臂拍照確認貨物 (視覺定位功能開發中)
3. 執行取料操作
4. 移動到傳送箱位置
5. 放置貨物到傳送箱
```

#### EXIT 流程 (出口流程)
```python
# 出口流程：傳送箱 → 等待旋轉 → 架台
1. AGV 到達傳送箱位置
2. 機械臂取出處理完成的貨物
3. 移動到指定架台位置
4. 將貨物放回架台
```

### 光通訊系統 (已實作)
- **左右側 Hokuyo 模組**: 提供 8bit 光通訊能力 ✅
- **PLC 資料通訊**: 與生產設備的即時資料交換 ✅
- **狀態同步**: 確保與整體生產線的協調 ✅

## 🔧 技術實作

### Robot 控制系統
```python
# Cargo Robot PGNO 指令集
class CargoRobotStates:
    CHG_PARA = "40000"           # 參數變更
    PHOTO_RACK_UP = "40001"      # 架台上層拍照
    PHOTO_RACK_DOWN = "40002"    # 架台下層拍照  
    PHOTO_BOX_IN = "40003"       # 入口箱拍照
    PHOTO_BOX_OUT = "40004"      # 出口箱拍照
    IDLE = "50000"               # 機械臂閒置
```

### 參數管理
```python
# CargoRobotParameter 配置
class CargoRobotParameter:
    rack_port: int              # 架台端口 (1-32)
    boxin_port: int             # 入口箱端口
    boxout_port: int            # 出口箱端口
    # 動態參數計算和 PLC 同步
```

### 狀態機架構
- **Base 層**: 基礎移動和安全控制
- **AGV 層**: Cargo 特定的業務邏輯
- **Robot 層**: 機械臂操作和視覺處理

## 📊 開發狀態

### 已完成功能 (65%)
- ✅ **基礎架構**: 3層狀態機框架完整
- ✅ **移動系統**: 麥克納姆輪全向移動控制
- ✅ **Hokuyo 光通訊**: 左右側 8bit 光通訊模組整合
- ✅ **機械臂控制**: Robot PGNO 指令系統
- ✅ **測試框架**: Hokuyo 和非同步任務測試
- ✅ **PLC 整合**: Keyence 協議通訊

### 開發中功能 (35%)
- 🔄 **視覺定位系統**: SensorPart 3D 掃描和 OCR 識別整合中
- 🔄 **製程適配檢查**: 產品類型和製程匹配邏輯開發中
- 🔄 **製程適配性驗證**: 產品製程匹配檢查機制優化中
- 🔄 **A/B 雙面處理**: 完整的雙面處理流程測試中

### 技術特點
- **全向移動**: 麥克納姆輪提供任意方向移動
- **精確定位**: 目標達到亞公分級定位精度
- **容錯處理**: 基礎異常處理機制已實作

## 🔗 系統整合

### PLC 通訊
- **Keyence 協議**: 標準工業通訊協議
- **即時控制**: 毫秒級響應時間
- **狀態同步**: 與生產線設備的狀態同步

### ROS 2 整合
- **Zenoh RMW**: 高效能跨容器通訊
- **服務導向**: 標準化的 ROS 2 服務介面
- **模組化設計**: 易於維護和擴展

## 💡 使用指導

### 部署配置
1. **硬體安裝**: 麥克納姆輪、機械臂、感測器安裝
2. **網路配置**: PLC 通訊和 Zenoh 網路設定
3. **參數調校**: 根據實際環境調整操作參數
4. **測試驗證**: 完整的功能測試和安全驗證

### 維護要點
- **定期校正**: 機械臂和感測器校正
- **軟體更新**: ROS 2 節點和 PLC 程式更新
- **效能監控**: 移動速度和操作精度監控
- **預防維護**: 根據使用情況進行預防性維護

---

**相關文檔：**
- [AGV 車型介紹](vehicle-types.md) - 三種車型對比
- [系統架構](../system-architecture/dual-environment.md) - 雙環境設計
- [技術整合](../technical-details/ros2-integration.md) - ROS 2 實作細節