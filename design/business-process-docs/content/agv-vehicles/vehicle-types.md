# AGV 車型介紹

## 🎯 三種專業 AGV 車型

RosAGV 系統配備三種高度專業化的 AGV 車型，每種車型都針對特定的業務流程進行最佳化設計，共同組成完整的自動化解決方案。

## 🚛 Cargo Mover AGV - 貨物搬運專家

### 核心定位
**架台與傳送箱間的精密搬運專家**，負責房間門口的製程適配性檢查和貨物轉移作業。

### 技術規格
| 項目 | 規格 | 說明 |
|------|------|------|
| **載重能力** | 500kg | 單次搬運重量上限 |
| **運行速度** | 最大 1.5 m/s | 平衡速度與精度 |
| **安全距離** | 0.5m | 障礙物檢測距離 |
| **工作範圍** | 房間門口區域 | 專注於進出口作業 |
| **完成度** | 60% | 核心功能已實現 |

### 🔧 核心技術特色

#### 全向移動系統
```
麥克納姆輪配置：
├── 前後移動 ←→
├── 左右平移 ↕  
├── 斜向移動 ↗↖↙↘
├── 原地旋轉 ↻↺
└── 精密定位 (毫米級)
```

#### Hokuyo 8bit 光通訊系統
- **雙側配置**：左右兩側 Hokuyo 光通訊模組
- **PLC 資料通訊**：8bit 資料傳輸協議
- **門控協調**：自動門開關協調
- **安全機制**：光學感測器安全保護

#### 3D 視覺系統
- **SensorPart 相機**：整個 Rack 的 3D 掃描
- **OCR 識別**：產品編號和類型自動識別
- **製程匹配**：比對房間製程能力
- **製程適配性檢查**：檢查產品是否符合該房間製程要求

### 🎯 主要業務流程

#### ENTRANCE 流程（入口）
```
1. Rack 到達 → 3D 視覺定位掃描整個 Rack
2. 逐一 Carrier 處理：
   ├── OCR 識別產品編號和類型
   ├── 製程匹配檢查
   ├── 符合製程 → 放入入口傳送箱
   └── 不符製程 → 標記 NG，留在 Rack 上
3. A 面處理完成 → 等待 Rack 180° 旋轉
4. B 面處理 → 重複相同流程
```

#### EXIT 流程（出口）
```
1. 從出口傳送箱取出處理完成的 Carrier
2. 透過 8bit 光通訊協調門控系統
3. 將 Carrier 放回 Rack 對應位置
4. 完成 A/B 雙面收集後判定 Rack 狀態
```

### 🤖 機械臂控制系統

#### PGNO 程式控制
```python
# Cargo Mover Robot PGNO 定義
class CargoRobotStates:
    CHG_PARA = "40000"           # 參數變更
    PHOTO_RACK_UP = "40001"      # 架台上層拍照
    PHOTO_RACK_DOWN = "40002"    # 架台下層拍照  
    PHOTO_BOX_IN = "40003"       # 入口箱拍照
    PHOTO_BOX_OUT = "40004"      # 出口箱拍照
    IDLE = "50000"               # 機械臂閒置
```

#### 端口參數管理
- **架台端口 (1-32)**：Rack 上的 Carrier 位置
- **入口箱端口**：房間入口傳送箱接口
- **出口箱端口**：房間出口傳送箱接口
- **動態配置**：根據產品類型自動調整參數

## 🏗️ Loader AGV - 多工位載料專家

### 核心定位
**房間內前段製程的精密載料專家**，負責入口傳送箱到各製程設備間的精密轉移。

### 技術規格
| 項目 | 規格 | 說明 |
|------|------|------|
| **工位支援** | 4 種工位 | Transfer, Cleaner, Soaker, Pre-dryer |
| **AGV 端口** | port1-4 | 4 層垂直料架 |
| **操作精度** | 一次 1 格 | 精密單格操作 |
| **製程支援** | 2 種製程 | 泡藥 1 次/2 次 |
| **完成度** | 100% ✅ | 生產就緒狀態 |

### 🔧 專業工位配置

#### 設備端口管理
```
Loader AGV 工位配置：
├── Transfer 端口 (port1-4)     # 傳送箱接口
├── Cleaner 端口 (port1-4)      # 清潔機接口（2台工位）
├── Soaker 端口 (port1-6)       # 浸潤機接口（6台工位，主要製程）
└── Pre-dryer 端口 (port1-8)    # 預乾燥機接口（8台工位）
```

#### 端口狀態管理
- **實時狀態監控**：所有端口的即時狀態檢測
- **動態端口分配**：自動選擇最佳可用端口
- **優先級管理**：根據製程優先級分配資源
- **故障檢測**：端口異常自動檢測和報告

### 🎯 製程流程支援

#### 製程 1（泡藥 1 次）
```
1. TAKE_TRANSFER → 從入口傳送箱取料
2. PUT_CLEANER → 放入清潔機清潔
3. TAKE_CLEANER → 從清潔機取出
4. PUT_SOAKER → 放入浸潤機泡藥
5. TAKE_SOAKER → 從浸潤機取出
6. PUT_PRE_DRYER → 放入預乾燥機
```

#### 製程 2（泡藥 2 次）
```
1-3. 同製程 1 的清潔流程
4. PUT_SOAKER → 第 1 次泡藥
5. TAKE_SOAKER → 第 1 次取出
6. PUT_SOAKER → 第 2 次泡藥
7. TAKE_SOAKER → 第 2 次取出
8. PUT_PRE_DRYER → 放入預乾燥機
```

### 🤖 Robot 控制系統

#### 狀態機步驟
```python
# Loader Robot 控制狀態
class LoaderRobotContext:
    IDLE = 0              # 閒置狀態
    CHECK_IDLE = 1        # 檢查閒置
    WRITE_CHG_PARA = 2    # 寫入參數變更
    WRITE_PGNO = 4        # 寫入程式編號
    CHECK_PGNO = 5        # 檢查程式狀態
    ACTING = 6            # 執行中
    FINISH = 99           # 完成
```

#### 參數化控制
- **LoaderRobotParameter**：彈性配置系統
- **產品適配**：S/L 尺寸產品的不同配置策略
- **動態參數更新**：實時參數同步到 PLC
- **完整測試覆蓋**：全面的單元測試和整合測試

## 🏭 Unloader AGV - 批量卸料專家

### 核心定位
**房間內後段製程的高效批量卸料專家**，負責預乾燥機、烘乾機到出口傳送箱的批量轉移。

### 技術規格
| 項目 | 規格 | 說明 |
|------|------|------|
| **批量操作** | 一次 2 格 | 高效批量處理 |
| **工位支援** | 3 種工位 | Pre-dryer, Oven, Boxout Transfer |
| **料架配置** | 上下 2 排 | 上 2 格 + 下 2 格設計 |
| **烘箱管理** | 雙向操作 | 上排進料、下排出料 |
| **完成度** | 40% | 基礎架構完整 |

### 🔧 高效批量系統

#### 批量處理流程
```
Unloader AGV 批量處理：
1. TAKE_PRE_DRYER → 從預乾燥機取出（一次 2 格）
2. PUT_OVEN → 放入烘箱上排進行烘乾（一次 2 格）
3. [烘乾製程：上排 → 下排]
4. TAKE_OVEN → 從烘箱下排取出（一次 2 格）
5. PUT_BOXOUT_TRANSFER → 送到出口傳送箱（一次 2 格）
```

#### 料架設計特色
- **上下 2 排設計**：最佳化批量效率
- **批量同步**：所有操作都採用 2 格同步處理
- **烘箱協調**：上排進料下排出料的循環管理
- **高效輸送**：減少操作次數，提高整體效率

### 🤖 控制系統

#### 分揀功能
- **分揀邏輯**：根據產品類型和品質自動分揀
- **工作 ID 範圍**：31-40（4 個主要流程）
- **異常處理**：批量操作中的單件異常處理
- **品質追蹤**：完整的批量品質記錄

## 🔄 三車協作機制

### 工作流程協調
```
三車協作完整流程：
┌─────────────────────────────────────────┐
│ 1. KUKA AGV 長距離搬運                   │
│    ├── 空 rack 配送到射出機停車格       │
│    ├── 滿 rack 搬運到房間門口           │
│    └── Rack 180° 旋轉確保 A/B 雙面處理  │
├─────────────────────────────────────────┤
│ 2. Cargo Mover AGV 製程適配性檢查       │
│    ├── 3D 視覺掃描 + OCR 識別           │
│    ├── 製程適配性檢查                   │
│    ├── 符合製程 → 入口傳送箱            │
│    └── 不符製程 → 標記 NG               │
├─────────────────────────────────────────┤
│ 3. Loader AGV 精密製程                  │
│    ├── 從入口傳送箱取料                 │
│    ├── 清潔 → 浸潤（1-2次）→ 預乾燥     │
│    └── 一次 1 格精密操作                │
├─────────────────────────────────────────┤
│ 4. Unloader AGV 批量輸出                │
│    ├── 從預乾燥機批量取出               │
│    ├── 烘箱上排進料下排出料             │
│    └── 一次 2 格高效處理                │
├─────────────────────────────────────────┤
│ 5. Cargo Mover AGV 收集                 │
│    ├── 從出口傳送箱取出完成品           │
│    ├── 放回 Rack 對應位置               │
│    └── A/B 雙面收集完成                 │
└─────────────────────────────────────────┘
```

### 系統整合亮點
- **統一狀態機架構**：所有 AGV 共用 Base-AGV-Robot 3 層架構
- **Zenoh RMW 通訊**：高效能跨環境通訊
- **麥克納姆輪一致性**：全向移動能力，精確定位
- **機械臂標準化**：統一的 Robot 控制系統

## 📊 效能比較分析

### 車型特性對比
| 特性 | Cargo Mover | Loader | Unloader |
|------|-------------|---------|----------|
| **主要職責** | 製程適配檢查+搬運 | 精密載料 | 批量卸料 |
| **操作模式** | 單件精密 | 單件精密 | 批量高效 |
| **工作區域** | 房間門口 | 房間前段 | 房間後段 |
| **處理速度** | 中等 | 精密慢速 | 高速批量 |
| **技術複雜度** | 高（視覺+OCR） | 高（多工位） | 中（批量處理） |
| **完成度** | 60% | 100% ✅ | 40% |

### 互補性設計
- **工作區域互補**：門口 → 前段 → 後段，無重疊衝突
- **處理方式互補**：品檢 → 精密 → 批量，效率最大化
- **技術特長互補**：視覺識別 + 多工位精密 + 批量處理
- **完成度梯度**：成熟產品帶動新產品發展

## 🚀 未來發展規劃

### 擴展能力
- **多車部署**：每種車型可擴展到多台備援
- **產能提升**：根據生產需求靈活擴展 AGV 數量
- **製程多樣化**：支援更多種類的產品製程
- **系統升級**：持續優化和改進

### 技術演進
- **視覺系統升級**：更先進的 3D 視覺和 OCR 識別
- **機械臂精度提升**：毫米級精度的進一步提升
- **通訊協議優化**：更高效的 PLC 和設備通訊
- **定期維護**：基於使用時數和狀態的維護排程

## 🔗 相關技術資源

- [眼鏡生產完整流程](../business-processes/eyewear-production.md) - 看三車如何協作
- [室內製程基礎調度](../business-processes/indoor-process.md) - WCS 如何統一管理
- [雙環境技術架構](../system-architecture/dual-environment.md) - 技術實現原理
- [ROS 2 技術整合](../technical-details/ros2-integration.md) - 通訊和控制技術

---

💡 **總結**：三種 AGV 車型形成完美的技術組合，Cargo Mover 的視覺品檢、Loader 的精密操作、Unloader 的批量效率，共同實現了自動化製造的完整解決方案。