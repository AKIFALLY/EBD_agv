# RosAGV 使用者介面需求規格

## 📋 概述

本文檔詳細描述 RosAGV 系統中 AGVCUI 和 OPUI 兩個 Web 介面系統的使用者介面需求，基於實際前端程式碼實作和業務需求。

## 👥 使用者角色定義

### 1. AGVCUI 使用者角色

#### 1.1 系統管理員 (Admin)
- **職責**: 系統配置、使用者管理、權限控制
- **存取權限**: 完整系統存取權限
- **主要功能**: 使用者管理、資料庫管理、系統配置

#### 1.2 車隊調度員 (Dispatcher)
- **職責**: AGV 任務調度、車隊監控、異常處理
- **存取權限**: 車隊管理功能存取權限
- **主要功能**: 任務管理、AGV 監控、地圖查看

#### 1.3 監控人員 (Monitor)
- **職責**: 系統狀態監控、資料查看
- **存取權限**: 唯讀存取權限
- **主要功能**: 儀表板查看、狀態監控、日誌查看

### 2. OPUI 使用者角色

#### 2.1 現場操作員 (Operator)
- **職責**: 機台操作、AGV 叫車派車、料架管理
- **存取權限**: 特定機台操作權限
- **主要功能**: AGV 操作、產品設定、料架管理

#### 2.2 機台維護員 (Technician)
- **職責**: 機台設定、產品配置、系統維護
- **存取權限**: 機台配置權限
- **主要功能**: 產品設定、機台配置、系統設定

## 🖥️ AGVCUI 介面需求

### 3. 整體設計需求

#### 3.1 視覺設計框架 ✅
- **設計系統**: 基於 Bulma CSS 框架 v1.0.4
- **圖示系統**: Material Design Icons (MDI)
- **色彩主題**: 淺色主題 (data-theme="light")
- **語言支援**: 繁體中文 (lang="zh-TW")
- **響應式設計**: 專注於桌面環境支援

#### 3.2 佈局架構 ✅
- **基礎模板**: base.html 提供統一的頁面結構
- **導航系統**: 頂部導航欄 (navbar.html)
- **主要內容區**: main-content 容器
- **模態框系統**: 通用刪除確認模態框

### 4. 認證介面需求

#### 4.1 登入頁面 (login.html) ✅
- **頁面標題**: "登入 - AGVC UI"
- **品牌標識**: CT Logo (CTLogo.svg)
- **表單欄位**:
  - 用戶名輸入框 (必填，自動完成支援)
  - 密碼輸入框 (必填，自動完成支援)
  - 隱藏重定向欄位
- **視覺元素**:
  - 登入卡片居中佈局
  - 圖示輔助 (mdi-account, mdi-lock, mdi-login)
  - 錯誤訊息顯示區域
- **使用者指導**:
  - 預設管理員帳號提示: "admin / admin123"
  - 初始化管理員連結: "/init-admin"

#### 4.2 認證流程 ✅
- **登入方式**: Socket.IO 即時認證
- **認證回饋**: 即時錯誤訊息顯示
- **登入成功**: 自動重定向到目標頁面
- **會話管理**: Cookie 基礎的 JWT Token

### 5. 導航系統需求

#### 5.1 主導航欄 (navbar.html) ✅
- **品牌區域**: "Agvc UI" 品牌標識
- **主要導航項目**:
  - Map (地圖管理)
  - Tasks (任務管理)
  - Works (工作管理)
  - AGVs (車輛管理)
  - Devices (設備管理)
  - Signals (信號管理)

#### 5.2 下拉選單系統 ✅
- **日誌管理下拉**:
  - Rosout logs (ROS 日誌)
  - Runtime logs (運行日誌)
  - Audit logs (審計日誌)
- **使用者管理下拉**:
  - Clients (客戶端)
  - Racks (料架)
  - Products (產品)
  - Carriers (載具)
- **幫助選單下拉**:
  - WebApi 文檔連結
  - OPUI 系統連結
  - KUKA Fleet 連結
  - 版本資訊

#### 5.3 使用者狀態區域 ✅
- **使用者資訊顯示**:
  - 使用者名稱和角色
  - 管理員徽章 (admin-badge)
  - 連線狀態指示
- **使用者操作**:
  - 使用者管理連結 (管理員限定)
  - 資料庫管理連結 (管理員限定)
  - 登出功能

### 6. 儀表板介面需求

#### 6.1 系統儀表板 (home.html) ✅
- **頁面標題**: "系統儀表板"
- **副標題**: "即時監控 AGV 系統運行狀態"
- **佈局結構**: dashboard-grid 卡片網格佈局
- **專用樣式**: dashboardPage.css

#### 6.2 儀表板功能模組 ✅
- **任務表卡片**: 半寬度佈局，任務狀態監控
- **AGV 狀態卡片**: 車輛狀態即時顯示
- **系統狀態卡片**: 整體系統健康狀態
- **統計資訊卡片**: 關鍵指標統計

### 7. 管理頁面介面需求

#### 7.1 頁面專用樣式系統 ✅
- **AGV 管理**: agvsPage.css
- **任務管理**: tasksPage.css
- **工作管理**: worksPage.css
- **設備管理**: devicesPage.css, deviceFormPage.css
- **信號管理**: signalsPage.css
- **產品管理**: productsPage.css
- **料架管理**: racksPage.css
- **載具管理**: carriersPage.css
- **使用者管理**: usersPage.css, userFormPage.css

#### 7.2 地圖管理介面 ✅
- **地圖顯示**: Leaflet.js 地圖引擎
- **專用樣式**: mapPage.css, leaflet.css
- **全螢幕控制**: Control.FullScreen.css
- **地圖功能**: 節點顯示、路徑規劃、AGV 位置追蹤

### 8. 前端架構需求

#### 8.1 模組化載入系統 ✅
- **按需載入**: 根據當前頁面路徑動態載入所需模組
- **效能優化**: 優化載入效能和記憶體使用
- **模組分離**: 頁面專用功能與共用功能分離

#### 8.2 狀態管理系統 ✅
- **Store 系統**: mapStore, userStore 全域狀態管理
- **即時同步**: Socket.IO 即時資料同步
- **狀態持久化**: 本地儲存支援

#### 8.3 通用功能模組 ✅
- **導航管理**: navbar.js
- **通知系統**: notify.js
- **Socket 通訊**: socket.js
- **模態框管理**: deleteModal.js

## 📱 OPUI 介面需求

### 9. 整體設計需求

#### 9.1 視覺設計框架 ✅
- **設計系統**: 基於 Bulma CSS 框架 v1.0.4
- **圖示系統**: Material Design Icons (MDI)
- **自訂樣式**: opui-bulma-extend.css
- **語言支援**: 繁體中文 (lang="zh-TW")
- **快取控制**: 強制無快取設定

#### 9.2 佈局架構 ✅
- **基礎模板**: base.html 提供統一的頁面結構
- **主容器**: main-root 根容器
- **導航系統**: 頂部導航欄 (navbar.html)
- **頁面內容**: 直接嵌入主容器

### 10. 設備授權需求

#### 10.1 設備識別系統 ✅
- **授權參數**: deviceId URL 參數 (必填)
- **授權驗證**: 後端設備授權檢查
- **錯誤處理**: 缺少 deviceId 時顯示 400 錯誤
- **授權失敗**: 無效 deviceId 時顯示 403 錯誤

#### 10.2 導航系統整合 ✅
- **參數傳遞**: 所有導航連結自動包含 deviceId
- **狀態保持**: 頁面切換時保持設備授權狀態
- **連線指示**: WiFi 圖示顯示連線狀態 (綠色/紅色)

### 11. 操作介面需求

#### 11.1 首頁操作介面 (home.html) ✅
- **雙面板佈局**: 左右分離的操作面板
- **面板配色**: 左面板 (#eee)，右面板 (#ddd)
- **操作按鈕配置**:
  - 叫車按鈕 (左上/右上，藍色 is-info)
  - 派車按鈕 (左下/右下，橙色 is-warning)

#### 11.2 產品選擇系統 ✅
- **產品按鈕**: 每側一個產品選擇按鈕 (is-link is-light)
- **切換邏輯**: 點擊循環切換產品選項
- **狀態顯示**: 即時顯示當前選中的產品

#### 11.3 數量選擇矩陣 ✅
- **矩陣規格**:
  - S 尺寸產品: 32 個按鈕 (2 個 4 行 x 4 列的按鈕組)
  - L 尺寸產品: 16 個按鈕 (2 個 2 行 x 4 列的按鈕組)
- **按鈕樣式**: 統一的數量按鈕樣式
- **選擇回饋**: 選中狀態的視覺回饋

#### 11.4 料架管理區域 ✅
- **料架編號顯示**: 當前分配的料架編號
- **料架選擇**: 料架選擇控制項
- **狀態指示**: 料架分配狀態顯示

### 12. 設定介面需求

#### 12.1 設定頁面 (setting.html) ✅
- **機台選擇**: 4 個機台按鈕 (1-4 號機台)
- **機台狀態**: 按鈕禁用狀態指示
- **雙側配置**: OP1 和 OP2 分離配置

#### 12.2 產品配置系統 ✅
- **產品輸入**: 每側 2 個產品名稱輸入框
- **輸入驗證**: 自動轉換小寫為大寫
- **狀態指示**: 產品檢查圖示 (綠色勾選)
- **即時同步**: 輸入變更即時同步到後端

### 13. 料架管理介面需求

#### 13.1 料架頁面 (rack.html) ✅
- **雙側管理**: OP1 和 OP2 分離管理
- **手動新增**: 料架編號輸入和新增按鈕
- **輸入類型**: 
  - OP1: 數字輸入 (inputmode="numeric")
  - OP2: 文字輸入
- **新增按鈕**: 標籤加號圖示 (mdi-tag-plus-outline)

#### 13.2 停靠狀態顯示 ✅
- **停靠區域**: 目前停靠料架的標籤顯示
- **標籤樣式**: 大尺寸標籤 (tag is-large)
- **刪除功能**: 標籤刪除按鈕
- **動態更新**: JavaScript 動態產生和更新

### 14. 前端架構需求

#### 14.1 模組化架構 ✅
- **頁面分離**: homePage.js, settingPage.js, rackPage.js
- **共用功能**: index.js 統一管理
- **通訊層**: api.js Socket.IO 通訊封裝
- **狀態管理**: store.js 多 Store 架構

#### 14.2 狀態管理系統 ✅
- **使用者狀態**: userStore (clientId, machineId, 連線狀態)
- **操作狀態**: operationStore (op 扁平化資料結構)
- **資料狀態**: dataStore (產品、機台、房間列表)
- **任務狀態**: tasksStore (活躍任務狀態)
- **UI 狀態**: uiStore (載入狀態、當前頁面)

#### 14.3 DOM 更新優化需求 🔧
- **需求**: 實作高效能的任務狀態 DOM 更新策略
- **實作狀態**: 需要改善
- **功能範圍**:
  - **增量更新策略**:
    - 只更新變更的任務狀態標籤，避免重建整個任務列表
    - 使用精確的 DOM 選擇器，避免誤更新其他 UI 元素
    - 實作任務狀態變更的差異檢測機制
  - **DOM 選擇器精確性**:
    - 避免使用過於寬泛的選擇器 (如 `.level-item .tag`)
    - 為任務狀態元素添加唯一識別屬性 (如 `data-task-id`)
    - 區分頁面統計元素和個別任務狀態元素
  - **使用者體驗優化**:
    - 添加狀態變更動畫效果，提升視覺回饋
    - 實作載入狀態指示器，避免 UI 閃爍
    - 支援平滑的狀態轉換效果
- **驗收標準**:
  - DOM 更新操作不會影響其他 UI 元素的顯示
  - 狀態變更時提供清晰的視覺回饋
  - 頁面更新效能符合即時性要求 (< 100ms)

#### 14.4 通訊系統 ✅
- **Socket.IO API**: SocketAPI 類別統一處理
- **事件處理**: 自動事件監聽和狀態更新

#### 14.5 錯誤處理和同步機制需求 🔧
- **需求**: 建立完善的狀態不一致檢測和修復機制
- **實作狀態**: 需要新增
- **功能範圍**:
  - **狀態驗證機制**:
    - Socket.IO 接收資料時進行狀態格式驗證
    - 檢查狀態 ID 是否在有效範圍內
    - 驗證狀態名稱與 ID 的對應關係
  - **不一致處理策略**:
    - 當前後端狀態不一致時，記錄詳細錯誤日誌
    - 採用資料庫狀態為準的降級策略
    - 提供手動同步修復功能
  - **監控和警報**:
    - 實作狀態不一致的即時監控
    - 當檢測到問題時發送警報通知
    - 提供狀態同步健康檢查工具
- **驗收標準**:
  - 系統能夠自動檢測狀態不一致問題
  - 提供清晰的錯誤訊息和修復建議
  - 不一致問題不會影響系統正常運作
- **錯誤處理**: 完整的錯誤處理和重連機制
- **即時同步**: 操作狀態即時同步到後端

## 🎨 視覺設計需求

### 15. 色彩系統

#### 15.1 AGVCUI 色彩規範 ✅
- **主色調**: Bulma 預設藍色系統 (#3273dc)
- **狀態色彩**:
  - 成功: 綠色 (#48c774)
  - 警告: 橙色 (#ff7f00)
  - 危險: 紅色 (#f14668)
  - 資訊: 藍色 (#3273dc)
- **背景色彩**: 淺色主題配色
- **選中狀態**: 淺綠色背景 (rgba(140, 240, 140, 0.8))

#### 15.2 OPUI 色彩規範 ✅
- **面板配色**:
  - 左面板: #eee (淺灰色)
  - 右面板: #ddd (中灰色)
- **按鈕配色**:
  - 叫車按鈕: is-info (藍色)
  - 派車按鈕: is-warning (橙色)
  - 產品按鈕: is-link is-light (淺藍色)
- **連線狀態**:
  - 已連線: #48c774 (綠色)
  - 已斷線: #f14668 (紅色)

### 16. 字體和圖示

#### 16.1 字體系統 ✅
- **基礎字體**: 系統預設字體
- **字體大小**: 
  - 標題: 1.25rem
  - 按鈕: 1.25rem
  - 輸入框: 1.25rem (OPUI)
- **字體權重**: 標準和粗體變化

#### 16.2 圖示系統 ✅
- **圖示庫**: Material Design Icons (MDI)
- **常用圖示**:
  - 連線狀態: mdi-wifi
  - 使用者: mdi-account, mdi-account-circle
  - 操作: mdi-monitor, mdi-cog, mdi-view-grid
  - 功能: mdi-tag, mdi-check-bold, mdi-tag-plus-outline
  - 系統: mdi-login, mdi-logout, mdi-database

### 17. 響應式設計需求

#### 17.1 AGVCUI 響應式設計 ✅
- **桌面專用**: 專注於桌面環境設計和優化
- **固定佈局**: 針對標準桌面解析度優化 (1920x1080, 1366x768)
- **導航系統**: 標準桌面導航欄設計
- **卡片佈局**: 桌面儀表板卡片網格佈局

#### 17.2 OPUI 響應式設計 ✅
- **固定佈局**: 主要針對固定尺寸觸控螢幕
- **雙面板**: 左右分離的固定佈局
- **按鈕尺寸**: 適合觸控操作的按鈕尺寸
- **字體大小**: 較大的字體便於閱讀

## 🔧 技術需求

### 18. 瀏覽器支援

#### 18.1 支援的瀏覽器 ✅
- **Chrome**: 最新版本 (主要支援)
- **Firefox**: 最新版本
- **Safari**: 最新版本
- **Edge**: 最新版本

#### 18.2 技術標準 ✅
- **HTML5**: 語義化標籤和現代 HTML 特性
- **CSS3**: Flexbox、Grid、動畫和轉場
- **ES6+**: 模組系統、箭頭函數、Promise/async-await
- **WebSocket**: Socket.IO 即時通訊

### 19. 效能需求

#### 19.1 載入效能 ✅
- **首次載入**: < 3 秒 (包含所有資源)
- **頁面切換**: < 1 秒
- **模組載入**: 按需載入，減少初始載入時間
- **資源優化**: CSS/JS 壓縮和快取

#### 19.2 運行效能 ✅
- **即時更新**: Socket.IO 事件處理 < 100ms
- **UI 回應**: 使用者操作回應 < 200ms
- **記憶體使用**: 長時間運行無記憶體洩漏
- **CPU 使用**: 背景任務低 CPU 佔用

### 20. 可用性需求

#### 20.1 易用性 ✅
- **學習曲線**: 新使用者 < 30 分鐘上手
- **操作直觀**: 符合使用者習慣的操作邏輯
- **錯誤處理**: 友善的錯誤訊息和恢復機制
- **幫助系統**: 內建幫助連結和文檔

#### 20.2 可存取性 ✅
- **鍵盤導航**: 完整的鍵盤操作支援
- **螢幕閱讀器**: ARIA 標籤和語義化標籤
- **色彩對比**: 符合 WCAG 2.1 AA 標準
- **字體大小**: 支援瀏覽器字體縮放

---

**最後更新**: 2025-01-23  
**維護責任**: UI/UX 設計師、前端開發工程師  
**版本**: v1.0.0 (基於實際前端程式碼實作)

## 📊 介面功能對比

### 21. AGVCUI vs OPUI 功能差異

#### 21.1 設計理念差異 ✅
- **AGVCUI**:
  - 管理導向的複雜介面
  - 多功能整合的儀表板設計
  - 資訊密度高的專業介面
  - 多層級導航和下拉選單
- **OPUI**:
  - 操作導向的簡潔介面
  - 大按鈕觸控友善設計
  - 直觀的雙面板佈局
  - 扁平化的導航結構

#### 21.2 使用者體驗差異 ✅
- **AGVCUI**:
  - 桌面滑鼠操作優化
  - 複雜資料的表格和圖表顯示
  - 多視窗和模態框互動
  - 專業使用者的高效操作
- **OPUI**:
  - 觸控螢幕操作優化
  - 大尺寸按鈕和清晰標籤
  - 單頁面專注操作
  - 現場操作員的快速操作

#### 21.3 技術架構差異 ✅
- **AGVCUI**:
  - 複雜的模組化載入系統
  - 多 Store 狀態管理
  - 豐富的頁面專用樣式
  - 完整的使用者權限系統
- **OPUI**:
  - 簡化的頁面架構
  - 扁平化的狀態管理
  - 統一的操作介面樣式
  - 設備基礎的授權系統

## 🎯 介面互動流程

### 22. AGVCUI 使用者流程

#### 22.1 管理員登入流程 ✅
1. **存取登入頁面**: 輸入系統 URL
2. **身份驗證**: 輸入用戶名和密碼
3. **Socket.IO 認證**: 即時驗證和 JWT Token 生成
4. **權限檢查**: 根據使用者角色顯示對應功能
5. **儀表板載入**: 自動載入系統儀表板
6. **即時資料同步**: Socket.IO 開始接收即時資料

#### 22.2 車隊監控流程 ✅
1. **地圖查看**: 存取地圖管理頁面
2. **AGV 狀態監控**: 即時查看所有 AGV 位置和狀態
3. **任務管理**: 查看和管理進行中的任務
4. **異常處理**: 處理 AGV 異常和任務失敗
5. **資料分析**: 查看系統日誌和統計資料

#### 22.3 系統管理流程 ✅
1. **使用者管理**: 新增、編輯、刪除使用者帳號
2. **權限配置**: 設定使用者角色和權限
3. **系統配置**: 調整系統參數和設定
4. **資料庫管理**: 存取 pgAdmin4 進行資料庫操作
5. **系統監控**: 監控系統健康狀態和效能

### 23. OPUI 使用者流程

#### 23.1 設備授權流程 ✅
1. **設備識別**: URL 包含 deviceId 參數
2. **授權驗證**: 後端檢查設備授權狀態
3. **頁面載入**: 載入對應的操作介面
4. **Socket.IO 連線**: 建立即時通訊連線
5. **狀態同步**: 同步設備和機台狀態

#### 23.2 AGV 操作流程 ✅
1. **產品選擇**: 選擇當前生產的產品類型
2. **數量設定**: 在數量矩陣中選擇所需數量
3. **叫空車操作**: 點擊叫車按鈕請求空車
4. **等待送達**: 監控任務狀態和 AGV 位置
5. **確認送達**: 確認 AGV 已送達指定位置
6. **派車操作**: 選擇料架並派車到目標位置

#### 23.3 料架管理流程 ✅
1. **查看停靠狀態**: 檢查當前停靠的料架
2. **手動新增料架**: 輸入料架編號並新增
3. **料架分配**: 將料架分配到指定停車格
4. **料架移除**: 刪除不需要的料架分配
5. **狀態同步**: 即時同步料架狀態變更

## 🔍 介面驗收標準

### 24. AGVCUI 驗收標準

#### 24.1 功能驗收 ✅
- **登入功能**: 支援正確的使用者認證和權限檢查
- **導航系統**: 所有導航連結正常工作，下拉選單正確顯示
- **儀表板**: 即時顯示系統狀態和關鍵指標
- **管理功能**: 所有 CRUD 操作正常工作
- **即時更新**: Socket.IO 資料同步正常，延遲 < 100ms

#### 24.2 介面驗收 ✅
- **桌面顯示**: 在標準桌面解析度下正常顯示
- **瀏覽器相容**: 在主流瀏覽器中一致顯示
- **載入效能**: 首次載入時間 < 3 秒
- **操作回應**: 使用者操作回應時間 < 200ms
- **錯誤處理**: 友善的錯誤訊息和恢復機制

#### 24.3 可用性驗收 ✅
- **學習曲線**: 新使用者 30 分鐘內掌握基本操作
- **操作效率**: 熟練使用者完成常見任務時間 < 2 分鐘
- **錯誤率**: 使用者操作錯誤率 < 5%
- **滿意度**: 使用者滿意度評分 > 4.0/5.0

### 25. OPUI 驗收標準

#### 25.1 功能驗收 ✅
- **設備授權**: 正確的 deviceId 驗證和授權檢查
- **AGV 操作**: 叫車、派車、取消等操作正常工作
- **產品配置**: 產品選擇和數量設定正確同步
- **料架管理**: 料架新增、刪除、分配功能正常
- **即時狀態**: 任務狀態和 AGV 位置即時更新

#### 25.2 介面驗收 ✅
- **觸控友善**: 按鈕尺寸適合觸控操作 (最小 44px)
- **視覺清晰**: 在工業環境下清晰可見
- **操作直觀**: 符合現場操作員的使用習慣
- **狀態明確**: 系統狀態和操作結果清楚顯示
- **錯誤處理**: 操作錯誤時提供明確的錯誤訊息

#### 25.3 可用性驗收 ✅
- **學習曲線**: 新操作員 15 分鐘內掌握基本操作
- **操作效率**: 完成一次完整的 AGV 操作 < 30 秒
- **錯誤率**: 操作錯誤率 < 2%
- **可靠性**: 連續運行 8 小時無介面問題

## 📋 相關文檔

- [功能需求規格](./functional-requirements.md)
- [非功能性需求](./non-functional-requirements.md)
- [業務流程規範](./business-processes.md)
- [整合需求規範](./integration-requirements.md)
- [Web API 技術規格](../specifications/web-api-specification.md)
- [資料格式規格](../specifications/data-formats.md)

---

**最後更新**: 2025-01-23
**變更記錄**: 移除 AGVCUI 平板設備支援，專注於桌面環境
**版本**: v1.1.0
