---
type: "manual"
---

# RosAGV 專案程式碼開發與文檔同步標準作業流程

## 🎯 核心原則
1. **文檔優先**: 編輯程式碼前必須先理解相關的 README.md 文檔
2. **同步更新**: 程式碼變更完成後必須評估並更新相關文檔
3. **一致性維護**: 確保所有變更符合 RosAGV 專案的文檔標準
4. **可追溯性**: 記錄變更原因和影響範圍
5. **真實性**: 使用 codebase-retrieval 工具分析 確認程式碼真實存在
## 🔄 標準作業流程

### 階段 1: 程式碼編輯前的準備工作

#### 1.1 必要的文檔閱讀 (強制性)
- [ ] 閱讀目標工作空間的 README.md 檔案
- [ ] 理解專案架構和系統定位
- [ ] 確認依賴關係和啟動狀態
- [ ] 檢查虛擬環境套件使用情況
- [ ] 了解特殊開發指導或注意事項

#### 1.2 README.md 關鍵章節分析
**必須重點關注的章節**:

1. **📋 基本資訊**
   - 啟動狀態 (✅/⚠️/❌)
   - 運行環境 (🚗/🖥️/🚗🖥️)
   - 依賴狀態 (特別注意虛擬環境套件)

2. **🔗 依賴關係**
   - 虛擬環境套件依賴
   - 系統套件依賴
   - 工作空間依賴關係
   - 外部依賴

3. **🏗️ 專案結構**
   - 檔案組織方式
   - 重要模組位置
   - 棄用檔案標記

4. **⚙️ 主要功能**
   - 核心功能模組
   - 棄用功能標記
   - 架構變更說明

#### 1.3 程式碼角色確認
- 目標程式碼在整體系統中的角色
- 與其他工作空間的整合關係
- 是否使用虛擬環境套件
- 是否為核心功能或輔助功能
- 是否有特殊的啟動或配置要求

#### 1.4 風險評估
- 變更可能影響的其他模組
- 是否會影響啟動流程
- 是否會改變依賴關係
- 是否會影響虛擬環境套件使用
- 是否會影響 API 介面

### 階段 2: 程式碼測試前的準備工作

#### 2.1 測試方法章節研讀 (強制性)
- [ ] 閱讀 🧪 測試方法章節
- [ ] 了解建置流程和依賴檢查
- [ ] 確認虛擬環境套件測試方法
- [ ] 檢查功能測試步驟
- [ ] 研讀故障排除指南

#### 2.2 測試環境準備
**標準步驟**:

1. **建置流程確認**
   ```bash
   cd /app/[workspace_name]
   colcon build
   source install/setup.bash
   ```

2. **虛擬環境套件檢查** (如適用)
   ```bash
   /opt/pyvenv_env/bin/pip3 list | grep [package_name]
   python3 -c "import [package_name]; print('✅ 套件可用')"
   ```

3. **依賴檢查**
   ```bash
   python3 -c "from [dependency].[module] import [class]; print('✅ 依賴正常')"
   ```

#### 2.3 預防性故障排除
- 檢查常見問題的預防措施
- 準備診斷工具和指令
- 確認解決方案的可用性

### 階段 3: 編輯和測試完成後的文檔更新

#### 3.1 變更影響評估 (強制性)
- [ ] 是否新增或移除了虛擬環境套件依賴？
- [ ] 是否改變了啟動方式或配置？
- [ ] 是否修改了 API 介面或使用方法？
- [ ] 是否新增了新的功能模組？
- [ ] 是否棄用了現有功能？
- [ ] 是否改變了與其他工作空間的整合方式？
- [ ] 是否新增了配置檔案或參數？
- [ ] 是否發現了新的故障排除方案？

#### 3.2 README.md 更新判斷標準

**必須更新的情況**:
1. **依賴關係變更**
   - 新增虛擬環境套件依賴
   - 移除或替換依賴套件
   - 改變工作空間依賴關係

2. **功能變更**
   - 新增核心功能模組
   - 棄用現有功能
   - 修改主要 API 介面

3. **啟動配置變更**
   - 改變啟動方式
   - 新增配置參數
   - 修改預設值

4. **架構變更**
   - 檔案結構調整
   - 模組重組
   - 通訊協定變更

**可選更新的情況**:
- 效能最佳化 (不影響介面)
- 程式碼重構 (不影響功能)
- 註解和文檔改善
- 測試案例新增

#### 3.3 具體更新指導

**依賴關係章節更新**:
```markdown
### 虛擬環境套件依賴
- **新套件名稱**: 功能說明和用途
- ~~**已移除套件**: 移除原因~~ ❌ **已移除**
```

**專案結構章節更新**:
```markdown
│   ├── new_module.py          # 新增模組 (使用虛擬環境 package_name)
│   ├── ~~deprecated.py~~      # ❌ 已棄用：原因說明
```

**主要功能章節更新**:
```markdown
### X. 新功能模組 (如適用)
**功能描述**:
- **子功能**: 詳細說明 (使用虛擬環境 package_name)

### X. ~~已棄用功能~~ ❌ **已棄用**
~~**功能描述**: 棄用原因和替代方案~~
```

**核心 API 章節更新**:
```python
# 新增 API 範例
from package.new_module import NewClass
# 使用虛擬環境套件 (如適用)
# 注意：此功能使用虛擬環境套件 package_name
instance = NewClass()
```

**使用方法章節更新**:
```bash
# 新增虛擬環境套件檢查 (如適用)
/opt/pyvenv_env/bin/pip3 list | grep new_package
# 新增啟動方法 (如適用)
start_new_service
```

**測試方法章節更新**:
```bash
# 新增功能測試
python3 -c "
from package.new_module import NewClass
# 測試程式碼
print('✅ 新功能測試通過')
"
```

**故障排除章節更新**:
```markdown
#### X. 新問題類型 (如適用)
**症狀**: 具體症狀描述
**解決方法**:
```bash
# 診斷指令
diagnostic_command
# 解決方案
solution_command
```
```

## 📋 文檔更新檢查清單

### 更新前檢查
- [ ] 確認變更的具體內容和範圍
- [ ] 識別受影響的 README.md 章節
- [ ] 檢查是否需要更新多個工作空間的文檔
- [ ] 確認新增內容符合專案標準

### 更新中檢查
- [ ] 使用正確的狀態標記 (✅/⚠️/❌)
- [ ] 標註虛擬環境套件使用
- [ ] 標記棄用功能 (~~刪除線~~ ❌)
- [ ] 提供可執行的程式碼範例
- [ ] 更新相關的交叉引用

### 更新後檢查
- [ ] 驗證所有程式碼範例可執行
- [ ] 檢查格式一致性
- [ ] 確認技術資訊準確性
- [ ] 驗證與其他文檔的一致性

## 🔍 特殊情況處理指導

### 虛擬環境套件相關變更
**新增虛擬環境套件**:
1. 更新依賴關係章節
2. 在專案結構中標註使用位置
3. 在主要功能中說明用途
4. 新增虛擬環境套件測試方法
5. 新增相關故障排除方案

**移除虛擬環境套件**:
1. 標記為已移除 (~~刪除線~~ ❌)
2. 說明移除原因
3. 提供替代方案 (如有)
4. 更新測試方法
5. 更新故障排除指南

### 啟動狀態變更
**從手動啟動改為自動啟動**:
1. 更新基本資訊中的啟動狀態
2. 修改使用方法章節
3. 更新測試流程
4. 調整故障排除指南

**從自動啟動改為手動啟動**:
1. 更新啟動狀態標記
2. 新增手動啟動方法
3. 說明變更原因
4. 提供啟動檢查步驟

### 架構重大變更
**功能遷移** (如 MQTT → Web API):
1. 新增架構變更說明章節
2. 標記舊功能為已棄用
3. 說明新架構的優勢
4. 提供遷移指導
5. 更新所有相關章節

## 💡 實際操作範例

### 範例 1: 新增虛擬環境套件依賴
**情境**: 在 `web_api_ws` 中新增 `redis` 套件用於快取

**操作步驟**:
1. **編輯前準備**:
   - 閱讀 web_api_ws/README.md
   - 重點關注：依賴關係、專案結構、主要功能

2. **程式碼變更**:
   ```python
   # 在 web_api_ws/src/web_api/web_api/cache_manager.py 中
   import redis  # 新增虛擬環境套件
   ```

3. **文檔更新**:
   ```markdown
   ### 虛擬環境套件依賴
   - **redis**: Redis 客戶端庫，用於資料快取和會話管理

   ### 專案結構
   │   ├── cache_manager.py       # 快取管理器 (使用虛擬環境 redis)

   ### 主要功能
   ### 4. 快取管理系統 (cache_manager.py) - 使用虛擬環境 redis

   ### 虛擬環境套件測試
   /opt/pyvenv_env/bin/pip3 list | grep redis
   python3 -c "import redis; print('✅ redis 可用')"
   ```

### 範例 2: 功能棄用處理
**情境**: 在 `ecs_ws` 中棄用 MQTT 門控制功能

**操作步驟**:
1. **標記棄用檔案**:
   ```markdown
   │   ├── ~~door_controller_node_mqtt.py~~ # ❌ 已棄用：MQTT 門控制節點
   ```

2. **更新主要功能**:
   ```markdown
   ### 2. ~~MQTT 門控制系統~~ ❌ **已棄用**
   ~~**door_controller_node_mqtt.py** - 使用虛擬環境 paho-mqtt~~

   **棄用原因**: MQTT 門控制已全面改用 Web API 架構
   **新架構**: 門控制功能已移至 **web_api_ws** 專案
   ```

3. **新增架構變更說明**:
   ```markdown
   ## 🔄 架構變更說明

   ### MQTT → Web API 遷移
   **舊架構** (已棄用):
   - KUKA ECS 系統 → MQTT Broker → door_controller_node_mqtt.py → PLC

   **新架構** (目前):
   - KUKA ECS 系統 → HTTP API (web_api_ws) → door_logic.py → PLC
   ```

### 範例 3: 啟動狀態變更
**情境**: `db_proxy_ws` 從手動啟動改為自動啟動

**操作步驟**:
1. **更新基本資訊**:
   ```markdown
   **啟動狀態**: ✅ 實際啟動 (AGVC 管理系統中自動載入)  # 從 ⚠️ 手動啟動 改為 ✅
   ```

2. **更新使用方法**:
   ```markdown
   ### 4. 啟動資料庫服務 (自動啟動)
   # 服務已自動啟動，檢查狀態
   ros2 service list | grep sql_query
   # 如需手動重啟
   restart_db_proxy
   ```

3. **更新測試方法**:
   ```markdown
   ### 3. 服務狀態檢查
   # 檢查自動啟動的服務
   ros2 node list | grep agvc_database
   ros2 service call /agvc/sql_query db_proxy_interfaces/srv/SqlQuery "{query_string: 'SELECT 1'}"
   ```

## 📚 參考資源

### 相關規則文檔
- `.augment/rules/update-readme.md` - README.md 標準化更新規則
- `.augment/rules/readme-template.md` - README.md 快速參考模板

### 優秀範例參考
- **`db_proxy_ws/README.md`** - 虛擬環境套件使用典範
  - 完整的依賴關係說明
  - 詳細的虛擬環境套件測試方法
  - 實用的故障排除指南

- **`ecs_ws/README.md`** - 架構變更說明典範
  - 功能棄用標記方式
  - 架構變更說明章節
  - 新舊架構對比說明

- **`agv_ws/README.md`** - 複雜系統文檔典範
  - 多層次功能說明
  - 詳細的啟動配置
  - 完整的訊息介面定義

### 工作空間分類參考
**虛擬環境套件使用工作空間**:
- `db_proxy_ws` - sqlalchemy, psycopg2, sqlmodel
- `path_algorithm` - networkx
- `web_api_ws` - fastapi, uvicorn, sqlalchemy
- `ecs_ws` - ~~paho-mqtt~~ (已棄用)

**系統套件使用工作空間**:
- `keyence_plc_ws` - 純 Python 標準庫和 ROS 2
- `plc_proxy_ws` - ROS 2 和 keyence_plc 依賴
- `agv_cmd_service_ws` - ROS 2 和 plc_proxy 依賴
- `joystick_ws` - ROS 2 joy_linux

## 🎯 成功標準

### 文檔同步成功的指標
- [ ] 所有程式碼變更都有對應的文檔更新
- [ ] 虛擬環境套件使用正確標記
- [ ] 啟動狀態與實際情況一致
- [ ] API 範例可以實際執行
- [ ] 測試方法有效且完整
- [ ] 故障排除指南實用

### 品質檢查通過標準
- [ ] 技術資訊準確無誤
- [ ] 格式符合專案標準
- [ ] 與其他文檔保持一致
- [ ] 交叉引用正確有效
- [ ] 可讀性和可維護性良好

---

**版本**: v1.0 | **更新**: 2025-01-17 | **範圍**: RosAGV 專案所有程式碼開發工作
