<style>
    .is-connected {
        color: lightgreen;
    }

    .is-disconnected {
        color: coral;
    }

    .navbar {
        flex-wrap: nowrap;
        overflow-x: auto;
        position: relative;
    }

    .navbar-menu {
        display: flex !important;
        flex-grow: 1;
        align-items: center;
        justify-content: space-between;
        flex-wrap: nowrap;
    }

    .navbar-brand,
    .navbar-start,
    .navbar-end {
        display: flex;
        align-items: center;
        flex-wrap: nowrap;
    }

    /* ä¸­é–“ç½®ä¸­çš„æ©Ÿå™¨ç·¨è™Ÿ */
    .is-absolute-center {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        top: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        pointer-events: none;
    }

    /* OP-UI å“ç‰Œåœ–ç¤ºæ¨£å¼ */
    .navbar-brand-icon {
        width: 24px;
        height: 24px;
        margin-right: 8px;
        vertical-align: middle;
    }

    /* Active ç‹€æ…‹æ¨£å¼ */
    .navbar-item.is-active {
        background-color: rgba(255, 255, 255, 0.1) !important;
        color: #ffffff !important;
        border-bottom: 2px solid #3273dc;
    }

    .navbar-item.is-active:hover {
        background-color: rgba(255, 255, 255, 0.15) !important;
        color: #ffffff !important;
    }

    /* å°èˆªé …ç›®é–“è·èª¿æ•´ */
    .navbar-item {
        transition: all 0.2s ease;
    }

    .navbar-item:hover {
        background-color: rgba(255, 255, 255, 0.05);
    }

    /* åœ–ç¤ºèˆ‡æ–‡å­—é–“è· */
    .navbar-item .mdi {
        margin-right: 6px;
    }
</style>
<nav class="navbar is-black has-shadow" role="navigation" aria-label="main navigation">
    <!-- ğŸ”§ åŠ å…¥ navbar-menu æ‰èƒ½ override æˆæ°´å¹³ -->
    <div class="navbar-menu is-active">
        <div class="navbar-start">
            <a class="navbar-item" href="/home?deviceId={{ device_id }}">
                <img src="/static/favicon.png" alt="OP-UI" class="navbar-brand-icon">
            </a>
            <a class="navbar-item nav-link" href="/home?deviceId={{ device_id }}" data-page="home">
                <span class="mdi mdi-monitor"></span>
                <span>æ“ä½œ</span>
            </a>
            <a class="navbar-item nav-link" href="/setting?deviceId={{ device_id }}" data-page="setting">
                <span class="mdi mdi-cog"></span>
                <span>è¨­å®š</span>
            </a>
            <a class="navbar-item nav-link" href="/rack?deviceId={{ device_id }}" data-page="rack">
                <span class="mdi mdi-view-grid"></span>
                <span>æ–™æ¶</span>
            </a>
        </div>

        <!-- çµ•å°ç½®ä¸­çš„æ©Ÿå™¨ç·¨è™Ÿ -->
        <div class="navbar-item is-absolute-center">
            <span class="has-text-white has-text-weight-bold" id="nav-machine-number"> </span>
        </div>

        <div class="navbar-end">
            <a class="navbar-item"> 
                <span class="mdi mdi-wifi is-disconnected"></span>
            </a>
        </div>
    </div>
</nav>

<script>
    // è¨­å‚™æˆæ¬Šå°èˆªé€£çµè™•ç†å’Œ Active ç‹€æ…‹ç®¡ç†
    document.addEventListener('DOMContentLoaded', function () {
        // å¾ç•¶å‰ URL ç²å– deviceId åƒæ•¸
        const urlParams = new URLSearchParams(window.location.search);
        const deviceId = urlParams.get('deviceId');

        if (deviceId) {
            // æ›´æ–°æ‰€æœ‰å°èˆªé€£çµï¼Œæ·»åŠ  deviceId åƒæ•¸
            const navLinks = document.querySelectorAll('.navbar-link');
            navLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (href && !href.includes('deviceId=')) {
                    const separator = href.includes('?') ? '&' : '?';
                    link.setAttribute('href', href + separator + 'deviceId=' + encodeURIComponent(deviceId));
                }
            });
        }

        // è¨­å®š Active ç‹€æ…‹
        setActiveNavItem();
    });

    /**
     * æ ¹æ“šç•¶å‰é é¢è·¯å¾‘è¨­å®šå°æ‡‰å°èˆªé …ç›®çš„ active ç‹€æ…‹
     */
    function setActiveNavItem() {
        // ç§»é™¤æ‰€æœ‰å°èˆªé …ç›®çš„ active ç‹€æ…‹
        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
            link.classList.remove('is-active');
        });

        // æ ¹æ“šç•¶å‰è·¯å¾‘ç¢ºå®šé é¢é¡å‹
        const currentPath = window.location.pathname;
        let currentPage = 'home'; // é è¨­ç‚º home

        if (currentPath.includes('/setting')) {
            currentPage = 'setting';
        } else if (currentPath.includes('/rack')) {
            currentPage = 'rack';
        } else if (currentPath.includes('/home') || currentPath === '/') {
            currentPage = 'home';
        }

        // ç‚ºå°æ‡‰çš„å°èˆªé …ç›®æ·»åŠ  active ç‹€æ…‹
        const activeNavItem = document.querySelector(`.nav-link[data-page="${currentPage}"]`);
        if (activeNavItem) {
            activeNavItem.classList.add('is-active');
        }

        // åœ¨æ§åˆ¶å°è¼¸å‡ºç•¶å‰é é¢è³‡è¨Šï¼ˆç”¨æ–¼é™¤éŒ¯ï¼‰
        //console.log(`ğŸ”— ç•¶å‰é é¢: ${currentPage}, è·¯å¾‘: ${currentPath}`);
    }

    /**
     * ç•¶é é¢è·¯å¾‘æ”¹è®Šæ™‚æ›´æ–° active ç‹€æ…‹ï¼ˆç”¨æ–¼ SPA å°èˆªï¼‰
     */
    function updateActiveNavItem() {
        setActiveNavItem();
    }

    // ç›£è½ popstate äº‹ä»¶ï¼ˆç€è¦½å™¨å‰é€²/å¾Œé€€æŒ‰éˆ•ï¼‰
    window.addEventListener('popstate', function() {
        setTimeout(setActiveNavItem, 100); // å»¶é²ä¸€é»ç¢ºä¿è·¯å¾‘å·²æ›´æ–°
    });

    // ç‚ºå°èˆªé€£çµæ·»åŠ é»æ“Šäº‹ä»¶ç›£è½å™¨
    document.addEventListener('click', function(e) {
        if (e.target.closest('.nav-link')) {
            // å»¶é²æ›´æ–° active ç‹€æ…‹ï¼Œç¢ºä¿é é¢å°èˆªå®Œæˆ
            setTimeout(setActiveNavItem, 100);
        }
    });
</script>
