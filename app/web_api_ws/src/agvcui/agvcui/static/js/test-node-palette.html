<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow Designer ç¯€é»é¸æ¿æ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .node-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .node-item {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            color: white;
            display: flex;
            align-items: center;
        }
        .node-icon {
            margin-right: 8px;
        }
        #test-log {
            background: #2d2d2d;
            color: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Flow Designer ç¯€é»é¸æ¿æ¸¬è©¦</h1>
        <p>æ­¤é é¢ç”¨æ–¼æ¸¬è©¦ Flow Designer ç¯€é»é¸æ¿é¡¯ç¤ºä¿®å¾©çš„æ•ˆæœ</p>
        
        <div class="test-section">
            <div class="test-title">1. ä¾è³´æª¢æŸ¥</div>
            <div id="dependency-results"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">2. ç¯€é»é¡å‹è¼‰å…¥æ¸¬è©¦</div>
            <div id="node-loading-results"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">3. ç¯€é»åˆ†é¡çµ±è¨ˆ</div>
            <div id="node-stats-results"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">4. ç¯€é»åˆ—è¡¨</div>
            <div id="node-list-results"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">5. æ¸¬è©¦æ—¥èªŒ</div>
            <div id="test-log"></div>
        </div>
    </div>

    <!-- è¼‰å…¥ä¾è³´ -->
    <script src="/static/js/flow-designer/node-types.js?v=3.1.0"></script>
    
    <script>
        // æ¸¬è©¦æ—¥èªŒå‡½æ•¸
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEl = document.getElementById('test-log');
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            logEl.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        // æ·»åŠ çµæœåˆ°æ¸¬è©¦å€åŸŸ
        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }
        
        // é–‹å§‹æ¸¬è©¦
        function runTests() {
            log('ğŸš€ é–‹å§‹ Flow Designer ç¯€é»é¸æ¿æ¸¬è©¦...');
            
            // 1. ä¾è³´æª¢æŸ¥
            log('1ï¸âƒ£ æª¢æŸ¥ä¾è³´...');
            
            if (typeof window.FlowDesigner !== 'undefined') {
                addResult('dependency-results', 'âœ… window.FlowDesigner å·²è¼‰å…¥', 'success');
                log('window.FlowDesigner å·²è¼‰å…¥', 'success');
                
                // æª¢æŸ¥å„å€‹ç¯€é»é¡å‹
                const nodeTypes = ['CONDITION_NODES', 'LOGIC_NODES', 'ACTION_NODES', 'SCRIPT_NODES'];
                nodeTypes.forEach(type => {
                    if (window.FlowDesigner[type]) {
                        const count = Object.keys(window.FlowDesigner[type]).length;
                        addResult('dependency-results', `âœ… ${type}: ${count} å€‹ç¯€é»`, 'success');
                        log(`${type}: ${count} å€‹ç¯€é»`, 'success');
                    } else {
                        addResult('dependency-results', `âŒ ${type}: æœªæ‰¾åˆ°`, 'error');
                        log(`${type}: æœªæ‰¾åˆ°`, 'error');
                    }
                });
                
            } else {
                addResult('dependency-results', 'âŒ window.FlowDesigner æœªè¼‰å…¥', 'error');
                log('window.FlowDesigner æœªè¼‰å…¥', 'error');
                return;
            }
            
            // 2. ç¯€é»é¡å‹è¼‰å…¥æ¸¬è©¦
            log('2ï¸âƒ£ æ¸¬è©¦ç¯€é»é¡å‹è¼‰å…¥...');
            
            try {
                // æ¨¡æ“¬ Flow Designer çš„è¼‰å…¥é‚è¼¯
                const nodeTypes = {
                    ...window.FlowDesigner.CONDITION_NODES,
                    ...window.FlowDesigner.LOGIC_NODES,
                    ...window.FlowDesigner.ACTION_NODES,
                    ...window.FlowDesigner.SCRIPT_NODES
                };
                
                const totalNodes = Object.keys(nodeTypes).length;
                addResult('node-loading-results', `âœ… æˆåŠŸè¼‰å…¥ ${totalNodes} å€‹ç¯€é»é¡å‹`, 'success');
                log(`æˆåŠŸè¼‰å…¥ ${totalNodes} å€‹ç¯€é»é¡å‹`, 'success');
                
                // æª¢æŸ¥ç¯€é»çµæ§‹
                const firstNode = Object.values(nodeTypes)[0];
                if (firstNode && firstNode.name && firstNode.category) {
                    addResult('node-loading-results', 'âœ… ç¯€é»çµæ§‹æ­£ç¢º (åŒ…å« name, category)', 'success');
                    log('ç¯€é»çµæ§‹æ­£ç¢º', 'success');
                } else {
                    addResult('node-loading-results', 'âŒ ç¯€é»çµæ§‹ä¸å®Œæ•´', 'error');
                    log('ç¯€é»çµæ§‹ä¸å®Œæ•´', 'error');
                }
                
            } catch (error) {
                addResult('node-loading-results', `âŒ è¼‰å…¥å¤±æ•—: ${error.message}`, 'error');
                log(`è¼‰å…¥å¤±æ•—: ${error.message}`, 'error');
            }
            
            // 3. ç¯€é»åˆ†é¡çµ±è¨ˆ
            log('3ï¸âƒ£ çµ±è¨ˆç¯€é»åˆ†é¡...');
            
            const categories = {
                condition: 0,
                logic: 0,
                action: 0,
                script: 0
            };
            
            // çµ±è¨ˆå„é¡åˆ¥ç¯€é»æ•¸é‡
            Object.values({
                ...window.FlowDesigner.CONDITION_NODES,
                ...window.FlowDesigner.LOGIC_NODES,
                ...window.FlowDesigner.ACTION_NODES,
                ...window.FlowDesigner.SCRIPT_NODES
            }).forEach(node => {
                const category = node.category;
                if (categories.hasOwnProperty(category)) {
                    categories[category]++;
                }
            });
            
            Object.entries(categories).forEach(([category, count]) => {
                const categoryName = {
                    condition: 'æ¢ä»¶ç¯€é»',
                    logic: 'é‚è¼¯ç¯€é»', 
                    action: 'å‹•ä½œç¯€é»',
                    script: 'è…³æœ¬ç¯€é»'
                }[category];
                
                if (count > 0) {
                    addResult('node-stats-results', `âœ… ${categoryName}: ${count} å€‹`, 'success');
                    log(`${categoryName}: ${count} å€‹`, 'success');
                } else {
                    addResult('node-stats-results', `âš ï¸ ${categoryName}: 0 å€‹`, 'info');
                    log(`${categoryName}: 0 å€‹`, 'info');
                }
            });
            
            // 4. ç¯€é»åˆ—è¡¨é¡¯ç¤º
            log('4ï¸âƒ£ ç”Ÿæˆç¯€é»åˆ—è¡¨...');
            
            const nodeListContainer = document.getElementById('node-list-results');
            const nodeListDiv = document.createElement('div');
            nodeListDiv.className = 'node-list';
            
            Object.entries({
                ...window.FlowDesigner.CONDITION_NODES,
                ...window.FlowDesigner.LOGIC_NODES,
                ...window.FlowDesigner.ACTION_NODES,
                ...window.FlowDesigner.SCRIPT_NODES
            }).forEach(([nodeId, nodeType]) => {
                const nodeItem = document.createElement('div');
                nodeItem.className = 'node-item';
                nodeItem.style.backgroundColor = nodeType.color || '#666';
                nodeItem.innerHTML = `
                    <span class="node-icon">${nodeType.icon || 'â“'}</span>
                    <div>
                        <div style="font-weight: bold;">${nodeType.name || nodeId}</div>
                        <div style="font-size: 10px; opacity: 0.8;">${nodeType.category} | ${nodeType.source || 'unknown'}</div>
                    </div>
                `;
                nodeListDiv.appendChild(nodeItem);
            });
            
            nodeListContainer.appendChild(nodeListDiv);
            log('ç¯€é»åˆ—è¡¨ç”Ÿæˆå®Œæˆ', 'success');
            
            log('ğŸ‰ æ¸¬è©¦å®Œæˆï¼');
        }
        
        // é é¢è¼‰å…¥å¾ŒåŸ·è¡Œæ¸¬è©¦
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runTests, 100); // ç¨å¾®å»¶é²ä»¥ç¢ºä¿æ‰€æœ‰è…³æœ¬è¼‰å…¥å®Œæˆ
        });
    </script>
</body>
</html>