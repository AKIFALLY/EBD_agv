<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·©å­˜é©—è­‰å·¥å…·</title>
    <link rel="stylesheet" href="/static/css/bulma_1_0_4.min.css" />
    <link rel="stylesheet" href="/static/css/materialdesignicons.min.css" />
    <link rel="stylesheet" href="/static/css/agvcui-bulma-extend.css" />
    <link rel="stylesheet" href="/static/css/mapPage.css?v=<?php echo time(); ?>" />
    <style>
        .test-container {
            padding: 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #dbdbdb;
            border-radius: 6px;
        }
        .result {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 4px;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="title">ç·©å­˜é©—è­‰å·¥å…·</h1>
        
        <div class="test-section">
            <h2 class="subtitle">æª¢æŸ¥æ§åˆ¶</h2>
            <div class="buttons">
                <button class="button is-primary" onclick="checkCSSUpdates()">ğŸ” æª¢æŸ¥ CSS æ›´æ–°</button>
                <button class="button is-info" onclick="checkJSUpdates()">ğŸ“œ æª¢æŸ¥ JS æ›´æ–°</button>
                <button class="button is-success" onclick="testRackButton()">ğŸ§ª æ¸¬è©¦è²¨æ¶æŒ‰éˆ•</button>
                <button class="button is-warning" onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤ç·©å­˜æŒ‡å¼•</button>
            </div>
        </div>

        <div class="test-section">
            <h2 class="subtitle">æª¢æŸ¥çµæœ</h2>
            <div id="results"></div>
        </div>

        <div class="test-section">
            <h2 class="subtitle">å¯¦éš›æ¸¬è©¦</h2>
            <div style="position: relative; height: 150px; background: #e8e8e8; border: 1px solid #ccc; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                <div class="rack">
                    <!-- è©³ç´°é¡¯ç¤º -->
                    <div class="rack-static">
                        <!-- åˆ‡æ›æŒ‰éˆ• - è©³ç´°æ¨¡å¼ -->
                        <div class="rack-toggle-btn" title="åˆ‡æ›é¡¯ç¤ºæ¨¡å¼" onclick="buttonClicked()">
                            â‡„
                        </div>
                        
                        <div class="rack-label has-radius-top-left has-radius-top-right span3">
                            <span class="product-name">æ¸¬è©¦</span>
                        </div>
                        <div class="rack-label has-radius-bottom-left">
                            <span class="size">å¤§</span>
                        </div>
                        <div class="rack-label has-radius-bottom-right span2">
                            <span class="count">3</span>
                            <span class="slash">/</span>
                            <span class="total">5</span>
                        </div>
                        <div class="rack-title has-radius-top-left has-radius-top-right span3">
                            <span class="rack-name">ç·©å­˜æ¸¬è©¦</span>
                        </div>
                    </div>
                </div>
            </div>
            <p class="help">å¦‚æœæ‚¨èƒ½çœ‹åˆ°å³ä¸Šè§’çš„è—è‰²åœ“å½¢ â‡„ æŒ‰éˆ•ï¼Œèªªæ˜ CSS å·²æ›´æ–°</p>
        </div>
    </div>

    <script>
        function addResult(type, title, message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${title}</strong><br>${message}`;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function checkCSSUpdates() {
            clearResults();
            addResult('info', 'æª¢æŸ¥é–‹å§‹', 'æ­£åœ¨æª¢æŸ¥ CSS æ›´æ–°...');

            // æª¢æŸ¥ .rack-toggle-btn æ¨£å¼
            const testElement = document.createElement('div');
            testElement.className = 'rack-toggle-btn';
            testElement.style.position = 'absolute';
            testElement.style.top = '-1000px';
            document.body.appendChild(testElement);

            const styles = getComputedStyle(testElement);
            
            // æª¢æŸ¥é—œéµæ¨£å¼æ˜¯å¦å·²æ›´æ–°
            const checks = [
                {
                    name: 'z-index',
                    actual: styles.zIndex,
                    expected: '50',
                    description: 'æª¢æŸ¥ z-index æ˜¯å¦å·²æ›´æ–°ç‚º 50'
                },
                {
                    name: 'display',
                    actual: styles.display,
                    expected: 'flex',
                    description: 'æª¢æŸ¥ display å±¬æ€§'
                },
                {
                    name: 'position',
                    actual: styles.position,
                    expected: 'absolute',
                    description: 'æª¢æŸ¥ position å±¬æ€§'
                },
                {
                    name: 'width',
                    actual: styles.width,
                    expected: '20px',
                    description: 'æª¢æŸ¥å¯¬åº¦'
                },
                {
                    name: 'height',
                    actual: styles.height,
                    expected: '20px',
                    description: 'æª¢æŸ¥é«˜åº¦'
                }
            ];

            let updatedCount = 0;
            checks.forEach(check => {
                const passed = check.actual === check.expected;
                if (passed) updatedCount++;
                
                addResult(
                    passed ? 'success' : 'error',
                    `CSS ${check.name}`,
                    `${check.description}<br>å¯¦éš›å€¼: ${check.actual}, æœŸæœ›å€¼: ${check.expected}`
                );
            });

            document.body.removeChild(testElement);

            // ç¸½çµ
            if (updatedCount === checks.length) {
                addResult('success', 'CSS æª¢æŸ¥å®Œæˆ', 'âœ… æ‰€æœ‰ CSS æ¨£å¼å·²æ­£ç¢ºæ›´æ–°ï¼');
            } else {
                addResult('error', 'CSS æª¢æŸ¥å®Œæˆ', `âŒ ${checks.length - updatedCount} å€‹æ¨£å¼æœªæ›´æ–°ï¼Œè«‹æ¸…é™¤ç€è¦½å™¨ç·©å­˜`);
            }
        }

        function checkJSUpdates() {
            addResult('info', 'JS æª¢æŸ¥', 'æª¢æŸ¥ RackInfoObject æ˜¯å¦å·²æ›´æ–°...');
            
            // æª¢æŸ¥æ˜¯å¦èƒ½è¼‰å…¥ RackInfoObject
            import('/static/objects/RackInfoObject.js')
                .then(module => {
                    addResult('success', 'JS æ¨¡çµ„è¼‰å…¥', 'âœ… RackInfoObject æ¨¡çµ„è¼‰å…¥æˆåŠŸ');
                    
                    // æª¢æŸ¥æ¨¡çµ„å…§å®¹ï¼ˆé€™è£¡åªèƒ½åšåŸºæœ¬æª¢æŸ¥ï¼‰
                    if (module.RackInfoObject) {
                        addResult('success', 'JS é¡åˆ¥', 'âœ… RackInfoObject é¡åˆ¥å­˜åœ¨');
                    } else {
                        addResult('error', 'JS é¡åˆ¥', 'âŒ RackInfoObject é¡åˆ¥ä¸å­˜åœ¨');
                    }
                })
                .catch(error => {
                    addResult('error', 'JS æ¨¡çµ„è¼‰å…¥', `âŒ è¼‰å…¥å¤±æ•—: ${error.message}`);
                });
        }

        function testRackButton() {
            addResult('info', 'æŒ‰éˆ•æ¸¬è©¦', 'æª¢æŸ¥é é¢ä¸­çš„åˆ‡æ›æŒ‰éˆ•...');
            
            const button = document.querySelector('.rack-toggle-btn');
            if (button) {
                const styles = getComputedStyle(button);
                const rect = button.getBoundingClientRect();
                
                addResult('success', 'æŒ‰éˆ•å­˜åœ¨', 'âœ… æ‰¾åˆ°åˆ‡æ›æŒ‰éˆ•');
                addResult('info', 'æŒ‰éˆ•æ¨£å¼', 
                    `display: ${styles.display}<br>` +
                    `visibility: ${styles.visibility}<br>` +
                    `z-index: ${styles.zIndex}<br>` +
                    `ä½ç½®: ${rect.left.toFixed(1)}, ${rect.top.toFixed(1)}<br>` +
                    `å°ºå¯¸: ${rect.width.toFixed(1)} x ${rect.height.toFixed(1)}`
                );
                
                if (rect.width > 0 && rect.height > 0) {
                    addResult('success', 'æŒ‰éˆ•å¯è¦‹æ€§', 'âœ… æŒ‰éˆ•åœ¨é é¢ä¸­å¯è¦‹');
                } else {
                    addResult('error', 'æŒ‰éˆ•å¯è¦‹æ€§', 'âŒ æŒ‰éˆ•ä¸å¯è¦‹ï¼ˆå°ºå¯¸ç‚º 0ï¼‰');
                }
            } else {
                addResult('error', 'æŒ‰éˆ•æ¸¬è©¦', 'âŒ æœªæ‰¾åˆ°åˆ‡æ›æŒ‰éˆ•');
            }
        }

        function clearCache() {
            addResult('warning', 'æ¸…é™¤ç·©å­˜æŒ‡å¼•', 
                'è«‹å˜—è©¦ä»¥ä¸‹æ–¹æ³•æ¸…é™¤ç·©å­˜ï¼š<br>' +
                '1. æŒ‰ Ctrl+F5 (Windows) æˆ– Cmd+Shift+R (Mac)<br>' +
                '2. é–‹å•Ÿé–‹ç™¼è€…å·¥å…· â†’ Network æ¨™ç±¤ â†’ å‹¾é¸ "Disable cache"<br>' +
                '3. å³éµé‡æ–°æ•´ç†æŒ‰éˆ• â†’ "æ¸…ç©ºå¿«å–ä¸¦å¼·åˆ¶é‡æ–°æ•´ç†"<br>' +
                '4. åœ¨ç¶²å€å¾ŒåŠ ä¸Š ?v=' + Date.now()
            );
        }

        function buttonClicked() {
            addResult('success', 'æŒ‰éˆ•é»æ“Š', 'âœ… åˆ‡æ›æŒ‰éˆ•é»æ“ŠæˆåŠŸï¼åŠŸèƒ½æ­£å¸¸');
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            addResult('info', 'é é¢è¼‰å…¥', 'ç·©å­˜é©—è­‰å·¥å…·å·²è¼‰å…¥');
            
            // é¡¯ç¤ºç•¶å‰æ™‚é–“æˆ³ï¼Œå¹«åŠ©åˆ¤æ–·æ˜¯å¦ç‚ºæœ€æ–°ç‰ˆæœ¬
            const timestamp = new Date().toLocaleString();
            addResult('info', 'è¼‰å…¥æ™‚é–“', `é é¢è¼‰å…¥æ™‚é–“: ${timestamp}`);
            
            // è‡ªå‹•åŸ·è¡Œ CSS æª¢æŸ¥
            setTimeout(checkCSSUpdates, 500);
        });
    </script>
</body>
</html>
