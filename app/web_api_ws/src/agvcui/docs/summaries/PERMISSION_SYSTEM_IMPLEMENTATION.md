# ğŸ” æ¬Šé™ç³»çµ±å¯¦ç¾ç¸½çµ

## ğŸ¯ æ–°çš„èªè­‰ç­–ç•¥

æ ¹æ“šæ‚¨çš„éœ€æ±‚ï¼Œæˆ‘å·²ç¶“é‡æ–°è¨­è¨ˆäº†èªè­‰ç³»çµ±ï¼š

### âœ… å·²å¯¦ç¾çš„åŠŸèƒ½

1. **æ‰€æœ‰é é¢éƒ½å¯ä»¥æœªç™»å…¥è¨ªå•**
   - ç§»é™¤äº†é é¢ç´šåˆ¥çš„èªè­‰ä¿è­·
   - ç”¨æˆ¶å¯ä»¥ç€è¦½æ‰€æœ‰åŠŸèƒ½é é¢

2. **ç™»å…¥åªè¨˜éŒ„ç”¨æˆ¶æ¬Šé™**
   - ç”¨æ–¼å¾ŒçºŒçš„æ“ä½œæ¬Šé™æ§åˆ¶
   - ä¸å½±éŸ¿é é¢è¨ªå•

3. **ç®¡ç†å“¡ç”¨æˆ¶ç®¡ç†åŠŸèƒ½**
   - å®Œæ•´çš„ç”¨æˆ¶ CRUD æ“ä½œ
   - åªæœ‰ç®¡ç†å“¡å¯ä»¥è¨ªå•

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æ¬Šé™å±¤ç´š
```
ç®¡ç†å“¡ (admin)    - å®Œæ•´æ¬Šé™ï¼Œå¯ç®¡ç†ç”¨æˆ¶
    â†‘
æ“ä½œå“¡ (operator) - å¯åŸ·è¡Œå‰µå»ºã€ç·¨è¼¯æ“ä½œ
    â†‘
ç”¨æˆ¶ (user)      - åŸºæœ¬æŸ¥çœ‹æ¬Šé™
```

### ä¸­é–“ä»¶æ›´æ–°
```python
# ç¾åœ¨åªæœ‰ç®¡ç†åŠŸèƒ½éœ€è¦èªè­‰
protected_paths = ["/admin", "/users"]

# æ‰€æœ‰å…¶ä»–è·¯å¾‘éƒ½æ˜¯å…¬é–‹çš„
public_paths = [
    "/", "/login", "/logout", "/init-admin", "/static", "/favicon.ico",
    "/map", "/tasks", "/devices", "/signals", "/clients", 
    "/racks", "/products", "/carriers", "/rosout_logs", "/runtime_logs"
]
```

## ğŸ“‹ ç”¨æˆ¶ç®¡ç†åŠŸèƒ½

### 1. ç”¨æˆ¶åˆ—è¡¨ (`/users`)
- âœ… é¡¯ç¤ºæ‰€æœ‰ç”¨æˆ¶
- âœ… ç”¨æˆ¶è§’è‰²æ¨™ç±¤
- âœ… ç”¨æˆ¶ç‹€æ…‹ï¼ˆå•Ÿç”¨/åœç”¨ï¼‰
- âœ… å‰µå»ºæ™‚é–“ã€æœ€å¾Œç™»å…¥æ™‚é–“
- âœ… ç·¨è¼¯ã€åˆªé™¤æ“ä½œ

### 2. å‰µå»ºç”¨æˆ¶ (`/users/create`)
- âœ… ç”¨æˆ¶åã€å¯†ç¢¼ã€éƒµç®±ã€å…¨å
- âœ… è§’è‰²é¸æ“‡ï¼ˆç”¨æˆ¶/æ“ä½œå“¡/ç®¡ç†å“¡ï¼‰
- âœ… é‡è¤‡æª¢æŸ¥ï¼ˆç”¨æˆ¶åã€éƒµç®±ï¼‰

### 3. ç·¨è¼¯ç”¨æˆ¶ (`/users/{id}/edit`)
- âœ… ä¿®æ”¹ç”¨æˆ¶ä¿¡æ¯
- âœ… è§’è‰²è®Šæ›´
- âœ… å•Ÿç”¨/åœç”¨ç”¨æˆ¶
- âœ… é¡¯ç¤ºç”¨æˆ¶çµ±è¨ˆä¿¡æ¯

### 4. åˆªé™¤ç”¨æˆ¶
- âœ… ç¢ºèªå°è©±æ¡†
- âœ… é˜²æ­¢åˆªé™¤è‡ªå·±
- âœ… å®‰å…¨åˆªé™¤

## ğŸ¨ UI æ›´æ–°

### å°èˆªæ¬„
- âœ… ç®¡ç†å“¡ç”¨æˆ¶å¯ä»¥çœ‹åˆ°"ç”¨æˆ¶ç®¡ç†"é€£çµ
- âœ… åœ¨ç”¨æˆ¶ä¸‹æ‹‰é¸å–®ä¸­é¡¯ç¤º

### ç”¨æˆ¶ç®¡ç†é é¢
- âœ… ç¾ä»£åŒ–çš„ Bulma CSS è¨­è¨ˆ
- âœ… éŸ¿æ‡‰å¼å¸ƒå±€
- âœ… ç›´è§€çš„æ“ä½œæŒ‰éˆ•
- âœ… åˆ†é åŠŸèƒ½

## ğŸ› ï¸ æ¬Šé™å·¥å…·

### æ¬Šé™æª¢æŸ¥å‡½æ•¸
```python
from agvcui.utils.permissions import has_permission, get_user_permissions

# æª¢æŸ¥æ¬Šé™
if has_permission(request, "admin"):
    # åŸ·è¡Œç®¡ç†å“¡æ“ä½œ

# ç²å–ç”¨æˆ¶æ‰€æœ‰æ¬Šé™
permissions = get_user_permissions(request)
```

### æ¨¡æ¿ä¸­ä½¿ç”¨
```html
{% if current_user and current_user.role == 'admin' %}
<!-- ç®¡ç†å“¡åŠŸèƒ½ -->
{% endif %}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åˆå§‹åŒ–ç³»çµ±
```bash
# è¨ªå•åˆå§‹åŒ–ç®¡ç†å“¡
http://localhost:8001/init-admin
```

### 2. ç®¡ç†å“¡ç™»å…¥
```
ç”¨æˆ¶å: admin
å¯†ç¢¼: admin123
```

### 3. ç®¡ç†ç”¨æˆ¶
```bash
# è¨ªå•ç”¨æˆ¶ç®¡ç†
http://localhost:8001/users
```

## ğŸ“Š æ¬Šé™çŸ©é™£

| åŠŸèƒ½ | æœªç™»å…¥ | ç”¨æˆ¶ | æ“ä½œå“¡ | ç®¡ç†å“¡ |
|------|--------|------|--------|--------|
| æŸ¥çœ‹é é¢ | âœ… | âœ… | âœ… | âœ… |
| å‰µå»ºè³‡æº | âŒ | âŒ | âœ… | âœ… |
| ç·¨è¼¯è³‡æº | âŒ | âŒ | âœ… | âœ… |
| åˆªé™¤è³‡æº | âŒ | âŒ | âŒ | âœ… |
| ç®¡ç†ç”¨æˆ¶ | âŒ | âŒ | âŒ | âœ… |

## ğŸ”§ å¾ŒçºŒé–‹ç™¼

### åœ¨å…¶ä»–åŠŸèƒ½ä¸­ä½¿ç”¨æ¬Šé™
```python
from agvcui.utils.permissions import can_create, can_edit, can_delete

@router.post("/devices/create")
async def create_device(request: Request):
    if not can_create(request):
        raise HTTPException(status_code=403, detail="ç„¡æ¬Šé™å‰µå»º")
    # å‰µå»ºè¨­å‚™é‚è¼¯
```

### å‰ç«¯æ¬Šé™æ§åˆ¶
```html
<!-- åœ¨æ¨¡æ¿ä¸­æª¢æŸ¥æ¬Šé™ -->
{% set permissions = get_user_permissions(request) %}

{% if permissions.can_create %}
<button class="button is-primary">æ–°å¢</button>
{% endif %}

{% if permissions.can_edit %}
<button class="button is-info">ç·¨è¼¯</button>
{% endif %}

{% if permissions.can_delete %}
<button class="button is-danger">åˆªé™¤</button>
{% endif %}
```

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. æ¸¬è©¦æœªç™»å…¥è¨ªå•
- è¨ªå• `/map`, `/tasks` ç­‰é é¢
- æ‡‰è©²å¯ä»¥æ­£å¸¸æŸ¥çœ‹

### 2. æ¸¬è©¦ç®¡ç†å“¡åŠŸèƒ½
- ç™»å…¥ç®¡ç†å“¡å¸³è™Ÿ
- è¨ªå• `/users` é é¢
- æ¸¬è©¦å‰µå»ºã€ç·¨è¼¯ã€åˆªé™¤ç”¨æˆ¶

### 3. æ¸¬è©¦æ¬Šé™æ§åˆ¶
- å‰µå»ºä¸åŒè§’è‰²çš„ç”¨æˆ¶
- æ¸¬è©¦å„ç¨®æ¬Šé™é™åˆ¶

## ğŸ“ å®‰å…¨æ³¨æ„äº‹é …

1. **å¯†ç¢¼å®‰å…¨**
   - ä½¿ç”¨å¼·å¯†ç¢¼å“ˆå¸Œ (PBKDF2)
   - å»ºè­°åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­è¦æ±‚å¼·å¯†ç¢¼

2. **æœƒè©±å®‰å…¨**
   - HttpOnly cookies
   - é©ç•¶çš„éæœŸæ™‚é–“

3. **æ¬Šé™æª¢æŸ¥**
   - æ‰€æœ‰æ•æ„Ÿæ“ä½œéƒ½è¦æª¢æŸ¥æ¬Šé™
   - å‰å¾Œç«¯é›™é‡é©—è­‰

---

**å¯¦ç¾å®Œæˆï¼** ç¾åœ¨æ‚¨æœ‰äº†ä¸€å€‹éˆæ´»çš„æ¬Šé™ç³»çµ±ï¼Œå¯ä»¥æ ¹æ“šç”¨æˆ¶è§’è‰²æ§åˆ¶æ“ä½œæ¬Šé™ã€‚ğŸ‰
