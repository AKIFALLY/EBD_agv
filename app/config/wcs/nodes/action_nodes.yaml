# WCS Flow Designer - ä»»å‹™ç”¢ç”Ÿå‹•ä½œç¯€é»å®šç¾© (åŸºæ–¼å¯¦éš› AI WCS ä»£ç¢¼)
# åƒ…åŒ…å«å¯¦éš›å­˜åœ¨æ–¼ ai_wcs_ws ä¸­çš„ä»»å‹™å‰µå»ºå’Œç®¡ç†å‡½æ•¸

action_nodes:
  # === ä»»å‹™æ±ºç­–å‰µå»º (çµ±ä¸€æ±ºç­–å¼•æ“) ===
  task_decision_to_dict:
    name: "ä»»å‹™æ±ºç­–è½‰æ›"
    description: "å°‡TaskDecisionè½‰æ›ç‚ºTaskè¡¨æ ¼å¼"
    category: "output"
    icon: "ğŸ”„"
    color: "#10B981"
    inputs: ["task_decision"]
    outputs: ["task_dict"]
    parameters: []
    actions:
      - function: "to_task_dict"
        source: "unified_decision_engine.TaskDecision"
        returns: "Dict[str, Any]"

  # === çµ±ä¸€æ±ºç­–é€±æœŸåŸ·è¡Œ ===
  run_unified_decision_cycle:
    name: "åŸ·è¡Œçµ±ä¸€æ±ºç­–é€±æœŸ"
    description: "åŸ·è¡Œå®Œæ•´çš„WCSçµ±ä¸€æ±ºç­–é€±æœŸ"
    category: "output"
    icon: "ğŸ¯"
    color: "#10B981"
    inputs: []
    outputs: ["decisions"]
    parameters: []
    actions:
      - function: "run_unified_decision_cycle"
        source: "unified_decision_engine"
        returns: "List[TaskDecision]"

  # === ä¸ƒå¤§æ¥­å‹™æµç¨‹æª¢æŸ¥ ===
  check_agv_rotation_flow:
    name: "AGVæ—‹è½‰æµç¨‹æª¢æŸ¥"
    description: "æª¢æŸ¥AGVæ—‹è½‰ç‹€æ…‹ä¸¦ç”Ÿæˆæ—‹è½‰ä»»å‹™ (å„ªå…ˆç´š:100)"
    category: "output"
    icon: "ğŸ”„"
    color: "#10B981"
    inputs: []
    outputs: ["rotation_decisions"]
    parameters:
      - name: "priority"
        type: "integer"
        default: 100
        description: "ä»»å‹™å„ªå…ˆç´š (æœ€é«˜)"
    actions:
      - function: "check_agv_rotation_flow"
        source: "unified_decision_engine"
        returns: "List[TaskDecision]"

  check_ng_rack_recycling_flow:
    name: "NGæ–™æ¶å›æ”¶æµç¨‹æª¢æŸ¥"
    description: "æª¢æŸ¥NGæ–™æ¶ä¸¦ç”Ÿæˆå›æ”¶ä»»å‹™ (å„ªå…ˆç´š:90)"
    category: "output"
    icon: "â™»ï¸"
    color: "#10B981"
    inputs: []
    outputs: ["ng_recycling_decisions"]
    parameters:
      - name: "priority"
        type: "integer"
        default: 90
        description: "ä»»å‹™å„ªå…ˆç´š"
    actions:
      - function: "check_ng_rack_recycling_flow"
        source: "unified_decision_engine"
        returns: "List[TaskDecision]"

  check_full_rack_to_manual_flow:
    name: "æ»¿æ–™æ¶åˆ°äººå·¥å€æµç¨‹æª¢æŸ¥"
    description: "æª¢æŸ¥æ»¿æ–™æ¶ä¸¦ç”Ÿæˆäººå·¥æ”¶æ–™ä»»å‹™ (å„ªå…ˆç´š:80)"
    category: "output"
    icon: "ğŸ“¦"
    color: "#10B981"
    inputs: []
    outputs: ["full_to_manual_decisions"]
    parameters:
      - name: "priority"
        type: "integer"
        default: 80
        description: "ä»»å‹™å„ªå…ˆç´š"
    actions:
      - function: "check_full_rack_to_manual_flow"
        source: "unified_decision_engine"
        returns: "List[TaskDecision]"

  check_manual_area_transport_flow:
    name: "äººå·¥æ”¶æ–™å€æ¬é‹æµç¨‹æª¢æŸ¥"
    description: "æª¢æŸ¥äººå·¥æ”¶æ–™å€ä¸¦ç”Ÿæˆæ¬é‹ä»»å‹™ (å„ªå…ˆç´š:80)"
    category: "output"
    icon: "ğŸ‘·"
    color: "#10B981"
    inputs: []
    outputs: ["manual_transport_decisions"]
    parameters:
      - name: "priority"
        type: "integer"
        default: 80
        description: "ä»»å‹™å„ªå…ˆç´š"
    actions:
      - function: "check_manual_area_transport_flow"
        source: "unified_decision_engine"
        returns: "List[TaskDecision]"

  check_system_to_room_flow:
    name: "ç³»çµ±åˆ°æˆ¿é–“æµç¨‹æª¢æŸ¥"
    description: "æª¢æŸ¥ç³»çµ±æº–å‚™å€åˆ°æˆ¿é–“çš„æ¬é‹éœ€æ±‚ (å„ªå…ˆç´š:60)"
    category: "output"
    icon: "ğŸ "
    color: "#10B981"
    inputs: []
    outputs: ["system_to_room_decisions"]
    parameters:
      - name: "priority"
        type: "integer"
        default: 60
        description: "ä»»å‹™å„ªå…ˆç´š"
    actions:
      - function: "check_system_to_room_flow"
        source: "unified_decision_engine"
        returns: "List[TaskDecision]"

  check_empty_rack_transfer_flow:
    name: "ç©ºæ–™æ¶è½‰ç§»æµç¨‹æª¢æŸ¥"
    description: "æª¢æŸ¥ç©ºæ–™æ¶è½‰ç§»éœ€æ±‚ (å„ªå…ˆç´š:40)"
    category: "output"
    icon: "ğŸ“¤"
    color: "#10B981"
    inputs: []
    outputs: ["empty_transfer_decisions"]
    parameters:
      - name: "priority"
        type: "integer"
        default: 40
        description: "ä»»å‹™å„ªå…ˆç´š"
    actions:
      - function: "check_empty_rack_transfer_flow"
        source: "unified_decision_engine"
        returns: "List[TaskDecision]"

  check_manual_empty_recycling_flow:
    name: "äººå·¥å›æ”¶ç©ºæ–™æ¶æµç¨‹æª¢æŸ¥"
    description: "æª¢æŸ¥äººå·¥å›æ”¶ç©ºæ–™æ¶éœ€æ±‚ (å„ªå…ˆç´š:40, WorkID:230001)"
    category: "output"
    icon: "ğŸ”„"
    color: "#10B981"
    inputs: []
    outputs: ["manual_empty_decisions"]
    parameters:
      - name: "priority"
        type: "integer"
        default: 40
        description: "ä»»å‹™å„ªå…ˆç´š"
      - name: "work_id"
        type: "string"
        default: "230001"
        description: "ç‰¹æ®Šæµç¨‹è§¸ç™¼WorkID"
    actions:
      - function: "check_manual_empty_recycling_flow"
        source: "unified_decision_engine"
        returns: "List[TaskDecision]"

  check_opui_requests_flow:
    name: "OPUIè«‹æ±‚æµç¨‹æª¢æŸ¥"
    description: "æª¢æŸ¥OPUIå«è»Šå’Œæ´¾è»Šè«‹æ±‚"
    category: "output"
    icon: "ğŸ“"
    color: "#10B981"
    inputs: []
    outputs: ["opui_decisions"]
    parameters:
      - name: "request_type"
        type: "string"
        options: ["call_empty", "dispatch_full"]
        description: "è«‹æ±‚é¡å‹"
    actions:
      - function: "check_opui_requests_flow"
        source: "unified_decision_engine"
        returns: "List[TaskDecision]"

  # === çµ±ä¸€ä»»å‹™ç®¡ç†å™¨ ===
  create_tasks_from_decisions:
    name: "å¾æ±ºç­–å‰µå»ºä»»å‹™"
    description: "æ‰¹æ¬¡å¾TaskDecisionåˆ—è¡¨å‰µå»ºè³‡æ–™åº«ä»»å‹™"
    category: "output"
    icon: "ğŸ“"
    color: "#10B981"
    inputs: ["decisions"]
    outputs: ["creation_results"]
    parameters:
      - name: "decisions"
        type: "list"
        required: true
        description: "TaskDecisionåˆ—è¡¨"
    actions:
      - function: "create_tasks_from_decisions"
        source: "unified_task_manager"
        returns: "List[TaskCreationResult]"

  create_task_from_decision:
    name: "å¾å–®ä¸€æ±ºç­–å‰µå»ºä»»å‹™"
    description: "å¾å–®ä¸€TaskDecisionå‰µå»ºè³‡æ–™åº«ä»»å‹™"
    category: "output"
    icon: "âœï¸"
    color: "#10B981"
    inputs: ["decision"]
    outputs: ["creation_result"]
    parameters:
      - name: "decision"
        type: "object"
        required: true
        description: "TaskDecisionå°è±¡"
    actions:
      - function: "create_task_from_decision"
        source: "unified_task_manager"
        returns: "TaskCreationResult"

  # === è³‡æ–™åº«ä»»å‹™å‰µå»º (å¢å¼·è³‡æ–™åº«å®¢æˆ¶ç«¯) ===
  create_task_from_decision_dict:
    name: "å¾æ±ºç­–å­—å…¸å‰µå»ºä»»å‹™"
    description: "å¾æ±ºç­–å­—å…¸ç›´æ¥å‰µå»ºè³‡æ–™åº«ä»»å‹™"
    category: "output"
    icon: "ğŸ’¾"
    color: "#10B981"
    inputs: ["decision_dict"]
    outputs: ["task_id"]
    parameters:
      - name: "work_id"
        type: "string"
        required: true
        description: "Work ID"
      - name: "status_id"
        type: "integer"
        default: 0
        description: "ä»»å‹™ç‹€æ…‹ (0=å¾…è™•ç†)"
      - name: "room_id"
        type: "integer"
        description: "æˆ¿é–“ID"
      - name: "node_id"
        type: "integer"
        required: true
        description: "ç›®æ¨™ç¯€é»ID"
      - name: "name"
        type: "string"
        required: true
        description: "ä»»å‹™åç¨±"
      - name: "description"
        type: "string"
        description: "ä»»å‹™æè¿°"
      - name: "priority"
        type: "integer"
        default: 50
        description: "ä»»å‹™å„ªå…ˆç´š"
      - name: "parameters"
        type: "object"
        description: "ä»»å‹™åƒæ•¸"
    actions:
      - function: "create_task_from_decision"
        source: "enhanced_database_client"
        returns: "Optional[int]"

  # === OPUI ä»»å‹™ç®¡ç† ===
  update_existing_opui_task:
    name: "æ›´æ–°ç¾æœ‰OPUIä»»å‹™"
    description: "æ›´æ–°ç¾æœ‰OPUIä»»å‹™ç‹€æ…‹å’Œåƒæ•¸"
    category: "output"
    icon: "ğŸ”§"
    color: "#10B981"
    inputs: ["task_id", "new_status"]
    outputs: ["update_success"]
    parameters:
      - name: "task_id"
        type: "integer"
        required: true
        description: "ä»»å‹™ID"
      - name: "new_status"
        type: "integer"
        default: 1
        description: "æ–°ç‹€æ…‹ (1=AI WCSå·²è™•ç†)"
      - name: "model"
        type: "string"
        default: "KUKA400i"
        description: "AGVæ¨¡å‹"
    actions:
      - function: "update_existing_opui_task"
        source: "enhanced_database_client"
        returns: "bool"

  # === åœè»Šæ ¼ç‹€æ…‹ç®¡ç† ===
  update_machine_parking_status:
    name: "æ›´æ–°æ©Ÿå°åœè»Šæ ¼ç‹€æ…‹"
    description: "æ›´æ–°æ©Ÿå°åœè»Šæ ¼çš„ä½”ç”¨ç‹€æ…‹"
    category: "output"
    icon: "ğŸ…¿ï¸"
    color: "#10B981"
    inputs: ["machine_id", "space_num", "status"]
    outputs: ["update_success"]
    parameters:
      - name: "machine_id"
        type: "integer"
        required: true
        description: "æ©Ÿå°ID"
      - name: "space_num"
        type: "integer"
        required: true
        options: [1, 2]
        description: "åœè»Šæ ¼ç·¨è™Ÿ"
      - name: "status"
        type: "integer"
        required: true
        options: [0, 1, 2]
        description: "ç‹€æ…‹ (0=å¯ç”¨, 1=ä»»å‹™ä¸­, 2=å®Œæˆ)"
    actions:
      - function: "update_machine_parking_status"
        source: "enhanced_database_client"
        returns: "bool"

  batch_update_parking_status:
    name: "æ‰¹æ¬¡æ›´æ–°åœè»Šæ ¼ç‹€æ…‹"
    description: "æ‰¹æ¬¡æ›´æ–°å¤šå€‹åœè»Šæ ¼ç‹€æ…‹"
    category: "output"
    icon: "ğŸ¬"
    color: "#10B981"
    inputs: ["updates"]
    outputs: ["batch_result"]
    parameters:
      - name: "updates"
        type: "list"
        required: true
        description: "æ›´æ–°åˆ—è¡¨ [{machine_id, space_num, status}]"
    actions:
      - function: "batch_update_parking_status"
        source: "enhanced_database_client"
        returns: "Dict[str, Any]"