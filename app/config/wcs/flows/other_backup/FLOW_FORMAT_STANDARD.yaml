# RosAGV Flow Format Standard
# 標準流程格式定義 - Flow Designer 與 Simple WCS 共用格式
# 版本: 1.0
# 最後更新: 2024-12

# ============================================
# 檔案結構說明
# ============================================
# 1. 業務邏輯部分：供 Simple WCS 執行使用
# 2. 視覺化資料部分：供 Flow Designer 編輯使用
# 兩部分資料互相獨立但保持同步

# ============================================
# 第一部分：業務邏輯定義
# ============================================

# 基本資訊
name: 流程名稱（必填）
description: 流程描述說明
version: "1.0"
author: 作者名稱
enabled: true                    # 是否啟用此流程
priority: 100                    # 優先級（數字越大優先級越高）
work_id: "220001"               # 工作 ID（6位數字字串）

# 節點定義（核心邏輯）
nodes:
  # 節點類型說明：
  # - condition: 條件判斷節點（檢查狀態、評估條件）
  # - action: 動作執行節點（生成任務、執行操作）
  # - logic: 邏輯處理節點（資料處理、狀態記錄）
  
  # 條件節點範例
  - id: unique_node_id          # 唯一識別碼
    type: condition             # 節點類型
    name: 節點顯示名稱         # 人類可讀名稱
    function: check_function    # 實際執行的函數名稱
    parameters:                 # 函數參數
      param1: value1
      param2: value2
    inputs:                     # 輸入接口定義（可選）
      input_name: { type: "boolean", description: "輸入說明" }
    outputs:                    # 輸出接口定義
      output1: { type: "boolean", description: "輸出1說明" }
      output2: { type: "boolean", description: "輸出2說明" }
      
  # 動作節點範例
  - id: action_node_id
    type: action
    name: 執行動作
    function: create_task_function
    parameters:
      task_type: "TASK_TYPE"
      priority: "high"
    inputs:
      trigger: { type: "boolean", description: "觸發條件" }
    outputs:                    # 動作節點通常有輸出（如任務ID）
      task_id: { type: "string", description: "生成的任務ID" }
      
  # 邏輯節點範例
  - id: logic_node_id
    type: logic
    name: 邏輯處理
    function: process_data
    parameters:
      operation: "AND"
    inputs:
      input1: { type: "any", description: "輸入1" }
      input2: { type: "any", description: "輸入2" }
    outputs:
      result: { type: "any", description: "處理結果" }

# 連線關係定義
# 定義節點之間的資料流向
connections:
  - from: source_node_id.output_name     # 來源節點.輸出接口
    to: target_node_id.input_name        # 目標節點.輸入接口
    description: 連線說明（可選）        # 說明這條連線的用途

# ============================================
# 第二部分：Flow Designer 視覺化資料
# ============================================
flow_designer_data:
  # 節點視覺化資訊
  nodes:
    - id: unique_node_id        # 對應上方的節點 ID
      position:                 # 節點在畫布上的位置
        x: 100
        y: 200
      data:                     # 節點資料（與上方節點定義對應）
        name: 節點顯示名稱
        type: condition
        function: check_function
        parameters:
          param1: value1
          param2: value2
      inputs:                   # 輸入接口列表
        - key: input_name
      outputs:                  # 輸出接口列表
        - key: output1
        - key: output2
        
  # 連線視覺化資訊
  connections:
    - id: conn_unique_id        # 連線唯一識別碼
      source: source_node_id    # 來源節點 ID
      sourceOutput: output_name # 來源輸出接口
      target: target_node_id    # 目標節點 ID
      targetInput: input_name   # 目標輸入接口

# ============================================
# 資料類型說明
# ============================================
# 支援的資料類型：
# - boolean: 布林值（true/false）
# - integer: 整數
# - string: 字串
# - array: 陣列
# - object: 物件
# - any: 任意類型

# ============================================
# 函數命名規範
# ============================================
# 條件檢查函數：check_xxx, is_xxx, has_xxx
# 動作執行函數：create_xxx, execute_xxx, process_xxx
# 邏輯處理函數：calculate_xxx, transform_xxx, log_xxx

# ============================================
# 實際使用範例
# ============================================
# 1. 簡單條件判斷流程
#    條件節點 → 動作節點
#
# 2. 多條件組合流程
#    條件1 ↘
#          邏輯節點(AND) → 動作節點
#    條件2 ↗
#
# 3. 分支流程
#    條件節點 → true分支 → 動作1
#            ↘ false分支 → 動作2
#
# 4. 迴圈流程（需要特殊處理）
#    迭代器節點 → 條件檢查 → 動作 → 繼續迭代

# ============================================
# 注意事項
# ============================================
# 1. 節點 ID 必須在整個流程中唯一
# 2. 連線的來源和目標必須存在對應的節點和接口
# 3. 資料類型應該匹配（除非使用 any 類型）
# 4. Flow Designer 會根據 flow_designer_data 渲染視覺化界面
# 5. Simple WCS 會根據 nodes 和 connections 執行業務邏輯
# 6. 兩部分資料應該保持一致性