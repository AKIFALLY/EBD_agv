meta:
  system: linear_flow_v2
  version: "2.0.0"
  author: "Claude AI Assistant"
  created_at: "2025-08-13"
  description: "使用 foreach 查詢每個房間的入口位置並記錄日誌"

flow:
  id: "room_entrance_foreach_demo"
  name: "房間入口位置 ForEach 示範"
  work_id: "100001"
  enabled: true
  priority: 100

workflow:
  - section: "查詢房間入口位置"
    description: "查詢房間 1-5 的入口位置並記錄日誌"
    steps:
      - id: "query_room_locations"
        exec: "query.locations"
        params:
          rooms: [1, 2, 3, 4, 5]
          type: "room_inlet"
        store: "room_locations"
        description: "查詢房間 1-5 的入口位置資料"

      - id: "log_locations_count"
        exec: "action.log_message"
        params:
          message: "查詢到 ${room_locations.length} 個房間入口位置"
          level: "info"
          tags: []
        description: "記錄查詢結果數量"

      - id: "foreach_locations"
        exec: "foreach"
        params:
          items: "${room_locations}"
          var: "location"
          steps:
            - id: "log_location_info"
              exec: "action.log_message"
              params:
                message: "房間 ${location.room_id} 入口 - Node ID: ${location.node_id}, 位置 ID: ${location.id}"
                level: "info"
                tags: ["room_entrance", "location_info"]
              description: "記錄每個房間的入口位置資訊"

  - section: "額外查詢示範"
    description: "示範直接使用房間編號列表進行 foreach"
    steps:
      - id: "foreach_room_numbers"
        exec: "foreach"
        params:
          items: [1, 2, 3, 4, 5]
          var: "room_number"
          steps:
            - id: "query_single_room"
              exec: "query.locations"
              params:
                rooms: "[${room_number}]"
                type: "room_inlet"
              store: "single_room_location"
              description: "查詢單一房間的入口位置"

            - id: "check_if_found"
              exec: "check.empty"
              params:
                data: "${single_room_location}"
              store: "is_empty"
              description: "檢查是否找到位置資料"

            - id: "log_single_room"
              exec: "action.log_message"
              params:
                message: "房間 ${room_number} 查詢結果: 找到 ${single_room_location.length} 個入口位置"
                level: "info"
                tags: []
              skip_if: "${is_empty}"
              description: "記錄單一房間查詢結果"

            - id: "log_room_detail"
              exec: "action.log_message"
              params:
                message: "房間 ${room_number} 入口詳情: Node ID = ${single_room_location[0].node_id}"
                level: "info"
                tags: ["room_${room_number}"]
              skip_if: "${is_empty}"
              description: "記錄房間入口詳細資訊"

  - section: "總結"
    description: "記錄執行總結"
    steps:
      - id: "log_completion"
        exec: "action.log_message"
        params:
          message: "✨ 完成所有房間入口位置查詢！"
          level: "info"
          tags: ["completion", "summary"]
        description: "記錄完成訊息"

settings:
  log_level: "INFO"
  enable_checkpoint: false
  parallel_execution: false
  timeout: 60
  retry_on_failure: false