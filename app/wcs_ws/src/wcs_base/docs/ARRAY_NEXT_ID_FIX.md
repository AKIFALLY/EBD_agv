# é™£åˆ— next_id è™•ç†é‚è¼¯ä¿®æ­£

## ğŸš¨ å•é¡Œæè¿°

ç”¨æˆ¶å ±å‘Šçš„å•é¡Œï¼šç•¶æ¢ä»¶ 205 çš„ `result="False"` æ™‚ï¼Œæ‡‰è©²è·³è½‰åˆ° `next_id=206`ï¼Œä½†å¯¦éš›åŸ·è¡Œå»è·³è½‰åˆ°äº† 305 ç­‰ä¸ç›¸é—œçš„æ¢ä»¶ã€‚

### åŸå§‹å•é¡Œæ—¥èªŒ
```
[INFO] ğŸ“ ID 2 æ¢ä»¶æ»¿è¶³ï¼Œnext_id: [105,205,305,405,505,605,705,805,905,1005]
[WARN] âš ï¸ ID 305 çš„æ¢ä»¶è¨˜éŒ„ä¸å­˜åœ¨æˆ–ç„¡ conditions å…§å®¹
[WARN] âš ï¸ ID 405 çš„æ¢ä»¶è¨˜éŒ„ä¸å­˜åœ¨æˆ–ç„¡ conditions å…§å®¹
...
[INFO] ğŸ“‹ ID åˆ—è¡¨ [205, 305, 405, 505, 605, 705, 805, 905] ä¸­æ‰€æœ‰æ¢ä»¶éƒ½ä¸æ»¿è¶³
```

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### å•é¡Œ 1ï¼šé™£åˆ—æ ¼å¼è™•ç†éŒ¯èª¤
- **æœŸæœ›æ ¼å¼**ï¼š`"105,205,305,405"`
- **å¯¦éš›æ ¼å¼**ï¼š`"[105,205,305,405]"`ï¼ˆå¸¶æ–¹æ‹¬è™Ÿï¼‰
- **çµæœ**ï¼š`process_id_list` ç„¡æ³•æ­£ç¢ºè§£æå¸¶æ–¹æ‹¬è™Ÿçš„é™£åˆ—

### å•é¡Œ 2ï¼šOR é‚è¼¯æ”¯æ´ä¸å®Œæ•´
- `check_single_id_condition` åªæª¢æŸ¥ `result == "True"`
- ç•¶æ¢ä»¶ 205 è¿”å› `result="False", next_id="206"` æ™‚ï¼Œè¢«è¦–ç‚ºå¤±æ•—
- ä¸ç¬¦åˆ OR é‚è¼¯çš„è¨­è¨ˆç†å¿µ

## âœ… ä¿®æ­£æ–¹æ¡ˆ

### ä¿®æ­£ 1ï¼šæ”¯æ´æ–¹æ‹¬è™Ÿé™£åˆ—æ ¼å¼

**æª”æ¡ˆ**ï¼š`wcs_ws/src/wcs_base/wcs_base/task_condition_checker.py`

**ä¿®æ­£å‰**ï¼š
```python
# æª¢æŸ¥æ˜¯å¦ç‚ºåˆ—è¡¨æ ¼å¼ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰
if "," in next_id:
    return self.process_id_list(next_id)
```

**ä¿®æ­£å¾Œ**ï¼š
```python
# æª¢æŸ¥æ˜¯å¦ç‚ºåˆ—è¡¨æ ¼å¼ï¼ˆæ–¹æ‹¬è™ŸåŒ…åœæˆ–é€—è™Ÿåˆ†éš”ï¼‰
if next_id.startswith("[") and next_id.endswith("]"):
    # ç§»é™¤æ–¹æ‹¬è™Ÿä¸¦è™•ç†
    clean_list = next_id[1:-1]
    return self.process_id_list(clean_list)
elif "," in next_id:
    return self.process_id_list(next_id)
```

### ä¿®æ­£ 2ï¼šå®Œæ•´æ”¯æ´ OR é‚è¼¯

**ä¿®æ­£å‰**ï¼š
```python
# æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½• data é …ç›®çš„ result ç‚º "True"
for data_item in data_list:
    if data_item.get("result") == "True":
        return True

return False
```

**ä¿®æ­£å¾Œ**ï¼š
```python
# æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½• data é …ç›®çš„ result ç‚º "True" æˆ–æœ‰ next_idï¼ˆæ”¯æ´ OR é‚è¼¯ï¼‰
for data_item in data_list:
    result_value = data_item.get("result")
    next_id_value = data_item.get("next_id")
    
    if result_value == "True":
        return True
    elif result_value == "False" and next_id_value:
        # æ”¯æ´ OR é‚è¼¯ï¼šå³ä½¿ result ç‚º Falseï¼Œä½†æœ‰ next_id ä¹Ÿç®—æˆåŠŸ
        self.logger.info(f"ğŸ“‹ ID {check_id} æ¢ä»¶ä¸æ»¿è¶³ä½†æœ‰ next_id: {next_id_value}ï¼Œè¦–ç‚ºå¯ç¹¼çºŒ")
        return True

return False
```

## ğŸ¯ ä¿®æ­£å¾Œçš„åŸ·è¡Œæµç¨‹

### æ­£ç¢ºçš„æµç¨‹
```
1. æ¢ä»¶ 2ï¼šæª¢æŸ¥äººå·¥æ”¶æ–™å€ç©ºä½
   result="True", next_id="[105,205,305,405,...]"
   â†“
2. è™•ç†é™£åˆ— next_idï¼š
   - ç§»é™¤æ–¹æ‹¬è™Ÿï¼š105,205,305,405,...
   - ä¾åºæª¢æŸ¥ï¼š105 â†’ 205 â†’ 305...
   â†“
3. æª¢æŸ¥æ¢ä»¶ 105ï¼š
   - ä¸å­˜åœ¨æˆ–å¤±æ•— â†’ ç¹¼çºŒä¸‹ä¸€å€‹
   â†“
4. æª¢æŸ¥æ¢ä»¶ 205ï¼š
   - result="False", next_id="206"
   - OR é‚è¼¯ï¼šæœ‰ next_id è¦–ç‚ºæˆåŠŸ âœ…
   - é¸æ“‡æ¢ä»¶ 205
   â†“
5. åŸ·è¡Œæ¢ä»¶ 205 çš„å®Œæ•´é‚è¼¯ï¼š
   - result="False" â†’ è·³è½‰åˆ° next_id="206" âœ…
```

### éŒ¯èª¤çš„æµç¨‹ï¼ˆä¿®æ­£å‰ï¼‰
```
1. æ¢ä»¶ 2ï¼šæª¢æŸ¥äººå·¥æ”¶æ–™å€ç©ºä½
   result="True", next_id="[105,205,305,405,...]"
   â†“
2. è™•ç†é™£åˆ— next_idï¼š
   - ç„¡æ³•æ­£ç¢ºè§£ææ–¹æ‹¬è™Ÿ
   - æˆ–è€… OR é‚è¼¯ä¸å®Œæ•´
   â†“
3. è·³éæ¢ä»¶ 105ï¼Œç›´æ¥æª¢æŸ¥ 205, 305, 405...
   - æ¢ä»¶ 205ï¼šresult="False" â†’ è¦–ç‚ºå¤±æ•— âŒ
   - æ¢ä»¶ 305ï¼šä¸å­˜åœ¨ â†’ å¤±æ•— âŒ
   - æ¢ä»¶ 405ï¼šä¸å­˜åœ¨ â†’ å¤±æ•— âŒ
   â†“
4. æ‰€æœ‰æ¢ä»¶éƒ½å¤±æ•—ï¼Œé”åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•¸
```

## ğŸ§ª æ¸¬è©¦é©—è­‰

### æ¸¬è©¦æ¡ˆä¾‹ 1ï¼šæ–¹æ‹¬è™Ÿé™£åˆ—è™•ç†
```python
next_id = "[105,205,305,405]"
result = checker.process_next_id(next_id)
# é æœŸï¼šæ­£ç¢ºç§»é™¤æ–¹æ‹¬è™Ÿä¸¦è™•ç†
```

### æ¸¬è©¦æ¡ˆä¾‹ 2ï¼šOR é‚è¼¯æ”¯æ´
```python
condition_result = [{"result": "False", "next_id": "206"}]
result = checker.check_single_id_condition(205)
# é æœŸï¼šè¿”å› Trueï¼ˆå› ç‚ºæœ‰ next_idï¼‰
```

### æ¸¬è©¦æ¡ˆä¾‹ 3ï¼šæ•´åˆå ´æ™¯
```python
# æ¨¡æ“¬æ¢ä»¶ 2 â†’ 105 (å¤±æ•—) â†’ 205 (ORé‚è¼¯æˆåŠŸ) â†’ 206
next_id = "[105,205,305,405]"
result = checker.process_next_id(next_id)
# é æœŸï¼šè¿”å› 205
```

## ğŸ“Š ä¿®æ­£æ•ˆæœ

### ä¿®æ­£å‰çš„å•é¡Œ
- âŒ ç„¡æ³•è™•ç†æ–¹æ‹¬è™Ÿé™£åˆ—æ ¼å¼
- âŒ OR é‚è¼¯ä¸å®Œæ•´
- âŒ è·³è½‰åˆ°éŒ¯èª¤çš„æ¢ä»¶ ID
- âŒ é”åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•¸

### ä¿®æ­£å¾Œçš„æ•ˆæœ
- âœ… æ­£ç¢ºè™•ç†æ–¹æ‹¬è™Ÿé™£åˆ—æ ¼å¼
- âœ… å®Œæ•´æ”¯æ´ OR é‚è¼¯
- âœ… æ­£ç¢ºè·³è½‰ï¼š205 (False) â†’ 206
- âœ… æµç¨‹é †æš¢åŸ·è¡Œ

## ğŸ¯ ç¸½çµ

é€šéé€™å…©å€‹é—œéµä¿®æ­£ï¼š

1. **é™£åˆ—æ ¼å¼æ”¯æ´**ï¼šæ­£ç¢ºè™•ç† `"[105,205,...]"` æ ¼å¼
2. **OR é‚è¼¯å®Œå–„**ï¼š`result="False"` ä½†æœ‰ `next_id` ä¹Ÿè¦–ç‚ºå¯ç¹¼çºŒ

ç¾åœ¨ç³»çµ±èƒ½å¤ æ­£ç¢ºåŸ·è¡Œï¼š
```
æ¢ä»¶ 2 (ç©ºä½æª¢æŸ¥) â†’ æ¢ä»¶ 205 (æ»¿æ–™æ¶æª¢æŸ¥) â†’ æ¢ä»¶ 206 (cargoä»»å‹™æª¢æŸ¥) â†’ æ¢ä»¶ 207 (é‡è¤‡ä»»å‹™æª¢æŸ¥)
```

æ»¿è¶³ç”¨æˆ¶çš„éœ€æ±‚ï¼š**ç•¶æ¢ä»¶ 205 ç‚º False æ™‚ï¼Œæ­£ç¢ºè·³è½‰åˆ° 206ï¼Œè€Œä¸æ˜¯ 305**ã€‚
